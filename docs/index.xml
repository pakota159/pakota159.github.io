<?xml version="1.0" encoding="UTF-8"?>
<rss  xmlns:atom="http://www.w3.org/2005/Atom" 
      xmlns:media="http://search.yahoo.com/mrss/" 
      xmlns:content="http://purl.org/rss/1.0/modules/content/" 
      xmlns:dc="http://purl.org/dc/elements/1.1/" 
      version="2.0">
<channel>
<title>Cuong Pham</title>
<link>https://pakota159.github.io/</link>
<atom:link href="https://pakota159.github.io/index.xml" rel="self" type="application/rss+xml"/>
<description>Blog about SaaS metrics, data analysis, and technology</description>
<generator>quarto-1.8.27</generator>
<lastBuildDate>Fri, 09 Jan 2026 17:00:00 GMT</lastBuildDate>
<item>
  <title>SaaS Metrics that actually make sense - Part 1</title>
  <dc:creator>Cuong Pham</dc:creator>
  <link>https://pakota159.github.io/posts/saas-metrics-1/</link>
  <description><![CDATA[ 




<section id="saas-là-gì" class="level2">
<h2 class="anchored" data-anchor-id="saas-là-gì">SaaS là gì?</h2>
<p>Trước khi đi sâu vào các chỉ số phức tạp, hãy trả lời câu hỏi cơ bản: SaaS thực chất là gì?</p>
<p><strong>SaaS (Software as a Service)</strong> là mô hình phân phối phần mềm trong đó nhà cung cấp lưu trữ ứng dụng trên đám mây (Cloud) và cung cấp cho khách hàng qua Internet.</p>
<ul>
<li><strong>Thay vì</strong> mua đứt và cài đặt vào máy (như đĩa CD Microsoft Office 2003 ngày xưa)</li>
<li><strong>Khách hàng</strong> trả phí thuê bao (Subscription) để truy cập và sử dụng (như Office 365, Google Workspace)</li>
</ul>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Tư duy cho Data Analyst
</div>
</div>
<div class="callout-body-container callout-body">
<p>Sự thay đổi này chuyển dịch doanh thu từ <strong>One-time payment</strong> (mua 1 lần) sang <strong>Recurring Revenue</strong> (doanh thu định kỳ). Đây là lý do tại sao các metrics như MRR, ARR, Churn ra đời.</p>
</div>
</div>
</section>
<section id="phân-biệt-saas-với-các-mô-hình-khác" class="level2">
<h2 class="anchored" data-anchor-id="phân-biệt-saas-với-các-mô-hình-khác">Phân biệt SaaS với các mô hình khác</h2>
<p>Để dễ hình dung, hãy so sánh SaaS với mô hình truyền thống (On-Premise) và các tầng khác của Cloud Computing.</p>
<section id="saas-vs.-on-premise-mô-hình-truyền-thống" class="level3">
<h3 class="anchored" data-anchor-id="saas-vs.-on-premise-mô-hình-truyền-thống">1. SaaS vs.&nbsp;On-Premise (Mô hình truyền thống)</h3>
<p>Đây là sự so sánh quan trọng nhất về mặt kinh doanh.</p>
<table class="caption-top table">
<colgroup>
<col style="width: 18%">
<col style="width: 50%">
<col style="width: 31%">
</colgroup>
<thead>
<tr class="header">
<th>Đặc điểm</th>
<th>On-Premise (Truyền thống)</th>
<th>SaaS (Hiện đại)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Sở hữu</strong></td>
<td>Bạn mua phần mềm vĩnh viễn (“Cái đĩa là của bạn”)</td>
<td>Bạn thuê quyền sử dụng (“Dịch vụ là của họ”)</td>
</tr>
<tr class="even">
<td><strong>Chi phí</strong></td>
<td>CapEx (Chi phí vốn): Trả 1 cục tiền lớn ban đầu</td>
<td>OpEx (Chi phí vận hành): Trả nhỏ giọt hàng tháng/năm</td>
</tr>
<tr class="odd">
<td><strong>Bảo trì</strong></td>
<td>Bạn tự lo server, update, vá lỗi, bảo mật</td>
<td>Nhà cung cấp lo từ A-Z (Auto-update)</td>
</tr>
<tr class="even">
<td><strong>Truy cập</strong></td>
<td>Tại nơi cài đặt (Tại văn phòng/máy tính cá nhân)</td>
<td>Mọi lúc, mọi nơi, miễn có Internet</td>
</tr>
<tr class="odd">
<td><strong>Metrics</strong></td>
<td>Sales, Unit Sold (Số bản bán được)</td>
<td>MRR, Churn, LTV (Vòng đời khách hàng)</td>
</tr>
</tbody>
</table>
</section>
<section id="saas-vs.-iaas-vs.-paas-các-tầng-cloud" class="level3">
<h3 class="anchored" data-anchor-id="saas-vs.-iaas-vs.-paas-các-tầng-cloud">2. SaaS vs.&nbsp;IaaS vs.&nbsp;PaaS (Các tầng Cloud)</h3>
<p>Nếu ví việc xây dựng phần mềm như việc <strong>Ăn Pizza</strong>, thì:</p>
<ul>
<li><p><strong>On-Premise (Làm tại nhà)</strong>: Bạn mua bột, mua lò nướng, tự làm đế, tự nướng, tự dọn dẹp.</p></li>
<li><p><strong>IaaS (Infrastructure as a Service)</strong>: Bạn thuê nhà bếp và lò nướng. Bạn vẫn tự mua bột và làm bánh.<br>
<em>Ví dụ: AWS EC2, DigitalOcean</em></p></li>
<li><p><strong>PaaS (Platform as a Service)</strong>: Bạn mua đế bánh làm sẵn. Bạn chỉ việc rắc topping (code) lên và nướng.<br>
<em>Ví dụ: Heroku, Google App Engine</em></p></li>
<li><p><strong>SaaS (Software as a Service)</strong>: Bạn đến nhà hàng Pizza. Bạn chỉ việc gọi món và ăn.<br>
<em>Ví dụ: Gmail, Salesforce, Dropbox</em></p></li>
</ul>
</section>
</section>
<section id="tại-sao-data-analyst-cần-quan-tâm-sự-phân-biệt-này" class="level2">
<h2 class="anchored" data-anchor-id="tại-sao-data-analyst-cần-quan-tâm-sự-phân-biệt-này">Tại sao Data Analyst cần quan tâm sự phân biệt này?</h2>
<p>Vì <strong>mô hình quyết định dữ liệu bạn có</strong>:</p>
<ol type="1">
<li><p><strong>SaaS</strong>: Bạn có quyền truy cập vào <strong>Behavioral Data</strong> (Dữ liệu hành vi). Bạn biết khách hàng click vào đâu, dùng tính năng nào mỗi ngày.</p></li>
<li><p><strong>On-Premise</strong>: Bạn thường bị “mù” về cách khách hàng sử dụng sản phẩm sau khi bán xong (trừ khi có cơ chế telemetry đặc biệt).</p></li>
</ol>
<hr>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span>Tài liệu tham khảo
</div>
</div>
<div class="callout-body-container callout-body">
<p>Để tìm hiểu sâu hơn về các mô hình kinh doanh SaaS, xem thêm:</p>
<ul>
<li><a href="https://nvlpubs.nist.gov/nistpubs/Legacy/SP/nistspecialpublication800-145.pdf">Định nghĩa SaaS của NIST</a> - Thế nào là SaaS</li>
<li><a href="https://www.salesforce.com/saas/">Saleforce articles</a> - What is SaaS? Software as a Service Defined</li>
<li><a href="https://www.ibm.com/think/topics/iaas-paas-saas">Phân biệt IaaS, SaaS, PaaS</a> - IBM document</li>
</ul>
</div>
</div>
</section>
<section id="saas-landscape" class="level2">
<h2 class="anchored" data-anchor-id="saas-landscape">Phân loại SaaS</h2>
<p>Ở vai trò của 1 nhà quản lý, hoặc 1 data analyst, để biết được những chỉ số nào quan trọng cần theo dõi để đánh giá hiệu quả kinh doanh của công ty, thì bạn phải biết công ty mình thuộc loại nào trong những loại sau.</p>
<div class="cell" data-fig-width="10" data-fig-height="8" data-layout-align="default">
<div class="cell-output-display">
<div id="fig-saas-mindmap" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-saas-mindmap-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div>
<pre class="mermaid mermaid-js" data-label="fig-saas-mindmap">mindmap
  root((SaaS Business Model))
    Bán hàng &amp; Go-to-Market
      Self-Service
      Transactional
      Enterprise
    Chiến lược Tăng trưởng
      Product-Led Growth
      Sales-Led Growth
      Marketing-Led Growth
      Hybrid Motion
    Mô hình Định giá
      Freemium
      Per-User Seat-Based
      Usage-Based
      Tiered Packages
      Flat-Rate
      Transactional
      Hybrid Pricing
    Định hướng Thị trường
      Horizontal SaaS
      Vertical SaaS
</pre>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-saas-mindmap-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: 4 cách phân loại của mô hình kinh doanh SaaS
</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb1" data-startfrom="118" data-source-offset="-68" style="background: #f1f3f5;"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 117;"><span id="cb1-118">companies <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [</span>
<span id="cb1-119">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Công ty lớn</span></span>
<span id="cb1-120">  {<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">name</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Salesforce"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">marketCap</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">280</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">sales</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Enterprise"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">growth</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Sales-Led"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">pricing</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Tiered"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">market</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Horizontal"</span>}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-121">  {<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">name</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Microsoft 365"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">marketCap</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">350</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">sales</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Enterprise"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">growth</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Hybrid"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">pricing</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Per-User"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">market</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Horizontal"</span>}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-122">  {<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">name</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"SAP"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">marketCap</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">200</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">sales</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Enterprise"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">growth</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Sales-Led"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">pricing</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Tiered"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">market</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Horizontal"</span>}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-123">  {<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">name</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Oracle"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">marketCap</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">220</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">sales</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Enterprise"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">growth</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Sales-Led"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">pricing</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Tiered"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">market</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Horizontal"</span>}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-124">  {<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">name</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Workday"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">marketCap</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">60</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">sales</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Enterprise"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">growth</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Sales-Led"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">pricing</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Per-User"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">market</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Horizontal"</span>}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-125">  {<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">name</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ServiceNow"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">marketCap</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">150</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">sales</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Enterprise"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">growth</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Sales-Led"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">pricing</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Per-User"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">market</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Horizontal"</span>}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-126">  {<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">name</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Adobe CC"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">marketCap</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">180</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">sales</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Transactional"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">growth</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Hybrid"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">pricing</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Flat-Rate"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">market</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Horizontal"</span>}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-127">  </span>
<span id="cb1-128">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Công ty trung bình</span></span>
<span id="cb1-129">  {<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">name</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Zoom"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">marketCap</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">sales</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Transactional"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">growth</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Product-Led"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">pricing</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Per-User"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">market</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Horizontal"</span>}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-130">  {<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">name</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Slack"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">marketCap</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">25</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">sales</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Transactional"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">growth</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Product-Led"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">pricing</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Per-User"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">market</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Horizontal"</span>}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-131">  {<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">name</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Dropbox"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">marketCap</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">sales</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Self-Service"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">growth</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Product-Led"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">pricing</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Freemium"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">market</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Horizontal"</span>}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-132">  {<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">name</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"HubSpot"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">marketCap</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">sales</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Transactional"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">growth</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Marketing-Led"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">pricing</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Tiered"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">market</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Horizontal"</span>}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-133">  {<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">name</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Atlassian"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">marketCap</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">45</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">sales</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Transactional"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">growth</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Hybrid"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">pricing</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Tiered"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">market</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Horizontal"</span>}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-134">  {<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">name</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Datadog"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">marketCap</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">35</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">sales</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Transactional"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">growth</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Hybrid"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">pricing</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Usage-Based"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">market</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Horizontal"</span>}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-135">  {<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">name</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Snowflake"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">marketCap</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">sales</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Enterprise"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">growth</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Sales-Led"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">pricing</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Usage-Based"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">market</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Horizontal"</span>}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-136">  {<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">name</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Shopify"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">marketCap</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">90</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">sales</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Self-Service"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">growth</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Product-Led"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">pricing</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Transactional"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">market</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Vertical"</span>}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-137">  {<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">name</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Twilio"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">marketCap</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">sales</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Self-Service"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">growth</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Product-Led"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">pricing</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Usage-Based"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">market</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Horizontal"</span>}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-138">  {<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">name</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Stripe"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">marketCap</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">65</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">sales</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Self-Service"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">growth</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Product-Led"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">pricing</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Transactional"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">market</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Horizontal"</span>}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-139">  </span>
<span id="cb1-140">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Công ty nhỏ / Tăng trưởng</span></span>
<span id="cb1-141">  {<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">name</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Figma"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">marketCap</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">sales</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Self-Service"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">growth</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Product-Led"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">pricing</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Freemium"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">market</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Horizontal"</span>}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-142">  {<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">name</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Notion"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">marketCap</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">sales</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Self-Service"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">growth</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Product-Led"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">pricing</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Freemium"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">market</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Horizontal"</span>}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-143">  {<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">name</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Canva"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">marketCap</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">26</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">sales</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Self-Service"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">growth</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Product-Led"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">pricing</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Freemium"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">market</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Horizontal"</span>}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-144">  {<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">name</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Miro"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">marketCap</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">17</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">sales</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Self-Service"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">growth</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Product-Led"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">pricing</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Freemium"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">market</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Horizontal"</span>}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-145">  {<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">name</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Asana"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">marketCap</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">sales</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Transactional"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">growth</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Product-Led"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">pricing</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Per-User"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">market</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Horizontal"</span>}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-146">  {<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">name</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Monday.com"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">marketCap</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">sales</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Self-Service"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">growth</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Product-Led"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">pricing</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Per-User"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">market</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Horizontal"</span>}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-147">  {<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">name</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Airtable"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">marketCap</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">sales</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Self-Service"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">growth</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Hybrid"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">pricing</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Freemium"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">market</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Horizontal"</span>}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-148">  {<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">name</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"GitLab"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">marketCap</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">sales</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Transactional"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">growth</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Hybrid"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">pricing</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Tiered"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">market</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Horizontal"</span>}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-149">  {<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">name</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Loom"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">marketCap</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">sales</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Self-Service"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">growth</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Product-Led"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">pricing</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Freemium"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">market</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Horizontal"</span>}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-150">  {<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">name</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Calendly"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">marketCap</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">sales</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Self-Service"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">growth</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Product-Led"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">pricing</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Freemium"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">market</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Horizontal"</span>}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-151">  {<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">name</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Grammarly"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">marketCap</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">13</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">sales</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Self-Service"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">growth</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Product-Led"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">pricing</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Freemium"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">market</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Horizontal"</span>}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-152">  {<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">name</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Mailchimp"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">marketCap</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">sales</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Self-Service"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">growth</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Marketing-Led"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">pricing</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Tiered"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">market</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Horizontal"</span>}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-153">  {<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">name</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Zendesk"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">marketCap</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">sales</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Transactional"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">growth</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Marketing-Led"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">pricing</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Tiered"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">market</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Horizontal"</span>}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-154">  {<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">name</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Intercom"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">marketCap</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">sales</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Transactional"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">growth</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Product-Led"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">pricing</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Hybrid"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">market</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Horizontal"</span>}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-155">  {<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">name</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Zapier"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">marketCap</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">sales</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Self-Service"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">growth</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Product-Led"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">pricing</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Tiered"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">market</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Horizontal"</span>}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-156">  {<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">name</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Webflow"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">marketCap</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">sales</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Self-Service"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">growth</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Product-Led"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">pricing</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Tiered"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">market</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Horizontal"</span>}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-157">  {<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">name</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"SendGrid"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">marketCap</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">sales</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Self-Service"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">growth</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Product-Led"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">pricing</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Usage-Based"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">market</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Horizontal"</span>}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-158">  {<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">name</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Trello"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">marketCap</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">sales</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Self-Service"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">growth</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Product-Led"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">pricing</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Freemium"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">market</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Horizontal"</span>}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-159">  {<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">name</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Basecamp"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">marketCap</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">sales</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Self-Service"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">growth</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Marketing-Led"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">pricing</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Flat-Rate"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">market</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Horizontal"</span>}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-160">  </span>
<span id="cb1-161">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Vertical SaaS</span></span>
<span id="cb1-162">  {<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">name</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Veeva"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">marketCap</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">sales</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Enterprise"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">growth</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Sales-Led"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">pricing</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Per-User"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">market</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Vertical"</span>}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-163">  {<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">name</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Toast"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">marketCap</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">sales</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Transactional"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">growth</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Sales-Led"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">pricing</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Transactional"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">market</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Vertical"</span>}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-164">  {<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">name</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Procore"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">marketCap</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">sales</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Enterprise"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">growth</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Sales-Led"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">pricing</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Tiered"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">market</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Vertical"</span>}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-165">  {<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">name</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Mindbody"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">marketCap</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">sales</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Transactional"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">growth</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Sales-Led"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">pricing</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Tiered"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">market</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Vertical"</span>}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-166">  </span>
<span id="cb1-167">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Payment/Fintech</span></span>
<span id="cb1-168">  {<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">name</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"PayPal"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">marketCap</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">70</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">sales</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Self-Service"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">growth</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Product-Led"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">pricing</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Transactional"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">market</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Horizontal"</span>}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-169">  {<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">name</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Square"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">marketCap</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">45</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">sales</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Self-Service"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">growth</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Product-Led"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">pricing</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Transactional"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">market</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Horizontal"</span>}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-170">  </span>
<span id="cb1-171">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Cloud Infrastructure</span></span>
<span id="cb1-172">  {<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">name</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AWS"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">marketCap</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">400</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">sales</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Transactional"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">growth</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Hybrid"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">pricing</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Usage-Based"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">market</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Horizontal"</span>}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-173">  {<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">name</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Google Cloud"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">marketCap</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">150</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">sales</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Transactional"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">growth</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Hybrid"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">pricing</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Per-User"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">market</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Horizontal"</span>}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-174">  {<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">name</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"GitHub"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">marketCap</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">7.5</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">sales</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Self-Service"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">growth</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Product-Led"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">pricing</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Hybrid"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">market</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Horizontal"</span>}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-175">]</span>
<span id="cb1-176"></span>
<span id="cb1-177"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Cấu hình các danh mục</span></span>
<span id="cb1-178">categories <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ({</span>
<span id="cb1-179">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">sales</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> {</span>
<span id="cb1-180">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">title</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Mô Hình Bán Hàng và Tiếp Cận Thị Trường"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-181">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">subtitle</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Sales and Go-to-Market Model"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-182">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">field</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sales"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-183">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">segments</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Self-Service"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Transactional"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Enterprise"</span>]<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-184">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">colors</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#22c55e"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#3b82f6"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#8b5cf6"</span>]<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-185">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">descriptions</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> {</span>
<span id="cb1-186">      <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Self-Service"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ACV &lt; $5K • Tự động hóa"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-187">      <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Transactional"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ACV $5K-$50K • Inside sales"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-188">      <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Enterprise"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ACV &gt; $50K • Field sales"</span></span>
<span id="cb1-189">    }</span>
<span id="cb1-190">  }<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-191">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">growth</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> {</span>
<span id="cb1-192">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">title</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Chiến Lược Tăng Trưởng và Thu Hút Khách Hàng"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-193">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">subtitle</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Growth Strategy and Acquisition Motion"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-194">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">field</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"growth"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-195">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">segments</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Product-Led"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Sales-Led"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Marketing-Led"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Hybrid"</span>]<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-196">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">colors</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#6366f1"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#f59e0b"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#10b981"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#ec4899"</span>]<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-197">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">descriptions</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> {</span>
<span id="cb1-198">      <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Product-Led"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Sản phẩm là động lực chính"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-199">      <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Sales-Led"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Đội ngũ bán hàng dẫn dắt"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-200">      <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Marketing-Led"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Content &amp; demand gen"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-201">      <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Hybrid"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Kết hợp nhiều chiến lược"</span></span>
<span id="cb1-202">    }</span>
<span id="cb1-203">  }<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-204">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">pricing</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> {</span>
<span id="cb1-205">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">title</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Mô Hình Định Giá và Doanh Thu"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-206">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">subtitle</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Pricing and Revenue Model"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-207">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">field</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pricing"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-208">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">segments</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Freemium"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Per-User"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Usage-Based"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Tiered"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Flat-Rate"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Transactional"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Hybrid"</span>]<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-209">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">colors</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#22c55e"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#3b82f6"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#f59e0b"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#8b5cf6"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#64748b"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#ef4444"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#ec4899"</span>]<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-210">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">descriptions</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> {</span>
<span id="cb1-211">      <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Freemium"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Miễn phí + Premium"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-212">      <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Per-User"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"$/user/tháng"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-213">      <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Usage-Based"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Trả theo sử dụng"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-214">      <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Tiered"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Gói Good-Better-Best"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-215">      <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Flat-Rate"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Một giá cho tất cả"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-216">      <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Transactional"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"% mỗi giao dịch"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-217">      <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Hybrid"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Kết hợp nhiều mô hình"</span></span>
<span id="cb1-218">    }</span>
<span id="cb1-219">  }<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-220">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">market</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> {</span>
<span id="cb1-221">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">title</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Định Hướng Thị Trường và Tiếp Cận Ngành"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-222">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">subtitle</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Market Focus and Industry Approach"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-223">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">field</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"market"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-224">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">segments</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Horizontal"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Vertical"</span>]<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-225">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">colors</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#3b82f6"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#f59e0b"</span>]<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-226">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">descriptions</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> {</span>
<span id="cb1-227">      <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Horizontal"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Đa ngành, đa mục đích"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-228">      <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Vertical"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Chuyên biệt theo ngành"</span></span>
<span id="cb1-229">    }</span>
<span id="cb1-230">  }</span>
<span id="cb1-231">})</span>
<span id="cb1-232"></span>
<span id="cb1-233"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Chọn view</span></span>
<span id="cb1-234">viewof selectedView <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Inputs<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">radio</span>(</span>
<span id="cb1-235">  [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sales"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"growth"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pricing"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"market"</span>]<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-236">  {</span>
<span id="cb1-237">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">value</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"growth"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-238">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">label</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Chọn cách phân loại:"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-239">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">format</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> x <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">=&gt;</span> ({</span>
<span id="cb1-240">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">sales</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"🏪 Mô Hình Bán Hàng"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-241">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">growth</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"🚀 Chiến Lược Tăng Trưởng"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> </span>
<span id="cb1-242">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">pricing</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"💰 Mô Hình Định Giá"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-243">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">market</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"🎯 Định Hướng Thị Trường"</span></span>
<span id="cb1-244">    })[x]</span>
<span id="cb1-245">  }</span>
<span id="cb1-246">)</span>
<span id="cb1-247"></span>
<span id="cb1-248">currentCat <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> categories[selectedView]</span></code></pre></div></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-4" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb2" data-startfrom="252" data-source-offset="0" style="background: #f1f3f5;"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 251;"><span id="cb2-252">chart <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {</span>
<span id="cb2-253">  <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">const</span> segments <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> currentCat<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">segments</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb2-254">  <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">const</span> field <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> currentCat<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">field</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb2-255">  <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">const</span> colors <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> currentCat<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colors</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb2-256">  </span>
<span id="cb2-257">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Calculate max companies in any segment to determine row height</span></span>
<span id="cb2-258">  <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">const</span> grouped <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> d3<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group</span>(companies<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> d <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">=&gt;</span> d[field])<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb2-259">  </span>
<span id="cb2-260">  <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">const</span> width <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">800</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb2-261">  <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">const</span> headerHeight <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">70</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb2-262">  <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">const</span> rowHeaderHeight <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb2-263">  <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">const</span> bubbleRowHeight <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">70</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Height per bubble row</span></span>
<span id="cb2-264">  <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">const</span> padding <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb2-265">  </span>
<span id="cb2-266">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Calculate how many bubble rows needed for each segment</span></span>
<span id="cb2-267">  <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">const</span> getRowsNeeded <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (segCompanies) <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">=&gt;</span> {</span>
<span id="cb2-268">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">const</span> maxBubblesPerRow <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb2-269">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">Math</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ceil</span>(segCompanies<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">length</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> maxBubblesPerRow)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb2-270">  }<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb2-271">  </span>
<span id="cb2-272">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Calculate total height for each segment</span></span>
<span id="cb2-273">  <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">const</span> segmentHeights <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> segments<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map</span>(seg <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">=&gt;</span> {</span>
<span id="cb2-274">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">const</span> segCompanies <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> grouped<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get</span>(seg) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">||</span> []<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb2-275">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">const</span> rowsNeeded <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">getRowsNeeded</span>(segCompanies)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb2-276">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> rowHeaderHeight <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> rowsNeeded <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> bubbleRowHeight<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb2-277">  })<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb2-278">  <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">const</span> height <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> headerHeight <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> d3<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(segmentHeights) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb2-279">  </span>
<span id="cb2-280">  <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">const</span> colorScale <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> d3<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scaleOrdinal</span>()<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">domain</span>(segments)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">range</span>(colors)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb2-281">  </span>
<span id="cb2-282">  <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">const</span> svg <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> d3<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">create</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"svg"</span>)</span>
<span id="cb2-283">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">attr</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"viewBox"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> width<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> height])</span>
<span id="cb2-284">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">attr</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"style"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"max-width: 100%; height: auto; font-family: 'Inter', system-ui, sans-serif;"</span>)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb2-285">  </span>
<span id="cb2-286">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Background</span></span>
<span id="cb2-287">  svg<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">append</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"rect"</span>)</span>
<span id="cb2-288">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">attr</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"width"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> width)</span>
<span id="cb2-289">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">attr</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"height"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> height)</span>
<span id="cb2-290">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">attr</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fill"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#f3f3f3"</span>)</span>
<span id="cb2-291">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">attr</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"rx"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb2-292">  </span>
<span id="cb2-293">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Title</span></span>
<span id="cb2-294">  svg<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">append</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text"</span>)</span>
<span id="cb2-295">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">attr</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> width <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb2-296">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">attr</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"y"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">28</span>)</span>
<span id="cb2-297">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">attr</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text-anchor"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"middle"</span>)</span>
<span id="cb2-298">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">attr</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fill"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#0062ec"</span>)</span>
<span id="cb2-299">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">attr</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"font-size"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">18</span>)</span>
<span id="cb2-300">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">attr</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"font-weight"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">700</span>)</span>
<span id="cb2-301">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">text</span>(currentCat<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title</span>)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb2-302">  </span>
<span id="cb2-303">  svg<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">append</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text"</span>)</span>
<span id="cb2-304">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">attr</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> width <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb2-305">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">attr</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"y"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">48</span>)</span>
<span id="cb2-306">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">attr</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text-anchor"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"middle"</span>)</span>
<span id="cb2-307">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">attr</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fill"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#0062ec"</span>)</span>
<span id="cb2-308">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">attr</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"font-size"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">13</span>)</span>
<span id="cb2-309">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">text</span>(currentCat<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">subtitle</span>)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb2-310">  </span>
<span id="cb2-311">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Size scale</span></span>
<span id="cb2-312">  <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">const</span> sizeScale <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> d3<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scaleSqrt</span>()</span>
<span id="cb2-313">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">domain</span>([<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> d3<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">max</span>(companies<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> d <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">=&gt;</span> d<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">marketCap</span>)])</span>
<span id="cb2-314">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">range</span>([<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">32</span>])<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb2-315">  </span>
<span id="cb2-316">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Tooltip (create once)</span></span>
<span id="cb2-317">  <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">const</span> tooltip <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> svg<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">append</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"g"</span>)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">style</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"display"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span>)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">style</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pointer-events"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span>)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb2-318">  tooltip<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">append</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"rect"</span>)</span>
<span id="cb2-319">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">attr</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fill"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#1e293b"</span>)</span>
<span id="cb2-320">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">attr</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"rx"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)</span>
<span id="cb2-321">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">attr</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"stroke"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#475569"</span>)</span>
<span id="cb2-322">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">attr</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"stroke-width"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb2-323">  <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">const</span> tooltipText <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> tooltip<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">append</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text"</span>)</span>
<span id="cb2-324">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">attr</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fill"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"white"</span>)</span>
<span id="cb2-325">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">attr</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"font-size"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span>)</span>
<span id="cb2-326">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">attr</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text-anchor"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"middle"</span>)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb2-327">  </span>
<span id="cb2-328">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Draw each segment as a ROW (stacked vertically)</span></span>
<span id="cb2-329">  <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">let</span> cumulativeY <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> headerHeight<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb2-330">  </span>
<span id="cb2-331">  segments<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">forEach</span>((seg<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> rowIdx) <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">=&gt;</span> {</span>
<span id="cb2-332">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">const</span> rowY <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> cumulativeY<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb2-333">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">const</span> segCompanies <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> grouped<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get</span>(seg) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">||</span> []<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb2-334">    segCompanies<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sort</span>((a<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> b) <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">=&gt;</span> b<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">marketCap</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> a<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">marketCap</span>)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb2-335">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">const</span> currentSegmentHeight <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> segmentHeights[rowIdx]<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb2-336">    </span>
<span id="cb2-337">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Row background</span></span>
<span id="cb2-338">    svg<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">append</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"rect"</span>)</span>
<span id="cb2-339">      <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">attr</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>)</span>
<span id="cb2-340">      <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">attr</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"y"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> rowY <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)</span>
<span id="cb2-341">      <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">attr</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"width"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> width <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>)</span>
<span id="cb2-342">      <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">attr</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"height"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> currentSegmentHeight <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>)</span>
<span id="cb2-343">      <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">attr</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fill"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colorScale</span>(seg))</span>
<span id="cb2-344">      <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">attr</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"opacity"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.06</span>)</span>
<span id="cb2-345">      <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">attr</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"rx"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb2-346">    </span>
<span id="cb2-347">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Segment header (centered at top of row)</span></span>
<span id="cb2-348">    svg<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">append</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text"</span>)</span>
<span id="cb2-349">      <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">attr</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> width <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb2-350">      <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">attr</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"y"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> rowY <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">25</span>)</span>
<span id="cb2-351">      <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">attr</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text-anchor"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"middle"</span>)</span>
<span id="cb2-352">      <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">attr</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fill"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colorScale</span>(seg))</span>
<span id="cb2-353">      <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">attr</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"font-size"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span>)</span>
<span id="cb2-354">      <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">attr</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"font-weight"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">600</span>)</span>
<span id="cb2-355">      <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">text</span>(seg)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb2-356">    </span>
<span id="cb2-357">    svg<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">append</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text"</span>)</span>
<span id="cb2-358">      <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">attr</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> width <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb2-359">      <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">attr</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"y"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> rowY <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">42</span>)</span>
<span id="cb2-360">      <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">attr</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text-anchor"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"middle"</span>)</span>
<span id="cb2-361">      <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">attr</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fill"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#64748b"</span>)</span>
<span id="cb2-362">      <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">attr</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"font-size"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>)</span>
<span id="cb2-363">      <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">text</span>(currentCat<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">descriptions</span>[seg])<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb2-364">    </span>
<span id="cb2-365">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Bubbles - wrap to multiple rows if needed</span></span>
<span id="cb2-366">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">const</span> maxBubblesPerRow <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb2-367">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">const</span> bubbleAreaWidth <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> width <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">60</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb2-368">    </span>
<span id="cb2-369">    segCompanies<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">forEach</span>((company<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> i) <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">=&gt;</span> {</span>
<span id="cb2-370">      <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">const</span> bubbleRowIndex <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">Math</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">floor</span>(i <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> maxBubblesPerRow)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb2-371">      <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">const</span> indexInRow <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> i <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span> maxBubblesPerRow<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb2-372">      <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">const</span> companiesInThisRow <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">Math</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">min</span>(maxBubblesPerRow<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> segCompanies<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">length</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> bubbleRowIndex <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> maxBubblesPerRow)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb2-373">      </span>
<span id="cb2-374">      <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">const</span> r <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sizeScale</span>(company<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">marketCap</span>)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb2-375">      <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">const</span> bubbleY <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> rowY <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> rowHeaderHeight <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> bubbleRowIndex <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> bubbleRowHeight <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">35</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb2-376">      <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">const</span> spacing <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> bubbleAreaWidth <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (companiesInThisRow <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb2-377">      <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">const</span> x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> spacing <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (indexInRow <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb2-378">      </span>
<span id="cb2-379">      <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">const</span> g <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> svg<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">append</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"g"</span>)</span>
<span id="cb2-380">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">attr</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"transform"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">`translate(</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">${</span>x<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">, </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">${</span>bubbleY<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">)`</span>)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb2-381">      </span>
<span id="cb2-382">      <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Bubble</span></span>
<span id="cb2-383">      g<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">append</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"circle"</span>)</span>
<span id="cb2-384">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">attr</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"r"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> r)</span>
<span id="cb2-385">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">attr</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fill"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colorScale</span>(seg))</span>
<span id="cb2-386">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">attr</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"opacity"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.85</span>)</span>
<span id="cb2-387">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">attr</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"stroke"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colorScale</span>(seg))</span>
<span id="cb2-388">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">attr</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"stroke-width"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span>)</span>
<span id="cb2-389">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">style</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cursor"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pointer"</span>)</span>
<span id="cb2-390">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">on</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mouseenter"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">event</span>) {</span>
<span id="cb2-391">          d3<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">this</span>)</span>
<span id="cb2-392">            <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">transition</span>()<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">duration</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">150</span>)</span>
<span id="cb2-393">            <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">attr</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"opacity"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb2-394">            <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">attr</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"stroke-width"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)</span>
<span id="cb2-395">            <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">attr</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"r"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> r <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.1</span>)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb2-396">          </span>
<span id="cb2-397">          tooltip<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">style</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"display"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">null</span>)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb2-398">          tooltipText<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">text</span>(<span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">${</span>company<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;"> • $</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">${</span>company<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">marketCap</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">B`</span>)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb2-399">          <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">const</span> bbox <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> tooltipText<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">node</span>()<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">getBBox</span>()<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb2-400">          tooltip<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"rect"</span>)</span>
<span id="cb2-401">            <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">attr</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> bbox<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>)</span>
<span id="cb2-402">            <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">attr</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"y"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> bbox<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>)</span>
<span id="cb2-403">            <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">attr</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"width"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> bbox<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">width</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>)</span>
<span id="cb2-404">            <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">attr</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"height"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> bbox<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">height</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb2-405">          tooltip<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">attr</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"transform"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">`translate(</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">${</span>x<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">, </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">${</span>bubbleY <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> r <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">)`</span>)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb2-406">        })</span>
<span id="cb2-407">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">on</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mouseleave"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>() {</span>
<span id="cb2-408">          d3<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">this</span>)</span>
<span id="cb2-409">            <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">transition</span>()<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">duration</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">150</span>)</span>
<span id="cb2-410">            <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">attr</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"opacity"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.85</span>)</span>
<span id="cb2-411">            <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">attr</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"stroke-width"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span>)</span>
<span id="cb2-412">            <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">attr</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"r"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> r)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb2-413">          tooltip<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">style</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"display"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span>)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb2-414">        })<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb2-415">      </span>
<span id="cb2-416">      <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Company name inside bubble (only if big enough)</span></span>
<span id="cb2-417">      <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> (r <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span>) {</span>
<span id="cb2-418">        g<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">append</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text"</span>)</span>
<span id="cb2-419">          <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">attr</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text-anchor"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"middle"</span>)</span>
<span id="cb2-420">          <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">attr</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dy"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"0.35em"</span>)</span>
<span id="cb2-421">          <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">attr</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fill"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"white"</span>)</span>
<span id="cb2-422">          <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">attr</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"font-size"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">Math</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">min</span>(r <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.45</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>))</span>
<span id="cb2-423">          <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">attr</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"font-weight"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">500</span>)</span>
<span id="cb2-424">          <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">style</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pointer-events"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span>)</span>
<span id="cb2-425">          <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">text</span>(company<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">length</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">?</span> company<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">slice</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">".."</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> company<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name</span>)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb2-426">      }</span>
<span id="cb2-427">    })<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb2-428">    </span>
<span id="cb2-429">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Update cumulative Y for next segment</span></span>
<span id="cb2-430">    cumulativeY <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+=</span> currentSegmentHeight<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb2-431">  })<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb2-432">  </span>
<span id="cb2-433">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Legend at bottom</span></span>
<span id="cb2-434">  svg<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">append</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text"</span>)</span>
<span id="cb2-435">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">attr</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>)</span>
<span id="cb2-436">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">attr</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"y"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> height <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>)</span>
<span id="cb2-437">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">attr</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fill"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#64748b"</span>)</span>
<span id="cb2-438">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">attr</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"font-size"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>)</span>
<span id="cb2-439">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">text</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Kích thước bubble = Market Cap (tỷ USD)"</span>)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb2-440">  </span>
<span id="cb2-441">  <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> svg<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">node</span>()<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb2-442">}</span></code></pre></div></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-2" data-nodetype="declaration">

</div>
</div>
</div>
</section>
<section id="mô-hình-bán-hàng-và-tiếp-cận-thị-trường" class="level2">
<h2 class="anchored" data-anchor-id="mô-hình-bán-hàng-và-tiếp-cận-thị-trường">1. Mô Hình Bán Hàng và Tiếp Cận Thị Trường</h2>
<p><em>(Sales and Go-to-Market Model)</em></p>
<p>Định nghĩa: Cách bạn bán hàng và tiếp cận khách hàng. Mô hình này thường được quy định bởi Giá trị hợp đồng hàng năm (ACV).</p>
<blockquote class="blockquote">
<p><strong>Nguồn tham khảo và Tài liệu chuyên sâu:</strong></p>
<ul>
<li><a href="https://www.zoominfo.com/solutions/sales"><strong>ZoomInfo</strong></a>: Nền tảng dữ liệu B2B và trí tuệ doanh nghiệp (GTM Intelligence) hàng đầu thế giới. Đây là “tiêu chuẩn vàng” về dữ liệu khách hàng mà các đội ngũ Sales/Marketing tại các tập đoàn lớn (Enterprise) sử dụng để xây dựng chiến lược tiếp cận thị trường.</li>
<li><a href="https://stripe.com/guides/atlas/business-of-saas"><strong>Stripe Atlas - Business of SaaS</strong></a>: Chương trình khởi nghiệp của Stripe - nền tảng thanh toán lớn nhất cho kinh tế Internet. Tài liệu từ Stripe Atlas được tổng hợp từ dữ liệu thực tế của hàng triệu startup và là “sách gối đầu giường” cho các founder khi bắt đầu xây dựng mô hình tài chính.</li>
<li><a href="https://www.hubifi.com/blog/b2b-saas-business-model"><strong>HubiFi - B2B SaaS Guide</strong></a>: Đơn vị chuyên cung cấp giải pháp CFO ảo và tự động hóa tài chính cho các công ty SaaS. Các bài viết của HubiFi đi sâu vào chi tiết kỹ thuật vận hành, các chỉ số tài chính (metrics) và cấu trúc lợi nhuận cụ thể cho mô hình B2B.</li>
</ul>
</blockquote>
<table class="caption-top table">
<colgroup>
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Loại mô hình</th>
<th style="text-align: left;">Benchmark ACV (Giá trị HĐ/năm)</th>
<th style="text-align: left;">Đặc điểm Vận hành</th>
<th style="text-align: left;">Ví dụ Điển hình</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><strong>Self-Service</strong><br>(Tự phục vụ)</td>
<td style="text-align: left;"><strong>Thế giới:</strong> &lt; $1,000<br><strong>Việt Nam:</strong> &lt; 2 triệu VNĐ</td>
<td style="text-align: left;">Ít tương tác, tự động hóa hoàn toàn (Product-led). Khách hàng tự đăng ký, dùng thử và thanh toán qua cổng online.</td>
<td style="text-align: left;"><strong>QT:</strong> Canva, Notion, Zoom (Pro)<br><strong>VN:</strong> Skindex AI, LadiPage (Starter), Elsa Speak</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Transactional</strong><br>(Giao dịch)</td>
<td style="text-align: left;"><strong>Thế giới:</strong> $1k - $100k<br><strong>Việt Nam:</strong> 2tr - 200 triệu VNĐ</td>
<td style="text-align: left;">Đội ngũ sales nội bộ (Inside Sales/Telesales), quy trình bán hàng ngắn (2 tuần - 2 tháng), hợp đồng chuẩn hóa.</td>
<td style="text-align: left;"><strong>QT:</strong> HubSpot (Pro), Zendesk<br><strong>VN:</strong> KiotViet, Base.vn, MISA AMIS</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>Enterprise</strong><br>(Doanh nghiệp lớn)</td>
<td style="text-align: left;"><strong>Thế giới:</strong> &gt; $100,000<br><strong>Việt Nam:</strong> &gt; 200 triệu VNĐ</td>
<td style="text-align: left;">Tương tác cao (High-touch), đội ngũ Field Sales gặp trực tiếp. Chu kỳ dài (6-12 tháng), đấu thầu, tùy chỉnh sâu.</td>
<td style="text-align: left;"><strong>QT:</strong> Salesforce, Workday, SAP<br><strong>VN:</strong> FPT Smart Cloud, Viettel Solutions, Base (Enterprise)</td>
</tr>
</tbody>
</table>
</section>
<section id="chiến-lược-tăng-trưởng-và-thu-hút-khách-hàng" class="level2">
<h2 class="anchored" data-anchor-id="chiến-lược-tăng-trưởng-và-thu-hút-khách-hàng">2. Chiến Lược Tăng Trưởng và Thu Hút Khách Hàng</h2>
<p><em>(Growth Strategy and Acquisition Motion)</em></p>
<p>Động lực tăng trưởng chính và chiến lược thu hút khách hàng.</p>
<blockquote class="blockquote">
<p><strong>Nguồn tham khảo và Tài liệu chuyên sâu:</strong></p>
<ul>
<li><a href="https://productled.com/blog/product-led-growth-definition"><strong>ProductLed</strong></a>: Cộng đồng và tổ chức đào tạo lớn nhất thế giới chuyên về Product-Led Growth. Wes Bush (nhà sáng lập) là tác giả cuốn sách “Product-Led Growth” - cuốn sách giáo khoa nhập môn cho bất kỳ ai muốn chuyển đổi từ Sales-led sang Product-led.</li>
<li><a href="https://www.paddle.com/resources/product-led-growth"><strong>Paddle (ProfitWell)</strong></a>: Nền tảng hạ tầng thanh toán cho SaaS. Sau khi mua lại ProfitWell, Paddle sở hữu kho dữ liệu khổng lồ về chỉ số tài chính của hơn 30.000 công ty SaaS, giúp các bài phân tích của họ luôn dựa trên số liệu thực tế (data-backed) thay vì lý thuyết suông.</li>
<li><a href="https://openviewpartners.com/blog"><strong>OpenView Partners</strong></a>: Quỹ đầu tư mạo hiểm (VC) được coi là “cha đẻ” đã khai sinh và phổ biến thuật ngữ “Product-Led Growth” ra thị trường. Các báo cáo “SaaS Benchmarks” hàng năm của OpenView là thước đo chuẩn mực (industry standard) để các startup định vị tốc độ tăng trưởng của mình so với thị trường.</li>
</ul>
</blockquote>
<table class="caption-top table">
<colgroup>
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Chiến lược</th>
<th style="text-align: left;">Động lực chính</th>
<th style="text-align: left;">Đặc điểm</th>
<th style="text-align: left;">Ví dụ điển hình</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><strong>Product-Led Growth</strong><br>(PLG)</td>
<td style="text-align: left;">Sản phẩm</td>
<td style="text-align: left;">Mô hình Freemium/Dùng thử, vòng lặp lan truyền (viral loops), onboarding tự phục vụ.</td>
<td style="text-align: left;">Slack, Zoom, Figma, Dropbox</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Sales-Led Growth</strong><br>(SLG)</td>
<td style="text-align: left;">Đội ngũ Bán hàng</td>
<td style="text-align: left;">Yêu cầu Demo trước khi dùng, các thương vụ doanh nghiệp phức tạp, chu kỳ dài.</td>
<td style="text-align: left;">Salesforce, Oracle, SAP, Workday</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>Marketing-Led Growth</strong><br>(MLG)</td>
<td style="text-align: left;">Chiến dịch Marketing</td>
<td style="text-align: left;">Content marketing, SEO, tập trung vào việc tạo Lead (Inbound) để chuyển cho Sales.</td>
<td style="text-align: left;">HubSpot (ban đầu), Mailchimp, SEMrush</td>
</tr>
</tbody>
</table>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Hybrid Motion (Kết hợp)
</div>
</div>
<div class="callout-body-container callout-body">
<p>Xu hướng hiện nay là Product-led cho thu hút khách hàng và Sales-led cho mở rộng (tiếp cận đa kênh). Ví dụ: Atlassian, Datadog, Notion.</p>
</div>
</div>
</section>
<section id="mô-hình-định-giá-và-doanh-thu" class="level2">
<h2 class="anchored" data-anchor-id="mô-hình-định-giá-và-doanh-thu">3. Mô Hình Định Giá và Doanh Thu</h2>
<p><em>(Pricing and Revenue Model)</em></p>
<p>Cách bạn tính phí khách hàng cho phần mềm.</p>
<blockquote class="blockquote">
<p><strong>Nguồn tham khảo và Tài liệu chuyên sâu:</strong></p>
<ul>
<li><strong><a href="https://openviewpartners.com/usage-based-pricing/">OpenView - Usage-Based Pricing</a></strong>: Quỹ đầu tư mạo hiểm (VC) đã định hình và phổ cập khái niệm “Product-Led Growth”. OpenView là tác giả của cuốn “Usage-Based Pricing Playbook” - tài liệu kinh điển được coi là sách giáo khoa cho các công ty SaaS hiện đại muốn chuyển dịch sang mô hình định giá theo mức tiêu thụ (Pay-as-you-go).<br>
</li>
<li><strong><a href="https://www.codica.com/blog/saas-business-model/">Codica - SaaS Business Model</a></strong>: Đơn vị tư vấn và phát triển phần mềm chuyên sâu cho các Startup. Các tài liệu của Codica cung cấp góc nhìn thực chiến (builder’s perspective), giúp phân tích ưu/nhược điểm kỹ thuật của từng mô hình doanh thu và cách lựa chọn chiến lược giá phù hợp ngay từ giai đoạn xây dựng sản phẩm.<br>
</li>
<li><strong><a href="https://learn.g2.com/product-led-saas-pricing">G2 - SaaS Pricing Strategy</a></strong>: Sàn thương mại và đánh giá phần mềm lớn nhất thế giới. Dữ liệu của G2 phản ánh “tiếng nói thị trường” dựa trên hàng triệu đánh giá từ người dùng thật, giúp Data Analyst nắm bắt được các xu hướng định giá đang thịnh hành và được khách hàng chấp nhận rộng rãi nhất.</li>
</ul>
</blockquote>
<table class="caption-top table">
<colgroup>
<col style="width: 33%">
<col style="width: 33%">
<col style="width: 33%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Mô hình</th>
<th style="text-align: left;">Đặc điểm</th>
<th style="text-align: left;">Ví dụ điển hình</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><strong>Freemium</strong></td>
<td style="text-align: left;">Gói miễn phí giới hạn, trả phí cho tính năng cao cấp.</td>
<td style="text-align: left;">Spotify, Slack</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Per-User</strong></td>
<td style="text-align: left;">Tính phí theo đầu người/ghế.</td>
<td style="text-align: left;">Zoom, Microsoft 365</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>Usage-Based</strong></td>
<td style="text-align: left;">Trả tiền theo mức sử dụng (API calls, dung lượng).</td>
<td style="text-align: left;">AWS, Twilio</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Tiered Pricing</strong></td>
<td style="text-align: left;">Các gói theo cấp độ (Tốt / Tốt hơn / Tốt nhất).</td>
<td style="text-align: left;">Mailchimp, Shopify</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>Flat-Rate</strong></td>
<td style="text-align: left;">Một mức giá cố định trọn gói.</td>
<td style="text-align: left;">Basecamp</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Transactional</strong></td>
<td style="text-align: left;">Phí trên mỗi giao dịch.</td>
<td style="text-align: left;">PayPal, Stripe</td>
</tr>
</tbody>
</table>
</section>
<section id="định-hướng-thị-trường-và-tiếp-cận-ngành" class="level2">
<h2 class="anchored" data-anchor-id="định-hướng-thị-trường-và-tiếp-cận-ngành">4. Định Hướng Thị Trường và Tiếp Cận Ngành</h2>
<p><em>(Market Focus and Industry Approach)</em></p>
<blockquote class="blockquote">
<p><strong>Nguồn tham khảo và Tài liệu chuyên sâu:</strong></p>
<ul>
<li><strong><a href="https://flgpartners.com/saas-industry-centric-business-models-horizontal-vertical/">FLG Partners - Horizontal vs Vertical SaaS</a></strong>: Một trong những công ty tư vấn Giám đốc Tài chính (CFO) hàng đầu tại Thung lũng Silicon, chuyên hỗ trợ các startup trong giai đoạn IPO và M&amp;A. Góc nhìn của FLG Partners đặc biệt giá trị vì họ không chỉ phân loại mô hình, mà còn chỉ ra sự khác biệt cốt yếu trong cấu trúc tài chính, chi phí bán hàng (CAC) và tiềm năng lợi nhuận giữa SaaS Chiều ngang (Horizontal) và SaaS Chiều dọc (Vertical).</li>
</ul>
</blockquote>
<table class="caption-top table">
<colgroup>
<col style="width: 33%">
<col style="width: 33%">
<col style="width: 33%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Loại hình</th>
<th style="text-align: left;">Đặc điểm</th>
<th style="text-align: left;">Ví dụ điển hình</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><strong>Horizontal SaaS</strong><br>(SaaS ngang)</td>
<td style="text-align: left;">Phục vụ nhiều ngành với giải pháp đa mục đích.</td>
<td style="text-align: left;">Salesforce, Slack, Zoom, Google Workspace</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Vertical SaaS</strong><br>(SaaS dọc)</td>
<td style="text-align: left;">Giải pháp chuyên biệt cho ngành cụ thể.</td>
<td style="text-align: left;">Veeva (dược phẩm), Toast (nhà hàng), Procore (xây dựng)</td>
</tr>
</tbody>
</table>
</section>
<section id="phân-loại-khác" class="level2">
<h2 class="anchored" data-anchor-id="phân-loại-khác">Phân loại khác</h2>
<p>Ngoài những cách phân loại này, có thể phân loại theo những cách khác như sau (tuy nhiên, những cách này thực tế là chia nhỏ hơn từ những cách trên, nên về phần phân tích metrics chúng ta sẽ không sử dụng)</p>
<section id="phân-khúc-khách-hàng-mục-tiêu" class="level3">
<h3 class="anchored" data-anchor-id="phân-khúc-khách-hàng-mục-tiêu">1. Phân Khúc Khách Hàng Mục Tiêu</h3>
<p><em>(Target Customer Segment)</em></p>
<ul>
<li><strong>B2C (Consumer):</strong> Cá nhân. Giá thấp, số lượng lớn. (Netflix, Canva).</li>
<li><strong>B2B SMB (Small Biz):</strong> 1-100 nhân viên. (QuickBooks, Mailchimp).</li>
<li><strong>B2B Mid-Market:</strong> 100-1,000 nhân viên. (HubSpot, Zendesk).</li>
<li><strong>B2B Enterprise:</strong> &gt;1,000 nhân viên. (Salesforce, Oracle).</li>
</ul>
</section>
<section id="giá-trị-cốt-lõi-và-danh-mục-giải-pháp" class="level3">
<h3 class="anchored" data-anchor-id="giá-trị-cốt-lõi-và-danh-mục-giải-pháp">2. Giá Trị Cốt Lõi và Danh Mục Giải Pháp</h3>
<p><em>(Value Proposition and Solution Category)</em></p>
<p>Chức năng chính và giải pháp mà phần mềm cung cấp.</p>
<ul>
<li><strong>Productivity &amp; Collaboration:</strong> Quản lý công việc, giao tiếp (Slack, Notion).</li>
<li><strong>CRM &amp; Sales:</strong> Quản lý quan hệ khách hàng (Salesforce, HubSpot).</li>
<li><strong>Marketing Automation:</strong> Email, Lead Gen (Mailchimp, Marketo).</li>
<li><strong>HR &amp; Talent:</strong> Tuyển dụng, bảng lương (Workday, BambooHR).</li>
<li><strong>Finance &amp; Accounting:</strong> Kế toán, hóa đơn (QuickBooks, Stripe).</li>
<li><strong>Dev Tools:</strong> Hạ tầng, APIs (AWS, GitHub).</li>
<li><strong>E-commerce:</strong> Bán hàng trực tuyến (Shopify, WooCommerce).</li>
<li><strong>Design Tools:</strong> Thiết kế, sáng tạo (Figma, Canva).</li>
<li><strong>Data Analytics:</strong> BI, kho dữ liệu (Tableau, Snowflake).</li>
<li><strong>Customer Support:</strong> Help desk (Zendesk, Intercom).</li>
</ul>
<hr>
</section>
</section>
<section id="những-điểm-quan-trọng-cần-nhớ" class="level2">
<h2 class="anchored" data-anchor-id="những-điểm-quan-trọng-cần-nhớ">💡 Những Điểm Quan Trọng Cần Nhớ</h2>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="1">
<li><strong>Tiếp cận kết hợp là xu hướng:</strong> Hầu hết các công ty SaaS thành công sử dụng phương pháp kết hợp (ví dụ: PLG để thu hút, Sales-Led để mở rộng).</li>
<li><strong>Kinh tế đơn vị (Unit Economics):</strong> Cách bạn phân loại công ty quyết định cấu trúc chi phí (CAC) và giá trị vòng đời (LTV).</li>
<li><strong>Sự tiến hóa:</strong> Các công ty thường bắt đầu với Self-Service và chuyển dần sang Enterprise khi trưởng thành.</li>
<li><strong>Sự phù hợp của mô hình định giá:</strong> Phải dựa trên “Value Metric” - cách mà khách hàng nhận được giá trị thực sự từ sản phẩm.</li>
</ol>
</div>
</div>
<hr>
</section>
<section id="next-step" class="level2">
<h2 class="anchored" data-anchor-id="next-step">Next step</h2>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Bạn xác định công ty của mình đang có mô hình như thế nào và từ đó tìm ra frameword phân tích phù hợp trong phần 2.</p>
</div>
</div>


</section>

 ]]></description>
  <category>SaaS</category>
  <category>Business Model</category>
  <category>Strategy</category>
  <category>Startup</category>
  <guid>https://pakota159.github.io/posts/saas-metrics-1/</guid>
  <pubDate>Fri, 09 Jan 2026 17:00:00 GMT</pubDate>
  <media:content url="https://pakota159.github.io/img/saas-metrics/saas-framework.png" medium="image" type="image/png"/>
</item>
<item>
  <title>(Hầu như) Tất cả những thứ bạn cần biết về A/B Testing</title>
  <dc:creator>Cuong Pham</dc:creator>
  <link>https://pakota159.github.io/posts/ab-testing/</link>
  <description><![CDATA[ 




<section id="đối-tượng-và-giới-hạn-bài-viết" class="level2">
<h2 class="anchored" data-anchor-id="đối-tượng-và-giới-hạn-bài-viết">Đối tượng và giới hạn bài viết</h2>
<p>Nhờ các góp ý từ bài viết trước, trong bài này mình muốn đề cập đến đối tượng và giới hạn nội dung của bài viết này:</p>
<ul>
<li>Bài viết chủ yếu dành cho những người đã có kiến thức cơ bản về xác suất thống kê, ví dụ kiến thức về kỳ vọng, phương sai, độ lệch chuẩn, biến xác suất ngẫu nhiên, phân phối mật độ xác suất, định lý giới hạn trung tâm, …</li>
<li>Tập trung vào ứng dụng A/B Testing trong UI/UX. Mặc dù A/B Testing có thể được dùng cho những mảng khác, nhưng ở đây mình chỉ ví dụ trong UI/UX, các bạn có thể tự suy ra phương pháp trong những lĩnh vực khác.</li>
<li>Nội dung được viết dựa trên <em>kiến thức và kinh nghiệm của bản thân mình</em>, nên <em>có thể đúng hoặc sai</em> và <em>chỉ mang tính tham khảo</em>. Nếu các bạn thấy có chỗ nào mình viết chưa hợp lý, không chính xác thì hãy bình luận ở cuối bài nhé. Mình cảm ơn.</li>
</ul>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Khi bắt đầu viết bài này, mình mới tìm hiểu lại kỹ về những yếu tố toán học phía sau.</p>
</div>
</div>
</section>
<section id="phân-tích-bài-toán" class="level2">
<h2 class="anchored" data-anchor-id="phân-tích-bài-toán">Phân tích bài toán</h2>
<p>Giả sử, bạn đang là cô-founder (hoặc chú-founder) của 1 start-up nào đó. Sản phẩm của bạn tốt nhưng bạn muốn cải thiện UI-UX của nó để nó có thể tốt hơn.</p>
<p>Muốn làm cho sản phẩm tốt hơn, thì bạn phải biết nó đang <strong>không tốt</strong> ở chỗ nào đã.</p>
<p>Để cho cụ thể, mình sẽ thử phân tích 1 phần UI/UX trang homepage của Lazada. Các phân tích phía sau đều là <em>giả thuyết</em> và <em>mang tính minh hoạ</em> cho ý tưởng.</p>
<section id="từ-dữ-liệu-xác-định-chỉ-số-cần-cải-thiện-xác-định-mục-tiêu" class="level3">
<h3 class="anchored" data-anchor-id="từ-dữ-liệu-xác-định-chỉ-số-cần-cải-thiện-xác-định-mục-tiêu">1. Từ dữ liệu xác định chỉ số cần cải thiện (xác định mục tiêu)</h3>
<p>Trong trang homepage có rất nhiều phần/section khác nhau, và mình sẽ thử tính toán số liệu ở section đầu tiên — cái <strong>banner ở homepage</strong> này.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://pakota159.github.io/img/abtesting/banner.png" class="img-fluid figure-img"></p>
<figcaption>Banner homepage Lazada</figcaption>
</figure>
</div>
<p>Giả sử, bạn vào trong data warehouse của công ty và query ra 2 thông số là <strong>lượt view banner</strong> và <strong>lượt click banner</strong>.</p>
<table class="caption-top table">
<colgroup>
<col style="width: 12%">
<col style="width: 16%">
<col style="width: 17%">
<col style="width: 53%">
</colgroup>
<thead>
<tr class="header">
<th>section</th>
<th>view_count</th>
<th>click_count</th>
<th>click_rate (click_count / view_count)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>banner</td>
<td>150,000</td>
<td>750</td>
<td>0.5%</td>
</tr>
</tbody>
</table>
<p>Tất nhiên, số kia mình bịa ra nên nó hơi cực đoan 1 chút. Ta biết <code>CTR của 1 banner quảng cáo dạng slider là khoảng 1%</code> (mình lấy số từ 1 nghiên cứu của đại học Notre Dame — <a href="https://erikrunyon.com/2013/07/carousel-interaction-stats/">Link tại đây</a>, số này cũng chỉ mang tính tham khảo vì mình không biết số phù hợp trong trường hợp này).</p>
<p>Vì vậy, tỷ lệ click <code>0.5%</code> ở trên là thấp và do đó <strong>mục tiêu là cần tìm cách sửa banner để cải thiện click rate của banner.</strong></p>
</section>
<section id="dựa-vào-kinh-nghiệm-cá-nhân-hoặc-heuristic-evaluation-để-xác-định-vấn-đề" class="level3">
<h3 class="anchored" data-anchor-id="dựa-vào-kinh-nghiệm-cá-nhân-hoặc-heuristic-evaluation-để-xác-định-vấn-đề">2. Dựa vào kinh nghiệm cá nhân hoặc Heuristic Evaluation để xác định vấn đề</h3>
<p>Giờ thì ta cần phân tích xem cái banner đang có vấn đề gì.</p>
<p>Theo mình thì banner đã được:</p>
<ul>
<li>Thiết kế đẹp</li>
<li>Màu sắc hài hoà</li>
<li>Nội dung liên quan đến dịp trung thu sắp tới</li>
<li>Khuyến mãi cũng rõ ràng</li>
</ul>
<p>Tuy nhiên có 1 phần mà tớ cảm thấy hơi có vấn đề là nút CTA (Call-to-Action) <code>Mua Ngay</code>.</p>
<p>Liệu nút CTA có nên đặt ở phần giữa phía dưới (<code>bottom-center</code>) của banner sẽ ổn hơn; hay là ngay dưới dòng khuyến mãi “Sắp sửa chơi trăng” (<code>bottom-left</code>) và chuyển cái hashtag sang bên phải — vì mình cảm thấy người dùng sẽ dễ click vào CTA hơn nếu nó ở giữa hoặc ở ngay phía bên trái (do mắt người sẽ đọc từ trái sang phải); hoặc là chả cần cái nút này nữa.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://pakota159.github.io/img/abtesting/lazada.png" class="img-fluid figure-img"></p>
<figcaption>Phân tích vị trí CTA</figcaption>
</figure>
</div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>Sau tất cả, đó chỉ là suy đoán <strong>cảm tính</strong> của mình, và mình cần 1 căn cứ đáng tin cậy hơn để quyết định vị trí đặt CTA.</p>
</div>
</div>
</section>
<section id="thử-nghiệm" class="level3">
<h3 class="anchored" data-anchor-id="thử-nghiệm">3. Thử nghiệm</h3>
<p>Như vậy, mình đã đưa ra 1 số <em>phán đoán</em> và giờ mình cần thử nghiệm để xem phán đoán nào chính xác. Mình sẽ thử nghiệm với 2 vị trí CTA là <code>bottom-left</code> và <code>bottom-right</code> (những giải pháp khác cũng làm tương tự).</p>
<p>Mình chọn mẫu người dùng với số lượng 10,000 người dùng cho mỗi vị trí:</p>
<ul>
<li><strong>Nhóm A</strong>: 10,000 người dùng ngẫu nhiên và banner homepage mà những người này nhìn thấy sẽ là CTA đặt ở <code>bottom-right</code></li>
<li><strong>Nhóm B</strong>: 10,000 người ngẫu nhiên (tất nhiên khác với 10,000 người nhóm A) sẽ nhìn thấy CTA đặt ở <code>bottom-left</code></li>
</ul>
<p>Và ta cần xác định CTR của phương án nào tốt hơn, hay là vị trí đặt nút “Mua Ngay” hoàn toàn không ảnh hưởng gì đến CTR.</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th></th>
<th>A (bottom-right)</th>
<th>B (bottom-left)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Number of users</td>
<td>10,000</td>
<td>10,000</td>
</tr>
<tr class="even">
<td>CTR (Click through rate)</td>
<td>??</td>
<td>??</td>
</tr>
</tbody>
</table>
</section>
<section id="thu-thập-dữ-liệu-và-phân-tích" class="level3">
<h3 class="anchored" data-anchor-id="thu-thập-dữ-liệu-và-phân-tích">4. Thu thập dữ liệu và phân tích</h3>
<p>Mình chạy thí nghiệm kia trong khoảng 1 tháng và thu thập được dữ liệu.</p>
<p>Để ví dụ, thì mình sẽ dùng R để fake số:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># nhóm A có 30 bản ghi, giá trị mean là 0.415 và sd là 0.05, phân phối chuẩn</span></span>
<span id="cb1-2">a_group <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.415</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>)</span>
<span id="cb1-3"></span>
<span id="cb1-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># nhóm B cũng có 30 bản ghi, giá trị mean là 0.45 và sd là 0.1, phân phối chuẩn</span></span>
<span id="cb1-5">b_group <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.45</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>)</span></code></pre></div></div>
<p>Giá trị trong 2 vectors trên có thể biểu diễn như ở bảng dưới:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Date</th>
<th>CTR from A (bottom-right)</th>
<th>CTR from B (bottom-left)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1/8/2020</td>
<td>0.493</td>
<td>0.262</td>
</tr>
<tr class="even">
<td>2/8/2020</td>
<td>0.428</td>
<td>0.408</td>
</tr>
<tr class="odd">
<td>3/8/2020</td>
<td>0.463</td>
<td>0.35</td>
</tr>
<tr class="even">
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
<tr class="odd">
<td>29/8/2020</td>
<td>0.452</td>
<td>0.326</td>
</tr>
<tr class="even">
<td>30/8/2020</td>
<td>0.389</td>
<td>0.458</td>
</tr>
</tbody>
</table>
<p>Để dễ hình dung ra dữ liệu này nó như thế nào, chúng ta sẽ <strong>visualize</strong> nó:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">barplot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cbind</span>(a_group, b_group), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">beside=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span></code></pre></div></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://pakota159.github.io/img/abtesting/plot1.png" class="img-fluid figure-img"></p>
<figcaption>So sánh CTR giữa 2 nhóm</figcaption>
</figure>
</div>
<p>Có thể thấy, ngay từ việc “tạo” dữ liệu và đồ thị thì CTR của nhóm A phân tán ít hơn nhóm B (sd nhỏ hơn), nhưng giá trị trung bình cũng nhỏ hơn. Câu hỏi lúc này là dựa vào dữ liệu như trên thì có thể kết luận <strong>CTR trung bình của nhóm B tốt hơn của A không</strong>.</p>
<p>Bài toán được quy về câu hỏi <strong>hypothesis testing</strong> trong thống kê:</p>
<p><strong>Welch’s t-test để kiểm định 2 kỳ vọng <img src="https://latex.codecogs.com/png.latex?%5Cmu_1">, <img src="https://latex.codecogs.com/png.latex?%5Cmu_2"></strong>, ở đây 2 mẫu t-test là <code>a_group</code> và <code>b_group</code> và giả thuyết phương sai 2 mẫu này giống nhau là hợp lý vì…</p>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>Bài viết đang được cập nhật…</p>
</div>
</div>
</section>
</section>
<section id="tài-liệu-tham-khảo" class="level2">
<h2 class="anchored" data-anchor-id="tài-liệu-tham-khảo">Tài liệu tham khảo</h2>
<ol type="1">
<li><p>Một bài viết hay về Banner trên website: <a href="https://medium.com/imagine-ux/do-you-really-need-carousel-banner-offers-running-on-your-homepage-19adf28d2a62">Do you really need carousel banner</a></p></li>
<li><p>Khoá học cơ bản về xác suất thống kê hay nhất mình từng đọc: <a href="https://ocw.mit.edu/courses/mathematics/18-05-introduction-to-probability-and-statistics-spring-2014/">Introduction to Probability and Statistics - MIT</a></p></li>
<li><p>Khoá học Statistical Reasoning của Johns Hopkins School: <a href="http://ocw.jhsph.edu/index.cfm/go/viewCourse/course/StatisticalReasoning1/coursePage/index/">Link here</a></p></li>
<li><p>A/B Testing from lecture of Data 8 course UC Berkeley: <a href="http://data8.org/materials-sp18/lec/lec19PDF.pdf">Lecture 19 - Data 8 course</a></p></li>
<li><p>Một công cụ thú vị của Evan Miller về A/B testing: <a href="https://www.evanmiller.org/ab-testing/t-test.html#!58.175/28.017074/8;33.71/11.841026/10@95">Simulation</a></p></li>
</ol>


</section>

 ]]></description>
  <category>data</category>
  <category>ab-testing</category>
  <category>statistics</category>
  <guid>https://pakota159.github.io/posts/ab-testing/</guid>
  <pubDate>Wed, 09 Sep 2020 17:00:00 GMT</pubDate>
  <media:content url="https://pakota159.github.io/img/abtesting/bg.jpeg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>Các chỉ số quan trọng trong E-commerce</title>
  <dc:creator>Cuong Pham</dc:creator>
  <link>https://pakota159.github.io/posts/ecom-metrics/</link>
  <description><![CDATA[ 




<p>Theo nhiều người đánh giá, bước đầu tiên cũng là bước quan trọng nhất trong phân tích dữ liệu (data analysis) là <strong>đặt câu hỏi</strong>. Chúng ta cần biết điều gì, cần đánh giá những chỉ số nào để biết được những điều đó. Chỉ khi biết được mình đang giải bài toán gì, và cần phân tích chỉ số gì để trả lời bài toán đó thì ta mới có thể làm những bước như thu thập, sàng lọc, phân tích dữ liệu được.</p>
<p>Tuy nhiên, việc đặt câu hỏi này lại phụ thuộc vào mô hình kinh doanh mà bạn đang làm việc, vì mỗi mô hình kinh doanh lại yêu cầu những chỉ số khác nhau. Và sau khi tự mình tìm hiểu, cũng như trải qua 1 thời gian làm việc trong lĩnh vực này, mình tự thấy chưa có 1 bài viết tiếng việt nào tóm tắt và mô tả được những chỉ số mà chúng ta quan tâm trong mô hình kinh doanh thương mại điện tử (E-commerce).</p>
<p>Vì vậy, mình quyết định viết bài này nhằm tổng hợp những điều mình biết, mình tìm hiểu từ trước đến nay để phần nào trả lời được câu hỏi: <strong>trong e-commerce, chúng ta cần quan tâm những chỉ số nào, và tại sao?</strong></p>
<section id="thương-mại-điện-tử-là-gì" class="level2">
<h2 class="anchored" data-anchor-id="thương-mại-điện-tử-là-gì">Thương mại điện tử là gì?</h2>
<p>Hình thức <strong>thương mại điện tử</strong> chủ yếu trên thế giới và cả ở Việt Nam là kinh doanh, <strong>bán hàng trên các nền tảng trực tuyến</strong>. Khách hàng <em>đến trang web</em> của bạn, <em>tìm kiếm sản phẩm</em>, và <em>đặt mua</em>.</p>
<p>Một số nền tảng thương mại điện tử phổ biến tại Việt Nam có thể kể đến: Shopee, Tiki, Lazada, Thế Giới Di Động, Sendo, FPT Shop, …</p>
<p>Điểm chung của các trang trên đó là chúng đều là các nền tảng B2C (từ doanh nghiệp đến cá nhân) và có thể được phân ra làm 2 dạng:</p>
<ul>
<li><strong>Marketplace</strong>: những nền tảng đóng vai trò là trung gian, không có kho hàng như Shopee, Tiki, Lazada, …</li>
<li><strong>Inventory</strong>: những nền tảng có kho hàng, có sản phẩm của chính họ như Thế Giới Di Động, FPT Shop, …</li>
</ul>
<p>2 dạng này chủ yếu chỉ khác nhau về cách thức lưu trữ hàng hoá còn về cơ chế bán hàng trên web/app của họ không có sự khác biệt đáng kể, vì vậy, dù mô hình kinh doanh của bạn có là dạng nào trong 2 dạng trên thì cũng có thể sử dụng những chỉ số dưới đây.</p>
</section>
<section id="tổng-quan" class="level2">
<h2 class="anchored" data-anchor-id="tổng-quan">Tổng quan</h2>
<p>Theo mình, có 4 nhóm chỉ số mà bạn cần quan tâm để đánh giá được nền tảng ecommerce có đang hoạt động ổn không:</p>
<ol type="1">
<li><p><strong>Retention</strong>: việc tái sử dụng dịch vụ, web, app, … của người dùng. Retention có thể là <code>Repurchase Rate</code> - tỷ lệ lặp lại hành vi mua hàng của người dùng, hoặc <code>Churn Rate</code> - tỷ lệ người dùng rời bỏ nền tảng của bạn. Điểm chung của các chỉ số về Retention là bạn sẽ theo dõi 1 nhóm người dùng xác định (1 cohort) và đánh giá xem nhóm người này tiếp tục sử dụng hay rời bỏ nền tảng của bạn như thế nào trong 1 khoảng thời gian nhất định.</p></li>
<li><p><strong>Conversion</strong>: tỷ lệ chuyển đổi. Đây là những chỉ số liên quan đến khả năng chuyển đổi khách hàng từ bước A đến bước B trong luồng người dùng của bạn. Nó có thể là tỷ lệ chuyển đổi của các kênh marketing, hoặc của từng bước trong luồng của web/app.</p></li>
<li><p><strong>Cost</strong>: chi phí. Chi phí ở đây có thể là chi phí để tìm kiếm 1 khách hàng (<code>CAC - Customer acquisition cost</code>) hoặc chi phí trên từng đơn hàng (Cost per Order). Về cơ bản, nó là chi phí mà bạn phải bỏ ra trên 1 đơn vị, bạn cần biết thông số này để so sánh nó với giá trị bạn mang lại, và từ đó đánh giá được mô hình của bạn đang hoạt động có mang lại lợi nhuận hay không.</p></li>
<li><p><strong>Revenue</strong>: doanh thu. Có chi phí thì tất nhiên phải quan tâm đến doanh thu. Revenue ở đây cũng tính trên 1 đơn vị, có thể là <code>Customer Lifetime Value - CLV</code> cho ta biết 1 khách hàng sẽ mang lại bao nhiêu doanh thu trong suốt vòng đời sử dụng. Hoặc có thể tính Average order value, giá trị đơn hàng trung bình để biết trung bình 1 đơn hàng, bạn sẽ có doanh thu bao nhiêu.</p></li>
</ol>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Trong mỗi nhóm chỉ số trên, mình sẽ chỉ lấy ra 1 chỉ số mà mình cảm thấy quan trọng và cần thiết nhất, tuỳ trường hợp mô hình kinh doanh của bạn, chỉ số bạn quan tâm có thể sẽ khác.</p>
</div>
</div>
</section>
<section id="repurchase-rate-rr" class="level2">
<h2 class="anchored" data-anchor-id="repurchase-rate-rr">Repurchase Rate (RR)</h2>
<p>Đối với Retention, mình quyết định chọn Repurchase Rate là chỉ số chính vì hành vi mua hàng là hành vi quan trọng nhất của nền tảng và chỉ số này cũng giúp ta xác định tỷ lệ khách hàng cũ, mới và từ đó hỗ trợ việc đưa ra chiến lược.</p>
<p>Nền tảng của bạn có thể chú trọng vào:</p>
<ul>
<li><strong>Acquisition</strong>: tìm kiếm khách hàng mới</li>
<li><strong>Loyalty</strong>: tập trung vào khách hàng cũ</li>
<li><strong>Hybrid</strong>: đồng thời làm cả 2 việc trên</li>
</ul>
<p>Theo nhìn nhận chủ quan của mình, hầu hết các start-up trong lĩnh vực này sẽ khởi đầu bằng <strong>Acquisition</strong> — họ cố gắng kéo càng nhiều khách hàng mới càng tốt. Sau đó, khi đã có 1 số lượng khách hàng trung thành nhất định, sẽ là trạng thái <strong>Hybrid</strong>, vừa chăm sóc khách hàng cũ, vừa duy trì các chương trình thu hút khách mới (như những chương trình khuyến mãi cho người dùng mới trên Shopee, Tiki, Lazada, …). Cuối cùng, khi nền tảng của bạn trở nên khổng lồ như Amazon, bạn sẽ tập trung cho chương trình <strong>Loyalty</strong>.</p>
<section id="ví-dụ-tính-rr" class="level3">
<h3 class="anchored" data-anchor-id="ví-dụ-tính-rr">Ví dụ tính RR</h3>
<p>Trong database của bạn có 1 bảng thống kê đơn hàng như sau:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 21%">
<col style="width: 17%">
<col style="width: 23%">
<col style="width: 14%">
</colgroup>
<thead>
<tr class="header">
<th>order_id</th>
<th>username</th>
<th>order_completed_at</th>
<th>first_order_at</th>
<th>30_days_since_first</th>
<th>is_30day_RR</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>71</td>
<td>Cuong</td>
<td>2020-07-06 10:23:54</td>
<td>July 2020</td>
<td><strong>2020-08-05</strong></td>
<td>false</td>
</tr>
<tr class="even">
<td>72</td>
<td>Long</td>
<td>2020-07-08 11:24:35</td>
<td>July 2020</td>
<td><strong>2020-08-07</strong></td>
<td>false</td>
</tr>
<tr class="odd">
<td>73</td>
<td>Hoang</td>
<td>2020-07-27 11:25:35</td>
<td>July 2020</td>
<td><strong>2020-08-26</strong></td>
<td>false</td>
</tr>
<tr class="even">
<td>101</td>
<td>Cuong</td>
<td>2020-08-02 10:23:54</td>
<td>July 2020</td>
<td>2020-08-05</td>
<td><code>true</code></td>
</tr>
<tr class="odd">
<td>102</td>
<td>Hoang</td>
<td>2020-08-25 11:22:35</td>
<td>July 2020</td>
<td>2020-08-26</td>
<td><code>true</code></td>
</tr>
<tr class="even">
<td>103</td>
<td>Cuong</td>
<td>2020-09-09 04:20:54</td>
<td>July 2020</td>
<td>2020-08-05</td>
<td>false</td>
</tr>
<tr class="odd">
<td>104</td>
<td>Long</td>
<td>2020-09-09 14:22:35</td>
<td>July 2020</td>
<td>2020-08-07</td>
<td>false</td>
</tr>
</tbody>
</table>
<p>Bảng trên đã được xử lý để cho chúng ta có thể xác định được <strong>cohort</strong> — 1 tập khách hàng có chung 1 hành vi xác định. Ở đây là những <strong>khách hàng có đơn hàng đầu tiên vào tháng 7 năm 2020</strong>. Nói cách khác, đó là những <em>khách hàng mới</em> mà chúng ta kiếm được <em>trong tháng 7</em>, và ghi nhận tất cả các đơn hàng thành công của họ từ lúc bắt đầu (tháng 7) cho đến hiện tại.</p>
<p>Trong số những khách hàng này (3 người), chỉ có 2 người thực hiện 1 đơn hàng khác trong vòng 30 ngày kể từ ngày đầu tiên mua hàng. Để xác định điều đó, chỉ cần so sánh <code>order_completed_at</code> với <code>30_days_since_first</code>, nếu nhỏ hơn thì đó là 1 đơn hàng được thực hiện trong vòng 30 ngày từ ngày đầu tiên mua.</p>
<p>Như vậy, ta có thể nói <strong>30-day repurchase rate</strong> hay <strong>30 days RR</strong> là:</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Ctext%7B30%20days%20RR%7D%20=%20%5Cfrac%7B2%7D%7B3%7D%20=%2066.6%5C%25"></p>
<p>Tương tự, ta có thể tính <strong>15, 30, 90 days RR</strong> — <strong>tỷ lệ khách hàng mua lại trong 15, 30 hay 90 ngày</strong>, tuỳ vào từng trường hợp kinh doanh cụ thể của bạn.</p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>RR là 1 tỷ lệ phụ thuộc vào 2 khoảng thời gian, như trường hợp trên là 30 days RR của <em>tháng 7</em>. Nếu bạn tính cho các tháng khác, hoặc <em>cohort</em> của 1 khoảng thời gian khác (tuần, quý, năm, …) thì kết quả sẽ ra khác.</p>
</div>
</div>
<p>Tỷ lệ này cho chúng ta biết tỷ lệ khách hàng vẫn còn <em>trung thành</em> với sản phẩm của mình:</p>
<ul>
<li><strong>Trên 30%</strong>: nền tảng đang ở trạng thái <strong>Loyalty</strong></li>
<li><strong>15% đến 30%</strong>: trạng thái <strong>Hybrid</strong></li>
<li><strong>Dưới 15%</strong>: trạng thái <strong>Acquisition</strong></li>
</ul>
</section>
</section>
<section id="conversion-rate-cr" class="level2">
<h2 class="anchored" data-anchor-id="conversion-rate-cr">Conversion Rate (CR)</h2>
<p>Tỷ lệ chuyển đổi Conversion Rate là 1 chỉ số đơn giản nhưng được sử dụng rất đa dạng. Về cơ bản, bạn có thể tính tỷ lệ chuyển đổi khách hàng từ bước A đến bước B, với bước A và B có thể là bất cứ bước nào trong luồng người dùng (<strong>user flow</strong>) của bạn.</p>
<p>Ví dụ khách hàng mở app của bạn lên (A), tìm kiếm sản phẩm, thêm vào giỏ hàng (B). Như vậy ta có thể tính trong 100 khách hàng mở app, có bao nhiêu người sẽ đi đến bước thêm vào giỏ hàng.</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Ctext%7BCR%20t%E1%BB%AB%20A%20%C4%91%E1%BA%BFn%20B%7D%20=%20%5Cfrac%7B%5Ctext%7Bs%E1%BB%91%20ng%C6%B0%E1%BB%9Di%20%E1%BB%9F%20b%C6%B0%E1%BB%9Bc%20B%7D%7D%7B%5Ctext%7Bs%E1%BB%91%20ng%C6%B0%E1%BB%9Di%20%E1%BB%9F%20b%C6%B0%E1%BB%9Bc%20A%7D%7D"></p>
<p>Để biết được bạn cần tính <strong>CR</strong> cho bước A nào, B nào, bạn cần xác định rõ <code>user flow</code> của mình.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>Nếu mô hình của bạn tập trung vào <strong>acquisition</strong>, có thể bạn sẽ chấp nhận 1 mức CR <em>thấp hơn</em> 1 mô hình tập trung vào <strong>loyalty</strong>.</li>
<li>Với acquisition, bạn thậm chí sẽ tập trung vào CR của các kênh marketing hơn là CR của luồng người dùng sử dụng trên web/app của bạn.</li>
</ul>
</div>
</div>
</section>
<section id="customer-acquisition-cost-cac" class="level2">
<h2 class="anchored" data-anchor-id="customer-acquisition-cost-cac">Customer Acquisition Cost (CAC)</h2>
<p><strong>CAC</strong> được tính bằng việc lấy chi phí bỏ ra chia cho số lượng khách hàng mới thu về được trong 1 khoảng thời gian.</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Ctext%7BCAC%7D%20=%20%5Cfrac%7B%5Ctext%7BT%E1%BB%95ng%20chi%20ph%C3%AD%20(marketing,%20sale,%20v%E1%BA%ADn%20h%C3%A0nh,%20...)%7D%7D%7B%5Ctext%7BS%E1%BB%91%20ng%C6%B0%E1%BB%9Di%20d%C3%B9ng%20m%E1%BB%9Bi%7D%7D"></p>
<p>Tất nhiên, CAC đối với từng doanh nghiệp, mô hình khác nhau sẽ có những tiêu chuẩn khác nhau. Nếu mô hình acquisition, thì CAC có thể sẽ cao vì bạn tập trung vào việc tìm kiếm khách hàng mới, còn nếu loyalty, thì CAC được kỳ vọng sẽ thấp hơn.</p>
</section>
<section id="lifetime-value-clv-hoặc-ltv" class="level2">
<h2 class="anchored" data-anchor-id="lifetime-value-clv-hoặc-ltv">Lifetime Value (CLV hoặc LTV)</h2>
<p><strong>LTV</strong> là doanh thu mà 1 khách hàng tạo ra trong vòng đời của khách hàng.</p>
<section id="vòng-đời-khách-hàng-lifespan" class="level3">
<h3 class="anchored" data-anchor-id="vòng-đời-khách-hàng-lifespan">Vòng đời khách hàng (Lifespan)</h3>
<p>Vòng đời khách hàng là thời gian trung bình của 1 khách hàng từ lúc mua hàng lần đầu đến khi không còn mua nữa.</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Ctext%7BLifespan%7D%20=%20%5Cfrac%7B%5Ctext%7BT%E1%BB%95ng%20th%E1%BB%9Di%20gian%20t%E1%BB%AB%20l%C3%BAc%20mua%20%C4%91%E1%BA%BFn%20khi%20kh%C3%B4ng%20mua%20n%E1%BB%AFa%7D%7D%7B%5Ctext%7BS%E1%BB%91%20l%C6%B0%E1%BB%A3ng%20kh%C3%A1ch%20h%C3%A0ng%7D%7D"></p>
<p>Tất nhiên, việc thống kê thời gian từ lúc mua hàng đến lúc không còn mua nữa của 1 khách hàng có thể là 1 việc rất khó khăn, có khi thời gian này là vài năm thì bạn không thể chờ vài năm để tính nó được.</p>
<p>Có 1 cách để ước lượng giá trị này là dựa vào <strong>Churn Rate</strong>.</p>
</section>
<section id="churn-rate" class="level3">
<h3 class="anchored" data-anchor-id="churn-rate">Churn Rate</h3>
<p><strong>Churn Rate</strong> là tỷ lệ người không tiếp tục mua hàng trên nền tảng của bạn nữa (thực tế Churn có thể tính cho bất kỳ hành động nào, nhưng ở đây ta xét hành động mua hàng).</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Ctext%7BChurn%20Rate%7D%20=%201%20-%20%5Cfrac%7B%5Ctext%7Bt%E1%BB%95ng%20s%E1%BB%91%20ng%C6%B0%E1%BB%9Di%20mua%20h%C3%A0ng%20th%C3%A1ng%20tr%C6%B0%E1%BB%9Bc%20v%C3%A0%20th%C3%A1ng%20n%C3%A0y%7D%7D%7B%5Ctext%7Bt%E1%BB%95ng%20s%E1%BB%91%20ng%C6%B0%E1%BB%9Di%20mua%20h%C3%A0ng%20th%C3%A1ng%20tr%C6%B0%E1%BB%9Bc%7D%7D"></p>
<p><strong>Ví dụ</strong>: Có 100 người mua hàng vào tháng 7, trong số 100 người này, có 25 người đến tháng 8 vẫn mua tiếp, thì <strong>Churn Rate = 75%</strong>. Ta có thể nói là có 75% người dùng đã không tiếp tục mua hàng vào tháng tiếp theo.</p>
<p>Từ đây có thể ước lượng:</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Ctext%7BAverage%20Lifespan%7D%20=%20%5Cfrac%7B1%7D%7B%5Ctext%7BChurn%20Rate%7D%7D"></p>
<p>Nếu churn rate tính theo tháng, thì AL cũng sẽ tính theo tháng. Như trên thì monthly churn rate là 75%, vậy AL là <img src="https://latex.codecogs.com/png.latex?%5Cfrac%7B100%7D%7B75%7D%20=%201.3"> tháng.</p>
</section>
<section id="tính-ltv" class="level3">
<h3 class="anchored" data-anchor-id="tính-ltv">Tính LTV</h3>
<p>Sau khi tính được thời gian trung bình 1 khách hàng sử dụng nền tảng, ta tính giá trị trung bình mà 1 khách hàng mang lại cho chúng ta.</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Ctext%7BGi%C3%A1%20tr%E1%BB%8B%20trung%20b%C3%ACnh%20c%E1%BB%A7a%20%C4%91%C6%A1n%20h%C3%A0ng%20(AOV)%7D%20=%20%5Cfrac%7B%5Ctext%7BT%E1%BB%95ng%20doanh%20thu%7D%7D%7B%5Ctext%7BT%E1%BB%95ng%20s%E1%BB%91%20%C4%91%C6%A1n%20h%C3%A0ng%7D%7D"></p>
<p>Sau đó, tính số đơn hàng trung bình của 1 khách:</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Ctext%7BS%E1%BB%91%20%C4%91%C6%A1n%20h%C3%A0ng%20trung%20b%C3%ACnh%20c%E1%BB%A7a%201%20kh%C3%A1ch%7D%20=%20%5Cfrac%7B%5Ctext%7BT%E1%BB%95ng%20s%E1%BB%91%20%C4%91%C6%A1n%7D%7D%7B%5Ctext%7BT%E1%BB%95ng%20s%E1%BB%91%20kh%C3%A1ch%7D%7D"></p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Lưu ý là doanh thu và số đơn trên tính trong cùng đơn vị thời gian với churn rate và AL ở trên (tính theo tháng).</p>
</div>
</div>
<p><img src="https://latex.codecogs.com/png.latex?%5Ctext%7BGi%C3%A1%20tr%E1%BB%8B%20mang%20l%E1%BA%A1i%20trung%20b%C3%ACnh%20c%E1%BB%A7a%201%20kh%C3%A1ch%20h%C3%A0ng%7D%20=%20%5Ctext%7BAOV%7D%20%5Ctimes%20%5Ctext%7BS%E1%BB%91%20%C4%91%C6%A1n%20h%C3%A0ng%20trung%20b%C3%ACnh%20c%E1%BB%A7a%201%20kh%C3%A1ch%7D"></p>
<p>Cuối cùng, ta nhân giá trị trên với lifespan để ra LTV:</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Ctext%7BLTV%7D%20=%20%5Ctext%7BGi%C3%A1%20tr%E1%BB%8B%20mang%20l%E1%BA%A1i%20trung%20b%C3%ACnh%20c%E1%BB%A7a%201%20kh%C3%A1ch%20h%C3%A0ng%7D%20%5Ctimes%20%5Ctext%7BV%C3%B2ng%20%C4%91%E1%BB%9Di%20trung%20b%C3%ACnh%7D"></p>
</section>
</section>
<section id="roi-return-on-investment" class="level2">
<h2 class="anchored" data-anchor-id="roi-return-on-investment">ROI (Return on Investment)</h2>
<p>Như vậy, ta đã tính được chi phí để có được 1 khách hàng (CAC) và giá trị trung bình 1 khách hàng mang lại (LTV). Dễ thấy, ta muốn <strong>LTV càng cao càng tốt</strong> còn <strong>CAC thì ngược lại</strong>.</p>
<p>Tỷ lệ <strong>LTV/CAC</strong> cũng là 1 chỉ số quan trọng để đánh giá khả năng tạo ra doanh thu của 1 nền tảng ecommerce, đó là <strong>ROI</strong>:</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Ctext%7BROI%20(Return%20on%20Investment)%7D%20=%20%5Cfrac%7B%5Ctext%7BLTV%7D%7D%7B%5Ctext%7BCAC%7D%7D%20-%201"></p>
</section>
<section id="kết-luận" class="level2">
<h2 class="anchored" data-anchor-id="kết-luận">Kết luận</h2>
<p>Như vậy, mình đã đi qua các chỉ số mà mình nghĩ là quan trọng khi làm phân tích dữ liệu cho 1 nền tảng Ecommerce. Vì là những hiểu biết của bản thân còn hạn chế nên khó tránh khỏi những sai sót. Mong người đọc có thể đóng góp thêm để bài viết có thể được hoàn thiện hơn.</p>
</section>
<section id="tài-liệu-tham-khảo" class="level2">
<h2 class="anchored" data-anchor-id="tài-liệu-tham-khảo">Tài liệu tham khảo</h2>
<ol type="1">
<li>Lean Analytics Book</li>
<li><a href="https://medium.com/@jspanom/how-to-deep-dive-in-your-product-funnel-performance-with-ga-and-data-studio-step-by-step-guide-328d1bbb4dd4">How to deep dive in your product funnel performance with GA and Data Studio</a></li>
<li><a href="https://medium.com/better-marketing/the-marketers-guide-to-customer-acquisition-costs-bf465b5903b0/">The Marketer’s Guide to Customer Acquisition Costs</a></li>
<li><a href="https://medium.com/better-marketing/the-marketers-guide-to-customer-lifetime-value-7f0eb5991098/">The Marketer’s Guide to Customer Lifetime Value</a></li>
<li><a href="https://blog.hubspot.com/service/how-to-calculate-customer-lifetime-value">How to Calculate Customer Lifetime Value</a></li>
</ol>


</section>

 ]]></description>
  <category>metrics</category>
  <category>data</category>
  <category>ecommerce</category>
  <guid>https://pakota159.github.io/posts/ecom-metrics/</guid>
  <pubDate>Tue, 08 Sep 2020 17:00:00 GMT</pubDate>
  <media:content url="https://pakota159.github.io/img/ecommerce/bg.png" medium="image" type="image/png" height="76" width="144"/>
</item>
<item>
  <title>Introduction to Cohort Analysis</title>
  <dc:creator>Cuong Pham</dc:creator>
  <link>https://pakota159.github.io/posts/cohort-analysis/</link>
  <description><![CDATA[ 




<p>The first data analysis technique I have ever learned is <em>Cohort analysis</em>. So what is it and what is it used for?</p>
<p>Imagine you have a fantastic mobile app and it’s your start-up product. You do marketing, invite people to use your app, but after a while you realise the number of active users is decreasing.</p>
<p>How can that happen when you regularly promote and acquire new users to your app?</p>
<p>To answer that question, we need to know:</p>
<ol type="1">
<li><strong>When</strong> do people start to leave your app since the first day they installed it?</li>
<li><strong>Where</strong> do users drop the app — which stage of your user flow is wrong?</li>
</ol>
<p>Cohort analysis is created to answer those questions. So let’s dig deeper into this concept and how to implement it in your application.</p>
<section id="what-is-a-cohort" class="level2">
<h2 class="anchored" data-anchor-id="what-is-a-cohort">What is a Cohort?</h2>
<p>A <strong>cohort</strong> is a group of people who share a common characteristic or experience within a defined period.</p>
<p>For example:</p>
<ul>
<li>People who are born in the same year are a <em>birth cohort</em></li>
<li>Students who graduated in the same year are a <em>graduated cohort</em></li>
<li>People who sign up for the first time in an app on the same day are a <em>sign-up cohort</em></li>
</ul>
<p><strong>Cohort analysis</strong> is a study that focuses on the activities of a particular cohort.</p>
<p>For example, we can do cohort analysis to find how users behave after signing up.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://pakota159.github.io/img/cohort/acquisition.png" class="img-fluid figure-img"></p>
<figcaption>User Acquisition Cohort</figcaption>
</figure>
</div>
</section>
<section id="reading-the-cohort-chart" class="level2">
<h2 class="anchored" data-anchor-id="reading-the-cohort-chart">Reading the Cohort Chart</h2>
<p><strong>Explanation</strong>:</p>
<ul>
<li><p>The users are grouped by <strong>first date signed up</strong>. This means there were <strong>1,098 new users</strong> who signed up for the app on <strong>Jan 25</strong>. Similarly, on Jan 26, there were another <strong>1,358 new users</strong> who signed up.</p></li>
<li><p>The triangle heat map shows us how those user groups behave. In the first row, the group of 1,098 users who registered on Jan 25 stopped using the app the next day (Jan 26) dramatically — dropping by <strong>66.1%</strong> and remaining at only 33.9%. The following day, it got worse when only 23.5% of those 1,098 users were still using the app.</p></li>
</ul>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Important</span>Key Insight
</div>
</div>
<div class="callout-body-container callout-body">
<p>Thanks to the heat map, we can see that after the first day of registration, most groups of users are leaving the app. This answers the question of <strong>when</strong> our customers leave our platform.</p>
<p>The next question is: how do we investigate that first day of using the app to define <strong>why</strong> they stop using it?</p>
</div>
</div>


</section>

 ]]></description>
  <category>sql</category>
  <category>data</category>
  <category>analytics</category>
  <guid>https://pakota159.github.io/posts/cohort-analysis/</guid>
  <pubDate>Sun, 16 Aug 2020 17:00:00 GMT</pubDate>
  <media:content url="https://pakota159.github.io/img/cohort/bg.png" medium="image" type="image/png" height="76" width="144"/>
</item>
<item>
  <title>Understanding Database Indexes</title>
  <dc:creator>Cuong Pham</dc:creator>
  <link>https://pakota159.github.io/posts/index-and-query/</link>
  <description><![CDATA[ 




<p>Well, most developers or people who work with data know that “Index makes query fast” and they also understand why. But for people who don’t really know about indexing, I would like to write this post to introduce them to it.</p>
<p>Furthermore, I also give some notes from my experience and what I have read about SQL optimization. I hope this will be helpful for those who work in the field of data and computer science.</p>
<section id="tree-data-structure" class="level2">
<h2 class="anchored" data-anchor-id="tree-data-structure">Tree Data Structure</h2>
<p><strong>Tree</strong> is a data structure created to improve the efficiency of searching stuff at the cost of low performance of writing/updating.</p>
<p>Imagine we have a list like <code>[2, 4, 7, 6, 11]</code></p>
<p>We want to find <code>number 6</code>. Normally we’ll search one by one from left to right of the list: <code>2 -&gt; 4 -&gt; 7 -&gt; 6</code>. We found it, but if the list has thousands of items, it would take a lot of time to do the <code>search</code> operation like that.</p>
<p>Alternatively, we can use a binary search tree data structure to improve the speed. We basically arrange the order of the items in the list with the rule:</p>
<ul>
<li>Each item is stored in a node</li>
<li>Each node (item) may have left and right child with the condition: <code>left child &lt; item &lt; right child</code></li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://pakota159.github.io/img/sql/img1.png" class="img-fluid figure-img"></p>
<figcaption>Binary Search Tree</figcaption>
</figure>
</div>
<p>With that logic, we don’t have to go through all items to find the number we want.</p>
<p>Start from root (top item). If we want number 6, we compare it with the root node. <code>6 &lt; 7</code> so we go to the left branch (because smaller items are always stored to the left of the parent item). We get <code>number 4</code> and because <code>6 &gt; 4</code> we go to the right of 4.</p>
<p>The time to search/find an item only depends on the <strong>height</strong> of the tree, which is the longest path from root node to any leaf node (other items) in the tree. The bigger the height, the slower the speed to find the item we want.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://pakota159.github.io/img/sql/img2.png" class="img-fluid figure-img"></p>
<figcaption>Tree Height</figcaption>
</figure>
</div>
</section>
<section id="balanced-binary-tree" class="level2">
<h2 class="anchored" data-anchor-id="balanced-binary-tree">Balanced Binary Tree</h2>
<p>A Balanced Binary Tree is simply a Binary search tree as stated above, but the <strong>height</strong> is balanced. This means that for any node of the tree, the left branch height and the right branch height is the same or almost the same (differ no more than 1).</p>
<p><strong>Example</strong>: With the tree in the image below, if we check the node <code>4</code>:</p>
<ul>
<li>Left branch has a height of 1 (contains number 2)</li>
<li>Right branch has a height of 1 (contains number 6)</li>
</ul>
<p>If we check the node <code>7</code>:</p>
<ul>
<li>Left branch has a height of 2</li>
<li>Right branch has a height of 1</li>
<li>Difference: <code>2 - 1 = 1</code></li>
</ul>
<p>The binary tree below is a balanced binary tree.</p>
<p>This kind of tree is used to optimize the speed of searching, because it optimizes the height of the tree (which is the factor that affects the speed of searching).</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://pakota159.github.io/img/sql/img1.png" class="img-fluid figure-img"></p>
<figcaption>Balanced Binary Tree</figcaption>
</figure>
</div>
</section>
<section id="b-tree" class="level2">
<h2 class="anchored" data-anchor-id="b-tree">B-tree</h2>
<p>B-tree is a kind of upgraded Balanced Binary Tree. You can now have multiple items stored in one node (instead of 1 item per node), and each node can have more than 2 children.</p>
<p>As shown in the structure below, we can see each node can have a bulk of data on the left or right. The left bulk contains values which are smaller than the value of the parent node. The right bulk contains values which are bigger than the parent.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://pakota159.github.io/img/sql/img3.png" class="img-fluid figure-img"></p>
<figcaption>B-tree Structure</figcaption>
</figure>
</div>
</section>
<section id="the-index-in-database" class="level2">
<h2 class="anchored" data-anchor-id="the-index-in-database">The Index in Database</h2>
<p>Imagine your table will be stored in database like this:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>ID</th>
<th>author_name</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>001</td>
<td>Gilles van den Hoven</td>
</tr>
<tr class="even">
<td>002</td>
<td>Michael Geary</td>
</tr>
<tr class="odd">
<td>003</td>
<td>Stefan Petre</td>
</tr>
<tr class="even">
<td>004</td>
<td>Yehuda Katz</td>
</tr>
<tr class="odd">
<td>005</td>
<td>Corey Jewett</td>
</tr>
<tr class="even">
<td>006</td>
<td>Klaus Hartl</td>
</tr>
<tr class="odd">
<td>007</td>
<td>Franck Marcia</td>
</tr>
<tr class="even">
<td>008</td>
<td>Jörn Zaefferer</td>
</tr>
<tr class="odd">
<td>009</td>
<td>Paul Bakaus</td>
</tr>
<tr class="even">
<td>010</td>
<td>Brandon Aaron</td>
</tr>
</tbody>
</table>
<p><em>(Authors above are people who contributed to the jQuery library)</em></p>
<p>We want to search the name of the author fast, so we need to add a new table — an <strong>index table</strong> — which contains the data of column <strong>author_name</strong> and organizes that data into a B-tree data structure so the search can be optimized.</p>
<p>The <strong>index of author_name</strong> can be simply expressed like below:</p>
<p>At the root node of the Tree, we store a list of a few <strong>author_name</strong> values, for example: <strong>[Corey Jewett, Michael Geary, Paul Bakaus]</strong>, all <code>sorted by A-Z order</code>.</p>
<p>Then for each value, we create a child node which contains other names that satisfy the rule of B-tree: <code>left node contains all values smaller than parent, right node contains bigger values</code>. In this case, <em>smaller</em> means it comes before in the alphabet.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://pakota159.github.io/img/sql/img4.png" class="img-fluid figure-img"></p>
<figcaption>Index B-tree Structure</figcaption>
</figure>
</div>
<p>When we search for a name like <code>Yehuda Katz</code>, we start from the root. Y is <em>bigger</em> than <em>P</em> in <em>Paul Bakaus</em> so we look up the right node of <em>Paul Bakaus</em>.</p>
<p>In the child node, we do the same thing until we reach the lowest child node. In this lowest node, we do <em>binary search</em> to search the value. The number of values stored in each node is small, so binary search will do the search really fast.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span>Why We Use B-tree
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>We can store data in each node instead of only 1 in a balanced tree, therefore reducing the <em>height</em> of the tree and improving the speed of the search.</li>
<li>Values in each node are sorted in a particular order, therefore we can look up faster. The number of values in each node is small enough so binary search can be quick too.</li>
</ul>
</div>
</div>
</section>
<section id="example-index-performance" class="level2">
<h2 class="anchored" data-anchor-id="example-index-performance">Example: Index Performance</h2>
<p>I will demonstrate the difference between no-index and indexed query performance. The data I use is <em>1.5 million records of sales</em>, and I use PostgreSQL database to store those records.</p>
<section id="without-index" class="level3">
<h3 class="anchored" data-anchor-id="without-index">Without Index</h3>
<p>Before adding an index to the column <code>Item Type</code>, I try the query below, and it returns <code>125,022 records</code> with a speed of <strong>2.244 seconds</strong>.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://pakota159.github.io/img/sql/img5.png" class="img-fluid figure-img"></p>
<figcaption>Query without index</figcaption>
</figure>
</div>
</section>
<section id="with-index" class="level3">
<h3 class="anchored" data-anchor-id="with-index">With Index</h3>
<p>Now, we will add an index to the <code>Item Type</code> column:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb1-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">CREATE</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">INDEX</span> item_type_index <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">ON</span> sale_records (<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">"Item Type"</span>);</span></code></pre></div></div>
<p>That command will run for a while to create a new table which is an <code>index table</code> containing the data of column <code>Item Type</code> with the principle of B-tree as we mentioned earlier.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://pakota159.github.io/img/sql/img6.png" class="img-fluid figure-img"></p>
<figcaption>Query with index</figcaption>
</figure>
</div>
<p>As we can see, the speed is much better now. The index helps us identify the word <em>Beverages</em> faster, hence we can search for it better.</p>
</section>
</section>
<section id="rules-for-sql-optimization" class="level2">
<h2 class="anchored" data-anchor-id="rules-for-sql-optimization">Rules for SQL Optimization</h2>
<p>Thanks to understanding the underlying principle of indexes, we can now note down some rules for better queries in the future.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>The notes below will be updated regularly.</p>
</div>
</div>
<section id="avoid-like-with-leading-wildcards" class="level3">
<h3 class="anchored" data-anchor-id="avoid-like-with-leading-wildcards">1. Avoid LIKE with Leading Wildcards</h3>
<p>Avoid <strong>LIKE</strong> expressions with leading wildcards (e.g., <code>'%TERM'</code>).</p>
<p>Because the index uses the first letter and sorts by A-Z order, we should avoid LIKE expressions without the first letter specified. The index table will be useless in this case.</p>
</section>
<section id="multi-column-index-rules" class="level3">
<h3 class="anchored" data-anchor-id="multi-column-index-rules">2. Multi-Column Index Rules</h3>
<p>If we create an index for multiple columns, then the <em>WHERE</em> condition applied for only one of those columns will not use the index.</p>
<p>For example, if we make an index for <code>user_id</code> and <code>company</code>, then searching for <code>user_id = 1000</code> alone will not use the index. The index is only valid for the combination of <code>user_id</code> and <code>company</code>. We have to search for <code>user_id = 1000 AND company = 'GOOGLE'</code> to use the index.</p>
</section>
<section id="case-insensitive-indexes" class="level3">
<h3 class="anchored" data-anchor-id="case-insensitive-indexes">3. Case-Insensitive Indexes</h3>
<p>If we want to search with Case-Insensitive matching (meaning CUONG and Cuong return the same result), then we should create an index with case-insensitivity:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb2-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">CREATE</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">INDEX</span> user_index <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">ON</span> users (<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">UPPER</span>(first_name));</span></code></pre></div></div>
<p>This creates an index with uppercase of <em>first_name</em> column values. Then we execute the query:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb3-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">SELECT</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">FROM</span> users <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">WHERE</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">UPPER</span>(first_name) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'CUONG'</span>;</span></code></pre></div></div>
</section>
<section id="function-based-index-considerations" class="level3">
<h3 class="anchored" data-anchor-id="function-based-index-considerations">4. Function-Based Index Considerations</h3>
<p>If you want to query data like “how many days from the latest day each user bought a product”, you might write something like <code>TRUNC(DAYS_BETWEEN(SYSDATE, buy_date))</code>.</p>
<p>However, this value cannot be indexed because it changes daily. (Index can be updated with INSERT, UPDATE, DELETE commands, but can’t automatically update daily or when executing SELECT commands).</p>
<p><strong>Solution</strong>: Index <code>buy_date</code> instead. If we want to query all users that have 30 days from now to their latest purchase, we calculate that date (<code>that_date = today - 30 days</code>), then query with condition <code>that_date = buy_date</code>.</p>
</section>
<section id="datetime-range-conditions" class="level3">
<h3 class="anchored" data-anchor-id="datetime-range-conditions">5. DateTime Range Conditions</h3>
<p>When writing conditions for datetime ranges, explicitly declare the start and end of the time range.</p>
<p>Instead of:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb4-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">WHERE</span> date_time <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'2020-10-10'</span></span></code></pre></div></div>
<p>Write:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb5-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">WHERE</span> date_time <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'2020-10-09'</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">AND</span> date_time <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'2020-10-10'</span></span></code></pre></div></div>
</section>
</section>
<section id="further-reading" class="level2">
<h2 class="anchored" data-anchor-id="further-reading">Further Reading</h2>
<ol type="1">
<li><a href="https://use-the-index-luke.com/">Use The Index, Luke</a> — An excellent resource for understanding SQL indexing in depth.</li>
</ol>


</section>

 ]]></description>
  <category>sql</category>
  <category>data</category>
  <category>index</category>
  <guid>https://pakota159.github.io/posts/index-and-query/</guid>
  <pubDate>Mon, 10 Aug 2020 17:00:00 GMT</pubDate>
  <media:content url="https://pakota159.github.io/img/sql/bg.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>Understanding SQL through Relational Algebra</title>
  <dc:creator>Cuong Pham</dc:creator>
  <link>https://pakota159.github.io/posts/sql-relational-db/</link>
  <description><![CDATA[ 




<p>When studying SQL, a lot of us start with some statements like <em>Select</em>, <em>FROM</em>, <em>WHERE</em>, but it turns out SQL is more than just that. The principle of the query language is based on relational algebra, and when I learned about it, I found it way more interesting to understand SQL and how queries work.</p>
<p>So let’s discover some of the relational algebra and find out if it makes you learn deeper about SQL.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>This article is for people who have basic knowledge of SQL and querying databases. If you don’t have it, you may need to read about basic SQL first.</p>
</div>
</div>
<section id="the-relational-model" class="level2">
<h2 class="anchored" data-anchor-id="the-relational-model">The Relational Model</h2>
<p>It’s used by all major database systems. It’s a concept used to build the world of relational databases.</p>
<p>In this model:</p>
<blockquote class="blockquote">
<p><strong>Database = set of named relations (or tables)</strong></p>
</blockquote>
<p>Each relation has a set of named <strong>attributes</strong> (or <strong>columns</strong>).</p>
<p>For example, we have a relation <strong>Student</strong> as below:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>ID</th>
<th>Name</th>
<th>Class</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
</tbody>
</table>
<p>The table <strong>Student</strong> has 3 <em>attributes</em>: id, name, and class.</p>
<p>Each <strong>tuple</strong> (or <strong>row</strong>) has a value for each <em>attribute</em>:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>ID</th>
<th>Name</th>
<th>Class</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>001</td>
<td>Cuong</td>
<td>A1</td>
</tr>
<tr class="even">
<td>002</td>
<td>Phong</td>
<td>A2</td>
</tr>
</tbody>
</table>
</section>
<section id="key-concepts" class="level2">
<h2 class="anchored" data-anchor-id="key-concepts">Key Concepts</h2>
<p><strong>Schema</strong> (of database) is the structural description of relations in database.</p>
<p><strong>Instance</strong> (of database) is the actual contents at a given point in time. It means the <em>entire data stored in database</em> at a particular moment of time.</p>
<p><strong>NULL</strong> is a special value for ‘unknown’ or ‘undefined’.</p>
<p><strong>Key</strong> is an attribute whose value is unique in each tuple (row). Sometimes, this unique key can be the combination of multiple attributes.</p>
</section>
<section id="creating-tables-in-sql" class="level2">
<h2 class="anchored" data-anchor-id="creating-tables-in-sql">Creating Tables in SQL</h2>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb1-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">CREATE</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">TABLE</span> table_name(</span>
<span id="cb1-2">    column1 datatype,</span>
<span id="cb1-3">    column2 datatype,</span>
<span id="cb1-4">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">..</span>.</span>
<span id="cb1-5">);</span></code></pre></div></div>
<p>Some common datatypes (depends on type of DBMS):</p>
<ul>
<li><code>CHAR(size)</code> — size 0-255</li>
<li><code>VARCHAR(size)</code> — size 0-255</li>
<li><code>INT()</code></li>
<li><code>BIGINT()</code></li>
<li><code>FLOAT()</code></li>
<li><code>DOUBLE()</code></li>
</ul>
<p>For the <em>Student</em> relation, we can write:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb2-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">CREATE</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">TABLE</span> Student (</span>
<span id="cb2-2">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">id</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">integer</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">PRIMARY</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">KEY</span>,</span>
<span id="cb2-3">    name <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">varchar</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">255</span>),</span>
<span id="cb2-4">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">class</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">varchar</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">255</span>)</span>
<span id="cb2-5">);</span></code></pre></div></div>
</section>
<section id="steps-in-creating-and-using-a-relational-database" class="level2">
<h2 class="anchored" data-anchor-id="steps-in-creating-and-using-a-relational-database">Steps in Creating and Using a Relational Database</h2>
<ol type="1">
<li><strong>Design Schema</strong>: create using DDL (Data Definition Language)</li>
<li><strong>Load initial data</strong> (if any)</li>
<li><strong>Execute queries and modifications</strong> using DML (Data Manipulation Language)</li>
</ol>
<p><em>Queries will return relations.</em></p>
</section>
<section id="query-languages" class="level2">
<h2 class="anchored" data-anchor-id="query-languages">Query Languages</h2>
<ul>
<li><strong>Relational Algebra</strong>: formal language</li>
<li><strong>SQL</strong>: implemented Relational Algebra</li>
</ul>
</section>
<section id="relational-algebra" class="level2">
<h2 class="anchored" data-anchor-id="relational-algebra">Relational Algebra</h2>
<p>Queries on a set of relations produce a relation as a result.</p>
<p>Imagine we have a booking system, with <strong>User</strong> who selects <strong>Product</strong> and then makes a <strong>Booking</strong>.</p>
<p>The <em>Schema</em> of each relation will be something like below (<em>a very simple version</em>):</p>
<ul>
<li><em>User</em>: <code>user_id</code> (PK), <code>username</code>, <code>age</code>, <code>city</code></li>
<li><em>Product</em>: <code>product_id</code> (PK), <code>product_name</code>, <code>price</code></li>
<li><em>Booking</em>: <code>booking_id</code> (PK), <code>user_id</code>, <code>product_id</code>, <code>status</code></li>
</ul>
<section id="select-operator-sigma" class="level3">
<h3 class="anchored" data-anchor-id="select-operator-sigma">Select Operator (<img src="https://latex.codecogs.com/png.latex?%5Csigma">)</h3>
<p><strong>Select</strong> operator picks certain rows.</p>
<p>We want users with <em>age &gt; 20</em>, then the formation will be:</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Csigma_%7Bage%20%3E%2020%7D%20User"></p>
<p>The operator above will return a relation that contains all rows where the value of age is larger than 20.</p>
<p>If we want to select with multiple conditions, like <code>age &gt; 20</code> and <code>city = 'Hanoi'</code>, we use caret (∧):</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Csigma_%7Bage%20%3E%2020%20%5Cwedge%20city%20=%20'Hanoi'%7D%20User"></p>
</section>
<section id="project-operator-pi" class="level3">
<h3 class="anchored" data-anchor-id="project-operator-pi">Project Operator (<img src="https://latex.codecogs.com/png.latex?%5CPi">)</h3>
<p><strong>Project</strong> operator picks certain columns.</p>
<p>We only want the columns (attributes) <em>username</em> and <em>age</em>:</p>
<p><img src="https://latex.codecogs.com/png.latex?%5CPi_%7Busername,%20age%7D%20User"></p>
<p>Now, we can combine the 2 operators above. If we want users with <em>age &gt; 20</em> and only return columns <em>username, age</em>:</p>
<p><img src="https://latex.codecogs.com/png.latex?%5CPi_%7Busername,%20age%7D(%5Csigma_%7Bage%20%3E%2020%7D%20User)"></p>
</section>
<section id="cross-product" class="level3">
<h3 class="anchored" data-anchor-id="cross-product">Cross-Product</h3>
<p><strong>Cross-product</strong> combines 2 relations.</p>
<p>Imagine we have <em>User</em> and <em>Product</em> tables:</p>
<p><em>User</em></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>user_id</th>
<th>username</th>
<th>age</th>
<th>city</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>cuong</td>
<td>20</td>
<td>Hanoi</td>
</tr>
<tr class="even">
<td>2</td>
<td>phong</td>
<td>25</td>
<td>HCM</td>
</tr>
</tbody>
</table>
<p><em>Product</em></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>product_id</th>
<th>product_name</th>
<th>price</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>mac</td>
<td>2000</td>
</tr>
<tr class="even">
<td>2</td>
<td>iphone</td>
<td>1000</td>
</tr>
</tbody>
</table>
<p>Then <img src="https://latex.codecogs.com/png.latex?User%20%5Ctimes%20Product"> will return a new relation which has 4 rows (2 × 2 rows), and 7 columns (4 + 3 attributes):</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>user_id</th>
<th>username</th>
<th>age</th>
<th>city</th>
<th>product_id</th>
<th>product_name</th>
<th>price</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>cuong</td>
<td>20</td>
<td>Hanoi</td>
<td>1</td>
<td>mac</td>
<td>2000</td>
</tr>
<tr class="even">
<td>2</td>
<td>phong</td>
<td>25</td>
<td>HCM</td>
<td>1</td>
<td>mac</td>
<td>2000</td>
</tr>
<tr class="odd">
<td>1</td>
<td>cuong</td>
<td>20</td>
<td>Hanoi</td>
<td>2</td>
<td>iphone</td>
<td>1000</td>
</tr>
<tr class="even">
<td>2</td>
<td>phong</td>
<td>25</td>
<td>HCM</td>
<td>2</td>
<td>iphone</td>
<td>1000</td>
</tr>
</tbody>
</table>
<p>Basically, each row of the User table will match with all rows of the Product table, and vice versa.</p>
</section>
<section id="natural-join" class="level3">
<h3 class="anchored" data-anchor-id="natural-join">Natural Join</h3>
<p>Now if users decide to select and buy some products, we will have bookings.</p>
<p><em>Booking</em></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>id</th>
<th>product_id</th>
<th>user_id</th>
<th>status</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>1</td>
<td>1</td>
<td>Done</td>
</tr>
<tr class="even">
<td>2</td>
<td>2</td>
<td>2</td>
<td>Processing</td>
</tr>
<tr class="odd">
<td>3</td>
<td>2</td>
<td>1</td>
<td>Done</td>
</tr>
</tbody>
</table>
<p>If we do <strong>Natural Join</strong> between <code>Booking</code> and <code>User</code>, like <img src="https://latex.codecogs.com/png.latex?Booking%20%5Cbowtie%20User">, we will merge the same-name column (<code>user_id</code> here) and remove rows that have different values of the same attribute, keeping rows where <code>user_id</code> values are the same.</p>
<p>First, we do cross product normally:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>id</th>
<th>product_id</th>
<th>user_id</th>
<th>status</th>
<th>user_id</th>
<th>username</th>
<th>age</th>
<th>city</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>1</td>
<td><strong>1</strong></td>
<td>Done</td>
<td><strong>1</strong></td>
<td>cuong</td>
<td>20</td>
<td>Hanoi</td>
</tr>
<tr class="even">
<td>2</td>
<td>2</td>
<td>2</td>
<td>Processing</td>
<td>1</td>
<td>cuong</td>
<td>20</td>
<td>Hanoi</td>
</tr>
<tr class="odd">
<td>3</td>
<td>2</td>
<td><strong>1</strong></td>
<td>Done</td>
<td><strong>1</strong></td>
<td>cuong</td>
<td>20</td>
<td>Hanoi</td>
</tr>
<tr class="even">
<td>1</td>
<td>1</td>
<td>1</td>
<td>Done</td>
<td>2</td>
<td>phong</td>
<td>25</td>
<td>HCM</td>
</tr>
<tr class="odd">
<td>2</td>
<td>2</td>
<td><strong>2</strong></td>
<td>Processing</td>
<td><strong>2</strong></td>
<td>phong</td>
<td>25</td>
<td>HCM</td>
</tr>
<tr class="even">
<td>3</td>
<td>2</td>
<td>1</td>
<td>Done</td>
<td>2</td>
<td>phong</td>
<td>25</td>
<td>HCM</td>
</tr>
</tbody>
</table>
<p>We have 3 bookings and 2 users, that’s why we have 6 rows. But <code>user_id</code> from Booking and <code>user_id</code> from User actually reflect the same thing (identify User), so we merge these 2 columns.</p>
<p>We keep rows that have the same <code>user_id</code> (bold), because that’s the actual <strong>match</strong> between 2 tables. We want to know which bookings <strong>user_id 1</strong> made, and we identify that by matching the <code>user_id</code> between 2 tables.</p>
<p>Final table (column <strong>user_id</strong> is merged):</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>id</th>
<th>product_id</th>
<th>user_id</th>
<th>status</th>
<th>username</th>
<th>age</th>
<th>city</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>1</td>
<td><strong>1</strong></td>
<td>Done</td>
<td>cuong</td>
<td>20</td>
<td>Hanoi</td>
</tr>
<tr class="even">
<td>3</td>
<td>2</td>
<td><strong>1</strong></td>
<td>Done</td>
<td>cuong</td>
<td>20</td>
<td>Hanoi</td>
</tr>
<tr class="odd">
<td>2</td>
<td>2</td>
<td><strong>2</strong></td>
<td>Processing</td>
<td>phong</td>
<td>25</td>
<td>HCM</td>
</tr>
</tbody>
</table>
<p>After natural join, we can apply Select and Project to get the values we want:</p>
<p><img src="https://latex.codecogs.com/png.latex?%5CPi_%7Bid,%20product%5C_id,%20username%7D(%5Csigma_%7Bstatus%20=%20'Done'%7D%20(Booking%20%5Cbowtie%20User))"></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>id</th>
<th>product_id</th>
<th>status</th>
<th>username</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>1</td>
<td>Done</td>
<td>cuong</td>
</tr>
<tr class="even">
<td>3</td>
<td>2</td>
<td>Done</td>
<td>cuong</td>
</tr>
</tbody>
</table>
</section>
<section id="theta-join" class="level3">
<h3 class="anchored" data-anchor-id="theta-join">Theta Join</h3>
<p><strong>Theta join</strong> is cross-product with a condition.</p>
<p>Imagine we have an age table which defines the min age for users of each city:</p>
<p><em>Age table</em></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>city</th>
<th>min_age</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Hanoi</td>
<td>20</td>
</tr>
<tr class="even">
<td>HCM</td>
<td>35</td>
</tr>
</tbody>
</table>
<p>If we want to find users from Hanoi that satisfy the condition <code>age &gt;= min_age</code>, we will have to do cross-product:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>user_id</th>
<th>username</th>
<th>age</th>
<th>city</th>
<th>city</th>
<th>min_age</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>cuong</td>
<td>20</td>
<td>Hanoi</td>
<td>Hanoi</td>
<td>20</td>
</tr>
<tr class="even">
<td>2</td>
<td>phong</td>
<td>25</td>
<td>HCM</td>
<td>Hanoi</td>
<td>20</td>
</tr>
<tr class="odd">
<td>1</td>
<td>cuong</td>
<td>20</td>
<td>Hanoi</td>
<td>HCM</td>
<td>35</td>
</tr>
<tr class="even">
<td>2</td>
<td>phong</td>
<td>25</td>
<td>HCM</td>
<td>HCM</td>
<td>35</td>
</tr>
</tbody>
</table>
<p>If we want the city and age to match the condition, we have to eliminate tuples that don’t have the same city, and where <code>age &lt; min_age</code>:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>user_id</th>
<th>username</th>
<th>age</th>
<th>city</th>
<th>city</th>
<th>min_age</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>cuong</td>
<td>20</td>
<td>Hanoi</td>
<td>Hanoi</td>
<td>20</td>
</tr>
</tbody>
</table>
</section>
<section id="union-operator" class="level3">
<h3 class="anchored" data-anchor-id="union-operator">Union Operator</h3>
<p>Two tables with the same columns (attributes):</p>
<p><em>Car</em></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>id</th>
<th>name</th>
<th>brand</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>civic</td>
<td>honda</td>
</tr>
<tr class="even">
<td>2</td>
<td>glc</td>
<td>mercedes</td>
</tr>
</tbody>
</table>
<p><em>Bike</em></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>id</th>
<th>name</th>
<th>brand</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>air blade</td>
<td>honda</td>
</tr>
<tr class="even">
<td>2</td>
<td>glc</td>
<td>mercedes</td>
</tr>
</tbody>
</table>
<p>The union of 2 tables will be:</p>
<p><img src="https://latex.codecogs.com/png.latex?Car%20%5Ccup%20Bike"></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>id</th>
<th>name</th>
<th>brand</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>civic</td>
<td>honda</td>
</tr>
<tr class="even">
<td>2</td>
<td>glc</td>
<td>mercedes</td>
</tr>
<tr class="odd">
<td>1</td>
<td>air blade</td>
<td>honda</td>
</tr>
</tbody>
</table>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>The primary key (<code>id</code>) seems like it’s duplicated in the union table. That’s because the key is now a combination of (<code>id</code>, <code>name</code>, <code>brand</code>).</p>
</div>
</div>
</section>
<section id="intersection" class="level3">
<h3 class="anchored" data-anchor-id="intersection">Intersection</h3>
<p>Returns tuples which are identical in both tables:</p>
<p><img src="https://latex.codecogs.com/png.latex?Car%20%5Ccap%20Bike"></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>id</th>
<th>name</th>
<th>brand</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2</td>
<td>glc</td>
<td>mercedes</td>
</tr>
</tbody>
</table>
</section>
<section id="difference" class="level3">
<h3 class="anchored" data-anchor-id="difference">Difference</h3>
<p>Returns tuples which are in the first table but not in the second:</p>
<p><img src="https://latex.codecogs.com/png.latex?Car%20-%20Bike"></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>id</th>
<th>name</th>
<th>brand</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>civic</td>
<td>honda</td>
</tr>
</tbody>
</table>
</section>
<section id="rename-operator" class="level3">
<h3 class="anchored" data-anchor-id="rename-operator">Rename Operator</h3>
<p>If we want to do those 3 operators but the names of attributes are different, we can rename them:</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Crho_%7Bid,%20name,%20brand%20%5Crightarrow%20id,%20name,%20new%5C_brand%7D(Car)"></p>
</section>
</section>
<section id="sql" class="level2">
<h2 class="anchored" data-anchor-id="sql">SQL</h2>
<p><strong>SQL</strong> is based on relational algebra — you can say it’s implemented relational algebra in most database systems.</p>
<p><strong>DDL</strong> (Data Definition Language): commands used to create tables, drop tables.</p>
<p><strong>DML</strong> (Data Manipulation Language): commands used to select, insert, delete, update tables.</p>
<section id="basic-select-statement" class="level3">
<h3 class="anchored" data-anchor-id="basic-select-statement">Basic SELECT Statement</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb3-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">SELECT</span> A1, A2, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">..</span>., An</span>
<span id="cb3-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">FROM</span> R1, R2, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">..</span>., Rn</span>
<span id="cb3-3"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">WHERE</span> condition</span></code></pre></div></div>
<p>The order is:</p>
<ol type="1">
<li><strong>FROM</strong> — identifies the relations</li>
<li><strong>WHERE</strong> — validates rows that satisfy the condition</li>
<li><strong>SELECT</strong> — projects columns we want</li>
</ol>
<p>In the language of Relational Algebra:</p>
<p><img src="https://latex.codecogs.com/png.latex?%5CPi_%7BA1,%20A2,%20...,%20An%7D%20(%5Csigma_%7Bcondition%7D(R1%20%5Ctimes%20R2%20%5Ctimes%20...%20%5Ctimes%20Rn))"></p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>The <strong>FROM</strong> statement means we do cross-product if we add multiple relations.</p>
</div>
</div>
</section>
<section id="subqueries" class="level3">
<h3 class="anchored" data-anchor-id="subqueries">Subqueries</h3>
<p>A <strong>subquery</strong> is a SQL query nested inside a larger query.</p>
<p>A subquery may occur in:</p>
<ul>
<li><code>SELECT</code> clause</li>
<li><code>FROM</code> clause</li>
<li><code>WHERE</code> clause</li>
</ul>
<p>Example: if a subquery is in the WHERE clause, we want the condition in WHERE to become a SQL query itself:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb4-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">SELECT</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span></span>
<span id="cb4-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">FROM</span> Users</span>
<span id="cb4-3"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">WHERE</span> user_id <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">IN</span> (</span>
<span id="cb4-4">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">SELECT</span> user_id</span>
<span id="cb4-5">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">FROM</span> Booking</span>
<span id="cb4-6">)</span></code></pre></div></div>
<p>In the example above, we execute a query before executing the WHERE clause. We get the column <code>user_id</code> from the Booking table, then use those <code>user_id</code> values as a condition for the bigger query.</p>


</section>
</section>

 ]]></description>
  <category>sql</category>
  <category>data</category>
  <guid>https://pakota159.github.io/posts/sql-relational-db/</guid>
  <pubDate>Sat, 08 Aug 2020 17:00:00 GMT</pubDate>
  <media:content url="https://pakota159.github.io/img/sql/bg.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>CS 61B Berkeley - Java and Data Structures Review</title>
  <dc:creator>Cuong Pham</dc:creator>
  <link>https://pakota159.github.io/posts/review-cs-61b/</link>
  <description><![CDATA[ 




<p>The most common way to execute a Java program is to run it through a sequence of two programs. The first is the Java compiler, or <code>javac</code>. The second is the Java interpreter, or <code>java</code>.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://pakota159.github.io/img/review/java1.png" class="img-fluid figure-img"></p>
<figcaption>Java compilation process</figcaption>
</figure>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">javac</span> HelloWorld.java</span>
<span id="cb1-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">java</span> HelloWorld</span></code></pre></div></div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb2-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">public</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">class</span> HelloWorld <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb2-2">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">public</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">static</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">void</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">main</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">String</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[]</span> args<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb2-3">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">System</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">out</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">println</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Hello world!"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb2-4">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb2-5"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div></div>
<p>Variables in Java are strictly defined with a specific type. You can’t change the type of variable after defining it.</p>
<ul>
<li><code>System.out.println</code> prints to screen (like stdout), with <code>\n</code> at the end of line</li>
<li><code>System.out.print</code> same as above but without <code>\n</code></li>
</ul>
<p>Conditional statements are similar to JavaScript.</p>
<section id="data-types" class="level2">
<h2 class="anchored" data-anchor-id="data-types">Data Types</h2>
<section id="primitive-types" class="level3">
<h3 class="anchored" data-anchor-id="primitive-types">Primitive Types</h3>
<p>There are 8 primitive types in Java:</p>
<ol type="1">
<li><code>byte</code></li>
<li><code>short</code></li>
<li><code>int</code></li>
<li><code>long</code></li>
<li><code>float</code></li>
<li><code>double</code> — stores approximations of real numbers</li>
<li><code>boolean</code></li>
<li><code>char</code></li>
</ol>
</section>
<section id="reference-type" class="level3">
<h3 class="anchored" data-anchor-id="reference-type">Reference Type</h3>
<ol start="9" type="1">
<li>References to Objects</li>
</ol>
<p>When you declare a variable of a certain type in Java:</p>
<ul>
<li>Your computer sets aside exactly enough bits to hold a thing of that type. Example: Declaring an <code>int</code> sets aside a “box” of 32 bits.</li>
<li>Java creates an internal table that maps each variable name to a location.</li>
<li>Java does NOT write anything into the reserved boxes — for safety, Java will not let you access a variable that is uninitialized.</li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://pakota159.github.io/img/review/java2.png" class="img-fluid figure-img"></p>
<figcaption>Variable declaration in memory</figcaption>
</figure>
</div>
</section>
</section>
<section id="the-golden-rule-of-equals-groe" class="level2">
<h2 class="anchored" data-anchor-id="the-golden-rule-of-equals-groe">The Golden Rule of Equals (GRoE)</h2>
<p>Given variables <code>y</code> and <code>x</code>:</p>
<blockquote class="blockquote">
<p><strong>y = x</strong> copies all the bits from x into y.</p>
</blockquote>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://pakota159.github.io/img/review/java3.png" class="img-fluid figure-img"></p>
<figcaption>GRoE example 1</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://pakota159.github.io/img/review/java4.png" class="img-fluid figure-img"></p>
<figcaption>GRoE example 2</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://pakota159.github.io/img/review/java5.png" class="img-fluid figure-img"></p>
<figcaption>GRoE example 3</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://pakota159.github.io/img/review/java6.png" class="img-fluid figure-img"></p>
<figcaption>GRoE example 4</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://pakota159.github.io/img/review/java7.png" class="img-fluid figure-img"></p>
<figcaption>GRoE example 5</figcaption>
</figure>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Use the <code>private</code> keyword to prevent code in other classes from using members (or constructors) of a class.</p>
</div>
</div>
</section>
<section id="functions" class="level2">
<h2 class="anchored" data-anchor-id="functions">Functions</h2>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb3-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">public</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">static</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">max</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span> x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span> y<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb3-2">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> y<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb3-3">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb3-4">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb3-5">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> y<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb3-6"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div></div>
<p>Same as in C, we declare functions with name, type of output, and parameters.</p>
</section>
<section id="arrays" class="level2">
<h2 class="anchored" data-anchor-id="arrays">Arrays</h2>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb4-1"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[]</span> numbers <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">new</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">];</span></span>
<span id="cb4-2">numbers<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb4-3">numbers<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb4-4">numbers<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb4-5"></span>
<span id="cb4-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Or this way</span></span>
<span id="cb4-7"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[]</span> numbers <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">new</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[]{</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span></code></pre></div></div>
<p>We create a new instance of class <code>int</code> named <code>numbers</code> which is an array of 3 integers. You can get the length of an array by using <code>.length</code>.</p>
<section id="for-loop" class="level3">
<h3 class="anchored" data-anchor-id="for-loop">For Loop</h3>
<p><code>for</code> loop syntax is similar to JavaScript. <code>break</code> and <code>continue</code> work similarly as well:</p>
<ul>
<li><code>continue</code> — skips the rest of the current iteration and jumps to the next increment condition</li>
<li><code>break</code> — terminates the innermost loop</li>
</ul>
</section>
<section id="enhanced-for-loop" class="level3">
<h3 class="anchored" data-anchor-id="enhanced-for-loop">Enhanced For Loop</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb5-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">String</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[]</span> arr <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"y"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb5-2"></span>
<span id="cb5-3"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">String</span> element <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> arr<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb5-4">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">System</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">out</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">println</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>element<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb5-5"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div></div>
<p>This is similar to <code>for in</code> in Python.</p>
</section>
</section>
<section id="object-oriented-programming" class="level2">
<h2 class="anchored" data-anchor-id="object-oriented-programming">Object-Oriented Programming</h2>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb6-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// This class can be run directly because it has main() method</span></span>
<span id="cb6-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Similar idea as C</span></span>
<span id="cb6-3"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">public</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">class</span> Otoke <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb6-4">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">public</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">static</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">void</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">main</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">String</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[]</span> args<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb6-5"></span>
<span id="cb6-6">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb6-7"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb6-8"></span>
<span id="cb6-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// This class can't be run directly because there is no main method</span></span>
<span id="cb6-10"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">class</span> Dog <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb6-11">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// weight is an Instance variable</span></span>
<span id="cb6-12">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">public</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span> weight<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb6-13">    </span>
<span id="cb6-14">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Static method or variable can only be accessed by Class, not instance</span></span>
<span id="cb6-15">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">public</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">static</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">String</span> TYPE <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"animal"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb6-16"></span>
<span id="cb6-17">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Constructor: (similar to a method, but not a method)</span></span>
<span id="cb6-18">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Determines how to instantiate the class</span></span>
<span id="cb6-19">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">public</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Dog</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span> initWeight<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb6-20">        weight <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> initWeight<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb6-21">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb6-22"></span>
<span id="cb6-23">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Non-static method, a.k.a. Instance Method</span></span>
<span id="cb6-24">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// If the method needs to use "instance variables", </span></span>
<span id="cb6-25">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// the method must be non-static</span></span>
<span id="cb6-26">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">public</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">void</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">doubleWeight</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb6-27">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">System</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">out</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">println</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>weight <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb6-28">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb6-29"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb6-30"></span>
<span id="cb6-31"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">public</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">class</span> Main <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb6-32">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">public</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">static</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">void</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">main</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">String</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[]</span> args<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb6-33">        Dog smallDog<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span>              <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Declaration of a Dog variable</span></span>
<span id="cb6-34">        <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">new</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Dog</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span>               <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Instantiation of the Dog class</span></span>
<span id="cb6-35">        smallDog <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">new</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Dog</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span>     <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Instantiation and Assignment</span></span>
<span id="cb6-36">        Dog hugeDog <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">new</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Dog</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">150</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Declaration, Instantiation and Assignment</span></span>
<span id="cb6-37">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb6-38"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div></div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Important</span>Static vs Instance Methods
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li><strong>Static methods</strong> are invoked using the class name: <code>Dog.makeNoise();</code></li>
<li><strong>Instance methods</strong> are invoked using an instance name: <code>maya.makeNoise();</code></li>
<li><strong>Static methods can’t access instance variables</strong>, because there is no “me”</li>
</ul>
</div>
</div>
<section id="command-line-arguments" class="level3">
<h3 class="anchored" data-anchor-id="command-line-arguments">Command Line Arguments</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb7-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">public</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">static</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">void</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">main</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">String</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[]</span> args<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb7-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// args is an array of command line arguments</span></span>
<span id="cb7-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// access item in array by args[index]</span></span>
<span id="cb7-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// args[0] means first argument after filename</span></span></code></pre></div></div>
</section>
</section>
<section id="nested-classes" class="level2">
<h2 class="anchored" data-anchor-id="nested-classes">Nested Classes</h2>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb8-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">public</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">class</span> SLList <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb8-2">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">public</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">class</span> IntNode <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Define a class inside another</span></span>
<span id="cb8-3">        <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">public</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span> item<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb8-4">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb8-5">    </span>
<span id="cb8-6">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">private</span> IntNode stuff<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Use that to declare a new variable</span></span>
<span id="cb8-7"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div></div>
<p>Nested Classes are useful when a class doesn’t stand on its own and is obviously subordinate to another class.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>When to use nested classes
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li><strong>Make the nested class private</strong> if other classes should never use the nested class</li>
<li><strong>Declare it static</strong> if the nested class never uses any instance variables or methods of the outer class</li>
<li>Static classes cannot access outer class’s instance variables or methods</li>
<li>Results in a minor savings of memory</li>
</ul>
</div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://pakota159.github.io/img/review/java8.png" class="img-fluid figure-img"></p>
<figcaption>Nested class diagram</figcaption>
</figure>
</div>
</section>
<section id="caching" class="level2">
<h2 class="anchored" data-anchor-id="caching">Caching</h2>
<p><strong>Caching idea</strong>: putting aside data to speed up retrieval.</p>
<p>Every time we add a new node to SLList, we increment the <code>size</code> variable (which is an instance variable). When removing a node, we decrement it.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://pakota159.github.io/img/review/java9.png" class="img-fluid figure-img"></p>
<figcaption>Caching in SLList</figcaption>
</figure>
</div>
</section>
<section id="sllist---singly-linked-list" class="level2">
<h2 class="anchored" data-anchor-id="sllist---singly-linked-list">SLList - Singly Linked List</h2>
<p>Suppose we have a naked linked list (simply a node):</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb9-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">public</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">class</span> IntNode <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb9-2">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">public</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span> item<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span>       <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Item is the integer part of each node</span></span>
<span id="cb9-3">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">public</span> IntNode next<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span>   <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// next is a "pointer"/reference to the next IntNode </span></span>
<span id="cb9-4"></span>
<span id="cb9-5">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">public</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">IntNode</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span> i<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> IntNode n<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Initiation of the node</span></span>
<span id="cb9-6">        item <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> i<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb9-7">        next <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> n<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb9-8">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb9-9"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://pakota159.github.io/img/review/java10.png" class="img-fluid figure-img"></p>
<figcaption>IntNode structure</figcaption>
</figure>
</div>
<p>For better handling with lists, we can wrap the node above inside a Singly Linked List:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb10-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">public</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">class</span> SLList <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb10-2">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">private</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">static</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">class</span> IntNode <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb10-3">        <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">private</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span> item<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb10-4">        <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">private</span> IntNode next<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb10-5"></span>
<span id="cb10-6">        <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">private</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">IntNode</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span> i<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> IntNode n<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb10-7">            item <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> i<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb10-8">            next <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> n<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb10-9">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb10-10">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb10-11"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div></div>


</section>

 ]]></description>
  <category>review</category>
  <category>cs</category>
  <category>java</category>
  <guid>https://pakota159.github.io/posts/review-cs-61b/</guid>
  <pubDate>Tue, 05 May 2020 17:00:00 GMT</pubDate>
  <media:content url="https://pakota159.github.io/img/note/sky.png" medium="image" type="image/png" height="66" width="144"/>
</item>
<item>
  <title>How to self-study Computer Science and Data Science</title>
  <dc:creator>Cuong Pham</dc:creator>
  <link>https://pakota159.github.io/posts/cs-learning-guide/</link>
  <description><![CDATA[ 




<p>Today, a friend asked me how to study computer science well — a popular question that many others wonder too. Thus, I decided to write an <strong>all-in-one note</strong> to explain in detail about learning computer science and data science as well. I’m not excellent in computer science at all, and this note is only sharing some experiences I have.</p>
<section id="before-you-start" class="level2">
<h2 class="anchored" data-anchor-id="before-you-start">Before you start</h2>
<p>Knowing where you are is important. You need to understand how much CS knowledge you have. This journey is long and exhausted but I can ensure it’ll be fun as well, if you really like those stuff.</p>
<p>Prepare some things:</p>
<ul>
<li>A notebook and a pen to note and <strong>visualize</strong> important things while you learn such as how HTTP requests are sent and received, how CPU and RAM works, and so on. Visualization always helps you understand things faster and easier.</li>
</ul>
<p>Here are some examples of things I drew when learning about CPU and RAM:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://pakota159.github.io/img/note/note1.jpeg" class="img-fluid figure-img"></p>
<figcaption>CPU and RAM notes</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://pakota159.github.io/img/note/note2.jpeg" class="img-fluid figure-img"></p>
<figcaption>More visualization notes</figcaption>
</figure>
</div>
<ul>
<li><p>A laptop/computer with Linux/OSX operation system. Yup, you can use Windows if you like, but I prefer Linux to learn programming.</p></li>
<li><p>A lot of time</p></li>
<li><p>And last but not least, a superior unbreakable <strong>persistent mind</strong></p></li>
</ul>
<p>There are 3 parts of this note:</p>
<ol type="1">
<li>Learning <strong>Maths</strong></li>
<li>Learning <strong>Computer Science</strong></li>
<li>Learning <strong>Data Science</strong></li>
</ol>
<p>Maths is basic stuff that support everything else, so I put it into an independent part.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>All 3 parts will only contain <em>materials</em> which I <em>personally</em> like and find them useful the most.</p>
</div>
</div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Bold courses</strong> are must-taken or you should be familiar with the outcomes of those courses (so you don’t have to re-take it). Other courses are useful and good to learn.</p>
</div>
</div>
</section>
<section id="learning-path" class="level2">
<h2 class="anchored" data-anchor-id="learning-path">Learning Path</h2>
<p>For those who want to learn programming applied in non-CS areas (like business, finance, health care, …), this is the learning path I think able to help you learn effectively:</p>
<ol type="1">
<li>Read 2 starter books</li>
<li>Do maths courses <strong>Math_01</strong> → <strong>Math_02</strong> → <strong>Math_03</strong> or make sure you understand all the concepts in each course</li>
<li>Do core courses in Computer Science: <strong>1</strong> → <strong>2</strong> → <strong>3</strong> → <strong>8</strong> (in course 8 only need Lecture 1 to 8)</li>
<li>Learn Python: <strong>Py_2</strong> → <strong>Py_5</strong> (do all projects)</li>
<li>Learn DS and Algorithm: <strong>Al_01</strong> → <strong>Al_02</strong> → <strong>Al_05</strong></li>
<li>Do real projects</li>
</ol>
<section id="recommended-certifications" class="level3">
<h3 class="anchored" data-anchor-id="recommended-certifications">Recommended Certifications</h3>
<p>To get some certifications, some courses below are recommended:</p>
<ol type="1">
<li><p><strong>Algorithms</strong>: <a href="https://www.coursera.org/specializations/algorithms">Stanford Course on Coursera</a> - Intermediate Level. You should learn basic algorithms before taking this one (Al_01 is a good start).</p></li>
<li><p><strong>C Programming</strong>: <a href="https://www.edx.org/professional-certificate/dartmouth-imtx-c-programming-with-linux">Dartmouth Course on edX</a> - Intermediate Level. Read the book <strong>C_1</strong> before taking this course. Self-paced, <strong>$308</strong> fee.</p></li>
<li><p><strong>C++ Programming</strong>: Series of 3 courses from Microsoft</p>
<ul>
<li><a href="https://www.edx.org/course/introduction-to-c-5">Intro C++</a></li>
<li><a href="https://www.edx.org/course/intermediate-c-3">Intermediate C++</a></li>
<li><a href="https://www.edx.org/course/advanced-c-3">Advanced C++</a></li>
</ul></li>
<li><p><strong>Python</strong>: <a href="https://www.coursera.org/specializations/data-science-python">Python for Data Science</a> - University of Michigan series</p></li>
</ol>
</section>
</section>
<section id="mathematics" class="level2">
<h2 class="anchored" data-anchor-id="mathematics">Mathematics</h2>
<p>The courses below should be taken in order.</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>No.</th>
<th>Course</th>
<th>What you expected to learn</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Math_01</strong></td>
<td><a href="https://ocw.mit.edu/courses/mathematics/18-01sc-single-variable-calculus-fall-2010/"><strong>Single Variable Calculus</strong></a></td>
<td>Limit, Derivatives, Chain Rules, Approximation, Mean Value Theorem, Riemann Sums, The Fundamental Theorem of Calculus, Integrals and Application, L’Hospital’s Rule, Infinite Series, Taylor’s Series</td>
</tr>
<tr class="even">
<td><strong>Math_02</strong></td>
<td><a href="https://ocw.mit.edu/courses/mathematics/18-02sc-multivariable-calculus-fall-2010/"><strong>Multivariable Calculus</strong></a></td>
<td>Vectors and operators on vectors, Determinants and Matrices (Basics), Partial Derivatives, Second Derivative Test, Total Differentials and Chain Rule, Gradient, Lagrange Multipliers, Double Integrals, Vector Fields, Curl, Green’s Theorem, Triple Integrals, Flux, Stokes’ Theorem</td>
</tr>
<tr class="odd">
<td><strong>Math_03</strong></td>
<td><a href="https://math.berkeley.edu/~apaulin/54_002(Spring2018).html"><strong>Math 54 Linear Algebra and Differential Equations</strong></a></td>
<td>Vector Spaces and Linear transformations, subspaces, kernels, range, eigenvalues and eigenvectors, The Gram-Schmidt Process, Least-Squares Problems, Linear Systems of Differential Equations, Fourier Series</td>
</tr>
<tr class="even">
<td>Math_04</td>
<td><a href="https://math.berkeley.edu/~williams/55.html">Math 55 - Discrete Mathematics</a></td>
<td>Propositional logic and equivalences, Sets and set operations, Functions, sequences, cardinality, Solving congruences, Mathematical induction, recursive, Counting, Permutations and combinations, Graphs and graph models, Graph isomorphism</td>
</tr>
</tbody>
</table>
</section>
<section id="computer-science" class="level2">
<h2 class="anchored" data-anchor-id="computer-science">Computer Science</h2>
<section id="before-studying-courses" class="level3">
<h3 class="anchored" data-anchor-id="before-studying-courses">Before studying courses</h3>
<p>You need to read a few books to understand the big pictures of computer science. Read these books in order:</p>
<section id="code-the-hidden-language-of-computer-hardware-and-software" class="level4">
<h4 class="anchored" data-anchor-id="code-the-hidden-language-of-computer-hardware-and-software">1. Code: The Hidden Language of Computer Hardware and Software</h4>
<p>A great book that provides you the first sense of computer science — what is binary, how machine understand something like binary and more. I like how the authors represent the physics mechanism of computers, so if you are not so good at physics, this book is even better for you. This book is only 400 pages long, easy to read, therefore I highly recommend it as your first read when starting to learn CS.</p>
</section>
<section id="structure-and-interpretation-of-computer-programs-sicp" class="level4">
<h4 class="anchored" data-anchor-id="structure-and-interpretation-of-computer-programs-sicp">2. Structure and Interpretation of Computer Programs (SICP)</h4>
<p>A legendary book. SICP is the kind of book that is recommended from everywhere in the CS world. It covers a lot of programming aspects from functional programming, abstraction, instruction processor to compilers. This might be quite hard for complete beginners and because this book uses the Scheme programming language, it’s pretty hard to read as well.</p>
</section>
</section>
<section id="core-courses" class="level3">
<h3 class="anchored" data-anchor-id="core-courses">Core Courses</h3>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>There are many things not covered in this path yet (after completing CS61 series). If you want to discover other courses about security, networks, machine learning, look for them on the Internet or search in this <a href="https://hkn.eecs.berkeley.edu/courseguides">awesome guide</a>.</p>
</div>
</div>
<section id="cs50" class="level4">
<h4 class="anchored" data-anchor-id="cs50">1. CS50’s Introduction to Computer Science - Harvard</h4>
<p><strong>Link</strong>: <a href="https://www.edx.org/course/cs50s-introduction-computer-science-harvardx-cs50x">edX Course</a></p>
<p>Arguably the best intro course for CS I’ve ever learnt.</p>
<p><strong>What you can learn:</strong></p>
<ul>
<li>Basic understanding of computer science and programming</li>
<li>Basic algorithms and problem-solving thinking</li>
<li>Concepts like abstraction, data structures, encapsulation, web development</li>
<li>Languages: Python, C, SQL, Javascript</li>
</ul>
</section>
<section id="cs61a" class="level4">
<h4 class="anchored" data-anchor-id="cs61a">2. CS 61A Structure and Interpretation of Computer Programs - Berkeley</h4>
<p><strong>Link</strong>: <a href="https://inst.eecs.berkeley.edu/~cs61a/sp15/">Course Website</a></p>
<p>A truly great course which makes me extremely eager to learn everything from Berkeley. However, to really enjoy it as well as get useful knowledge, you need to put a quite large amount of effort — definitely commit to do all the homeworks, assignments, and take all the exams. Might take you few months to actually get things done.</p>
<p><strong>What you can learn:</strong></p>
<ul>
<li>Python and its implementation</li>
<li>Higher-Order Functions, Recursion, Environment diagrams</li>
<li>Data Abstraction</li>
<li>Scheme, Exceptions, Iterators, Streams, SQL</li>
</ul>
</section>
<section id="cs61b" class="level4">
<h4 class="anchored" data-anchor-id="cs61b">3. CS 61B Data Structures - Berkeley</h4>
<p><strong>Videos</strong>: <a href="http://www.infocobuild.com/education/audio-video-courses/computer-science/cs61b-spring2015-berkeley.html">InfoCoBuild</a><br>
<strong>Course</strong>: <a href="http://datastructur.es/sp15/">datastructur.es</a></p>
<p>This one is quite hard for me because I don’t like learning Java much. But I think it’s useful if you want to learn data structures.</p>
<p><strong>What you can learn:</strong></p>
<ul>
<li>Basic Java</li>
<li>Data structures: Lists, Abstract Classes, Trees, BST, Graphs</li>
<li>Algorithms: Sorting and Algorithmic Bounds</li>
</ul>
</section>
<section id="cs70" class="level4">
<h4 class="anchored" data-anchor-id="cs70">4. CS 70 Discrete Mathematics and Probability Theory - Berkeley</h4>
<p><strong>Videos</strong>: <a href="http://www.infocobuild.com/education/audio-video-courses/computer-science/CS70-Spring2015-Berkeley/lecture-01.html">InfoCoBuild</a><br>
<strong>Course</strong>: <a href="https://inst.eecs.berkeley.edu/~cs70/sp15/">Course Website</a></p>
<p>I’ve not done this course yet. Discrete maths is cool and probability is interesting so I’ll finish this course soon.</p>
<p><strong>What you can learn:</strong></p>
<ul>
<li>Induction and Recursion</li>
<li>Graphs, Eulerian Tour</li>
<li>Modular Arithmetic</li>
<li>Polynomials, Secret Sharing, Erasure Codes</li>
<li>Probability: Counting, Sample Spaces, Events, Independence, Conditional Probability</li>
<li>Inference</li>
</ul>
</section>
<section id="cs61c" class="level4">
<h4 class="anchored" data-anchor-id="cs61c">5. CS 61C Great Ideas in Computer Architecture - Berkeley</h4>
<p><strong>Videos</strong>: <a href="http://www.infocobuild.com/education/audio-video-courses/computer-science/cs61c-spring2015-berkeley.html">InfoCoBuild</a><br>
<strong>Course</strong>: <a href="http://inst.eecs.berkeley.edu/~cs61c/sp15/">Course Website</a></p>
<p>My favorite one, because you will learn a lot about how machines work under the hood. Not digging too deep but quite good.</p>
<p><strong>What you can learn:</strong></p>
<ul>
<li>C programming</li>
<li>Assembly Language, MIPS Intro</li>
</ul>
</section>
<section id="cs162" class="level4">
<h4 class="anchored" data-anchor-id="cs162">6. CS 162 Operating Systems and Systems Programming - Berkeley</h4>
<p><strong>Videos</strong>: <a href="http://www.infocobuild.com/education/audio-video-courses/computer-science/cs162-spring2015-berkeley.html">InfoCoBuild</a><br>
<strong>Course</strong>: <a href="https://inst.eecs.berkeley.edu/~cs162/sp15/">Course Website</a></p>
<p>A very tough course that I haven’t finished yet. More details about operating systems than CS61C.</p>
<p><strong>What you can learn:</strong></p>
<ul>
<li>Processes, Fork, I/O, Files</li>
<li>Thread, Scheduling, Address Translation, Caching</li>
<li>Performance, Storage Devices, Queueing theory</li>
<li>Distributed Systems, TCP/IP</li>
</ul>
</section>
<section id="cs164" class="level4">
<h4 class="anchored" data-anchor-id="cs164">7. CS164 Programming Languages and Compilers - Berkeley</h4>
<p><strong>Videos</strong>: <a href="http://www.infocobuild.com/education/audio-video-courses/computer-science/cs164-spring2012-berkeley.html">InfoCoBuild</a><br>
<strong>Course</strong>: <a href="https://sites.google.com/a/bodik.org/cs164/">Course Website</a></p>
<p>I have not learned this course, but knowing about programming languages and compilers is surely useful for being a software engineer.</p>
<p><strong>What you can learn:</strong></p>
<ul>
<li>Unit Calculator</li>
<li>Scoping and desugaring</li>
<li>Coroutines and Lazy Iterators</li>
<li>Regular expressions</li>
<li>CYK and Earley Parsers</li>
</ul>
</section>
<section id="cs169" class="level4">
<h4 class="anchored" data-anchor-id="cs169">8. CS169 Software Engineering - Berkeley</h4>
<p><strong>Videos</strong>: <a href="http://www.infocobuild.com/education/audio-video-courses/computer-science/cs169-spring2015-berkeley.html">InfoCoBuild</a><br>
<strong>Course</strong>: <a href="https://sites.google.com/site/ucbcs169fa15/lectures">Course Website</a></p>
<p>I have not learned this course, just read the syllabus and think it’s practical and useful.</p>
<p><strong>What you can learn:</strong></p>
<ul>
<li>Unit Testing</li>
<li>Git</li>
<li>UML</li>
<li>Software processes</li>
<li>MVC, Web development</li>
</ul>
</section>
</section>
<section id="strengthen-your-knowledge" class="level3">
<h3 class="anchored" data-anchor-id="strengthen-your-knowledge">Strengthen your knowledge</h3>
<p>I consider the 8 courses above as core courses that you should take seriously. After that, you now have a good understanding of computer science and are ready to improve yourself even more.</p>
<p>The first thing I want to dig into is <strong>programming languages</strong>. I’m gonna cover a few most popular ones like C, C++, and Python.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>To practice coding, join some popular competitive coding sites like <a href="https://codeforces.com">Codeforces</a> and <a href="https://www.topcoder.com/">TopCoder</a>.</p>
</div>
</div>
<section id="programming-languages-resources" class="level4">
<h4 class="anchored" data-anchor-id="programming-languages-resources">Programming Languages Resources</h4>
<table class="caption-top table">
<thead>
<tr class="header">
<th>No.</th>
<th>Language</th>
<th>Resource</th>
<th>Link</th>
<th>Description</th>
<th>Difficulty</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>C_1</td>
<td>C</td>
<td>The C Programming Language</td>
<td><a href="https://www.amazon.com/Programming-Language-2nd-Brian-Kernighan/dp/0131103628">Amazon</a></td>
<td>Most popular C book. Short and great for learning basic concepts</td>
<td>★★☆☆☆</td>
</tr>
<tr class="even">
<td>C_2</td>
<td>C</td>
<td>Practical Programming in C</td>
<td><a href="https://ocw.mit.edu/courses/electrical-engineering-and-computer-science/6-087-practical-programming-in-c-january-iap-2010/assignments/">MIT OCW</a></td>
<td>MIT course with good practice problems and solutions</td>
<td>★★★☆☆</td>
</tr>
<tr class="odd">
<td>C++_1</td>
<td>C++</td>
<td>Learn C++</td>
<td><a href="https://www.learncpp.com/">learncpp.com</a></td>
<td>Great and detailed tutorial about C++</td>
<td>★★☆☆☆</td>
</tr>
<tr class="even">
<td>C++_2</td>
<td>C++</td>
<td>Accelerated C++</td>
<td><a href="https://www.amazon.com/Accelerated-C-Practical-Programming-Example/dp/020170353X">Amazon</a></td>
<td>Practices and examples</td>
<td>★★★☆☆</td>
</tr>
<tr class="odd">
<td>C++_3</td>
<td>C++</td>
<td>The C++ Programming Language</td>
<td><a href="https://www.amazon.com/C-Programming-Language-4th/dp/0321563840/">Amazon</a></td>
<td>Detailed book from author of C++ itself</td>
<td>★★★☆☆</td>
</tr>
<tr class="even">
<td>Py_1</td>
<td>Python</td>
<td>Official Docs</td>
<td><a href="https://docs.python.org/3/tutorial/index.html">python.org</a></td>
<td>Where I started learning Python — detailed and up-to-date</td>
<td>★★★☆☆</td>
</tr>
<tr class="odd">
<td>Py_2</td>
<td>Python</td>
<td>Learn Python the Hard Way</td>
<td><a href="https://learnpythonthehardway.org/python3/">Website</a></td>
<td>Simple intro to Python</td>
<td>★☆☆☆☆</td>
</tr>
<tr class="even">
<td>Py_3</td>
<td>Python</td>
<td>Real Python</td>
<td><a href="https://realpython.com/">realpython.com</a></td>
<td>Detailed examples for practice</td>
<td>★★☆☆☆</td>
</tr>
<tr class="odd">
<td>Py_4</td>
<td>Python</td>
<td>Full Stack Python</td>
<td><a href="https://www.fullstackpython.com/">fullstackpython.com</a></td>
<td>Learn what you need to build Python apps</td>
<td>★★★★☆</td>
</tr>
<tr class="even">
<td>Py_5</td>
<td>Python</td>
<td>Automate the Boring Stuff</td>
<td><a href="https://automatetheboringstuff.com/">Website</a></td>
<td>Learn to build cool Python projects</td>
<td>★★☆☆☆</td>
</tr>
</tbody>
</table>
</section>
<section id="data-structures-and-algorithms" class="level4">
<h4 class="anchored" data-anchor-id="data-structures-and-algorithms">Data Structures and Algorithms</h4>
<table class="caption-top table">
<thead>
<tr class="header">
<th>No.</th>
<th>Resource</th>
<th>Link</th>
<th>What you expected to learn</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Al_01</td>
<td>Introduction to Algorithms</td>
<td><a href="https://ocw.mit.edu/courses/electrical-engineering-and-computer-science/6-006-introduction-to-algorithms-fall-2011/">MIT OCW</a></td>
<td>Basic algorithms from MIT</td>
</tr>
<tr class="even">
<td>Al_02</td>
<td>Design and Analysis of Algorithms</td>
<td><a href="https://ocw.mit.edu/courses/electrical-engineering-and-computer-science/6-046j-design-and-analysis-of-algorithms-spring-2015/index.htm">MIT OCW</a></td>
<td>Part 2: divide and conquer, dynamic programming, complexity</td>
</tr>
<tr class="odd">
<td>Al_03</td>
<td>Advanced Algorithms</td>
<td><a href="https://ocw.mit.edu/courses/electrical-engineering-and-computer-science/6-854j-advanced-algorithms-fall-2008/">MIT OCW</a></td>
<td>Part 3 with advanced algorithms</td>
</tr>
<tr class="even">
<td>Al_04</td>
<td>Data Structures and Algorithms</td>
<td><a href="https://www.youtube.com/playlist?list=PLE621E25B3BF8B9D1">YouTube Playlist</a></td>
<td>Richard Buckland’s course on basic data structures</td>
</tr>
<tr class="odd">
<td>Al_05</td>
<td>CS 186: Introduction to Database Systems</td>
<td><a href="http://www.infocobuild.com/education/audio-video-courses/computer-science/cs186-spring2015-berkeley.html">InfoCoBuild</a></td>
<td>Database management systems, SQL</td>
</tr>
</tbody>
</table>
</section>
</section>
</section>
<section id="data-science" class="level2">
<h2 class="anchored" data-anchor-id="data-science">Data Science</h2>
<section id="probability-and-statistics" class="level3">
<h3 class="anchored" data-anchor-id="probability-and-statistics">Probability and Statistics</h3>
<section id="probability-and-statistics---stanford-online" class="level4">
<h4 class="anchored" data-anchor-id="probability-and-statistics---stanford-online">1. Probability and Statistics - Stanford Online</h4>
<p><strong>Link</strong>: <a href="https://lagunita.stanford.edu/courses/course-v1:OLI+ProbStat+Open_Jan2017/about">Stanford Lagunita</a></p>
<p>A solid foundation in probability and statistics from Stanford.</p>
</section>
<section id="probabilistic-systems-analysis-and-applied-probability---mit" class="level4">
<h4 class="anchored" data-anchor-id="probabilistic-systems-analysis-and-applied-probability---mit">2. Probabilistic Systems Analysis and Applied Probability - MIT</h4>
<p><strong>Link</strong>: <a href="https://ocw.mit.edu/courses/electrical-engineering-and-computer-science/6-041sc-probabilistic-systems-analysis-and-applied-probability-fall-2013/">MIT OCW</a></p>
<p>This course and the Stanford one can be taken separately (you can choose one of them). But for me, I took both and studied at the same time. The MIT course is more engineering-focused while the Stanford course is more statistics-focused.</p>


</section>
</section>
</section>

 ]]></description>
  <category>cs</category>
  <category>learning</category>
  <category>data</category>
  <guid>https://pakota159.github.io/posts/cs-learning-guide/</guid>
  <pubDate>Wed, 14 Aug 2019 17:00:00 GMT</pubDate>
  <media:content url="https://pakota159.github.io/img/note/bg.png" medium="image" type="image/png" height="81" width="144"/>
</item>
<item>
  <title>Working with Spotify API to collect music data</title>
  <dc:creator>Cuong Pham</dc:creator>
  <link>https://pakota159.github.io/posts/using-spotify-api-to-retrieve-data/</link>
  <description><![CDATA[ 




<p>Recently, I am working on a personal project related to analysing music taste of people and it requires retrieving data from some music sources like Spotify. And fortunely, it provides some quite useful APIs that I would like to share here.</p>
<section id="disclaimer" class="level2">
<h2 class="anchored" data-anchor-id="disclaimer">Disclaimer</h2>
<p>This is only a part of my project, with some demo codes without unit testing, error handling and other parts for a completed project.</p>
</section>
<section id="what-i-want" class="level2">
<h2 class="anchored" data-anchor-id="what-i-want">What I want</h2>
<p>Basically, I need a list of <strong>Playlists</strong> from Spotify including meta data of each playlist like tracks from playlist.</p>
<p>So, technically speaking:</p>
<p>My input:</p>
<ul>
<li>User authentication token (Spotify APIs <em>doesn’t requires</em> it, but I do want to use because it give me <em>higher rate limits</em>)</li>
</ul>
<p>And I expect an output like:</p>
<ul>
<li>JSON data with <strong>Playlist info</strong>, including <em>metadata</em> as tracks in each playlist.</li>
</ul>
<p>Okay, I pictured my goals and it’s time to get things done.</p>
</section>
<section id="lets-start" class="level2">
<h2 class="anchored" data-anchor-id="lets-start">Let’s start</h2>
<p>Simply enough, I’ll start with the <a href="https://developer.spotify.com/documentation/web-api/quick-start/">docs</a> from official page.</p>
<p>We need to <strong>create Spotify account</strong> first that can be done easily from <a href="https://www.spotify.com">https://www.spotify.com</a></p>
<p>Then you need to <strong>create developer account</strong> to use APIs <a href="https://developer.spotify.com/dashboard/login">https://developer.spotify.com/dashboard/login</a></p>
<p>And last but not least, create <strong>an app</strong> from the dashboard <a href="https://developer.spotify.com/dashboard/applications">https://developer.spotify.com/dashboard/applications</a> to get <em>client id</em> and <em>client secret</em></p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://pakota159.github.io/img/spotify/spotify1.png" class="img-fluid figure-img"></p>
<figcaption>Create Spotify App</figcaption>
</figure>
</div>
<p>Install Nodejs because we’ll need a server-side application.</p>
<p>Clone the repo <a href="https://github.com/spotify/web-api-auth-examples">https://github.com/spotify/web-api-auth-examples</a> that contains the authentication example app which provides a interface to register Spotify user account to our Spotify app.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> clone https://github.com/spotify/web-api-auth-examples auth-app</span></code></pre></div></div>
<p>Then run npm to install required packages like express, request and querystring.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">cd</span> auth-app</span>
<span id="cb2-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">npm</span> install</span></code></pre></div></div>
<p>After install, we will see a new folder <code>node_modules</code> that contains all the installed modules. Now go into the code of this auth-app:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">cd</span> authorization_code</span></code></pre></div></div>
<p>There are 2 things inside, the <code>app.js</code> is the main code of the application, folder <code>public</code> contains a <code>html</code> file.</p>
<p>Inside <code>app.js</code> there are 3 things you should care about:</p>
<ul>
<li><code>client_id</code>: Client Id of your app. (After create a new app as above, in the dashboard)</li>
<li><code>client_secret</code>: Client Secret of your app.</li>
<li><code>redirect_uri</code>: the url we will redirect after authenticating successfully.</li>
</ul>
<p>The port of server is set to be <code>8888</code>, so I will set redirect_uri base on it:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode javascript code-with-copy"><code class="sourceCode javascript"><span id="cb4-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">var</span> redirect_uri <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'http://localhost:8888/callback/'</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span></code></pre></div></div>
<p>You also need to <strong>whitelist</strong> your redirect_uri in the settings of your app.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://pakota159.github.io/img/spotify/spotify3.png" class="img-fluid figure-img"></p>
<figcaption>Whitelist redirect URI</figcaption>
</figure>
</div>
<p>Now go to <code>http://localhost:8888</code> and follow all steps to login and you should be redirect to this after successfully login.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://pakota159.github.io/img/spotify/spotify2.png" class="img-fluid figure-img"></p>
<figcaption>Login success</figcaption>
</figure>
</div>
</section>
<section id="working-with-playlists" class="level2">
<h2 class="anchored" data-anchor-id="working-with-playlists">Working with playlists</h2>
<p>Now it’s the fun part. How can I retrieve data of playlists I need?</p>
<p>After reading the <a href="https://developer.spotify.com/documentation/web-api/reference/playlists/">documents</a>, I have a brief understand about what I can do with this api.</p>
<p>There are 3 ways to get info about playlists:</p>
<ul>
<li>Using API <code>/v1/users/{user_id}/playlists</code> to acquire playlists of a specific <strong>user_id</strong></li>
<li>Using API <code>/v1/search</code> to search and return playlists with a specific <strong>query keyword</strong></li>
<li>Using API <code>/v1/browse/categories/{category_id}/playlists</code> to retrieve playlists from a specific <strong>category</strong></li>
</ul>
<p>I want to use the third method, because the playlists I’m interested in should be distinguished by <em>category</em> instead of user, or query keywords.</p>
<p>There are many categories in spotify, and each category contains many playlists, each playlist has many tracks too. But I don’t want to get all playlists from each category, so I don’t have to call too many apis.</p>
<p>The expected output is something like this — for each category, I retrieve 5 playlists, and for each playlist, I want all tracks with its name, singer, and other data:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb5-1"><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span></span>
<span id="cb5-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb5-3">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"category"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"A"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb5-4">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"playlists"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span></span>
<span id="cb5-5">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb5-6">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"name"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"First playlist"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb5-7">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"tracks"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span></span>
<span id="cb5-8">          <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb5-9">            <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"track_name"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Song 1"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb5-10">            <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"singer"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"B"</span></span>
<span id="cb5-11">          <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb5-12">        <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span></span>
<span id="cb5-13">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb5-14">    <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span></span>
<span id="cb5-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb5-16"><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span></span></code></pre></div></div>
<p>To be able to <strong>manipulate data</strong> conveniently, I would like to save category, playlists, and tracks in database.</p>
<p>I’ll use <strong>mongodb</strong> because it’s the most familiar database to me. You can use any of <a href="https://expressjs.com/en/guide/database-integration.html">these</a>.</p>
<p>First, copy the access token in the login page above and assign it to new variable in <code>app.js</code>:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode javascript code-with-copy"><code class="sourceCode javascript"><span id="cb6-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">var</span> acc_token <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'&lt;your access token&gt;'</span></span></code></pre></div></div>
<p>Then install mongoose package:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb7-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">npm</span> install mongoose</span></code></pre></div></div>
<p>Mongoose is a mongodb object modeling tool designed to work in an asynchronous environment or in this case, nodejs. Add mongoose:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode javascript code-with-copy"><code class="sourceCode javascript"><span id="cb8-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">var</span> mongoose <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">require</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'mongoose'</span>)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb8-2"></span>
<span id="cb8-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Connect mongoose to our database named spotify.</span></span>
<span id="cb8-4">mongoose<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">connect</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'mongodb://127.0.0.1/spotify'</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> {<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">useNewUrlParser</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">true</span>})<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb8-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// useNewUrlParser to fix a DeprecationWarning</span></span>
<span id="cb8-6"></span>
<span id="cb8-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Declare schema</span></span>
<span id="cb8-8"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">const</span> Schema <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> mongoose<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Schema</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span></code></pre></div></div>
</section>
<section id="design-database" class="level2">
<h2 class="anchored" data-anchor-id="design-database">Design database</h2>
<p>We obviously care 3 objects here: category, playlist and track, but how to design our database to store and manipulate data effectively?</p>
<p>There are 2 ways to design our model.</p>
<p>The first one is store all 3 objects above into 1 Schema. I can call it <strong>Category_Detail</strong> model. The advantage is whenever I want to retrieve data from db, I only have to access one model, no need to use reference fields.</p>
<p>The disadvantage is, as I considered, bigger because I will need to store my playlists in each <em>Category_Detail</em> as an <em>array</em> which makes thing hard to update, and with each playlist I need another array for tracks, so 2 nested arrays are too complicated for a model like this.</p>
<p>Thus, I decide to use the second way to design my model — 3 seperated models as following <em>category</em>, <em>playlist</em> and <em>track</em>. Playlist will contains 1 reference field that refers to category, and track will contains 1 reference field refers to playlist that it belongs to.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode javascript code-with-copy"><code class="sourceCode javascript"><span id="cb9-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">const</span> CategorySchema <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">new</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Schema</span>({</span>
<span id="cb9-2">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">cat_name</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">String</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb9-3">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">cat_id</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">String</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb9-4">})<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb9-5"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">const</span> Category <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> mongoose<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">model</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Category'</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> CategorySchema)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb9-6"></span>
<span id="cb9-7"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">const</span> PlaylistSchema <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">new</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Schema</span>({</span>
<span id="cb9-8">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">category</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> {<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">type</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> mongoose<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Schema</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Types</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ObjectId</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">ref</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Category'</span>}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb9-9">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">playlist_name</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">String</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb9-10">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">playlist_id</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">String</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb9-11">})<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb9-12"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">const</span> Playlist <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> mongoose<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">model</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Playlist'</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> PlaylistSchema)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb9-13"></span>
<span id="cb9-14"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">const</span> TrackSchema <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">new</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Schema</span>({</span>
<span id="cb9-15">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">playlist</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> {<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">type</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> mongoose<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Schema</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Types</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ObjectId</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">ref</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Playlist'</span>}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb9-16">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">track_name</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">String</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb9-17">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">track_id</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">String</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb9-18">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">artists</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">Array</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb9-19">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">images</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">Array</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb9-20">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">playlist_name</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">String</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// This field for convenient data analysis later</span></span>
<span id="cb9-21">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">playlist_id</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">String</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span>    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// This field for convenient data analysis later</span></span>
<span id="cb9-22">})<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb9-23"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">const</span> Track <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> mongoose<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">model</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Track'</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> TrackSchema)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span></code></pre></div></div>
</section>
<section id="get-category" class="level2">
<h2 class="anchored" data-anchor-id="get-category">Get category</h2>
<p>Now, we can define a new route to get category:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode javascript code-with-copy"><code class="sourceCode javascript"><span id="cb10-1">app<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'/get-category'</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> (req<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> res) <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">=&gt;</span> {</span>
<span id="cb10-2">  <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">var</span> options <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {</span>
<span id="cb10-3">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">url</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'https://api.spotify.com/v1/browse/categories'</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb10-4">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">headers</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> {</span>
<span id="cb10-5">      <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Authorization'</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Bearer '</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> acc_token</span>
<span id="cb10-6">    }<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb10-7">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">qs</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> {</span>
<span id="cb10-8">      <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'limit'</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb10-9">      <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'country'</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'VN'</span></span>
<span id="cb10-10">    }<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb10-11">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">json</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">true</span></span>
<span id="cb10-12">  }<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb10-13">  request<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get</span>(options<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> (error<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> response<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> body) <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">=&gt;</span> {</span>
<span id="cb10-14">    res<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">send</span>({</span>
<span id="cb10-15">      <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'data'</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> body</span>
<span id="cb10-16">    })</span>
<span id="cb10-17">  })<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb10-18">})</span></code></pre></div></div>
<p>Now go to <code>http://localhost:8888/get-category</code>, we’ll get the response:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://pakota159.github.io/img/spotify/spotify4.png" class="img-fluid figure-img"></p>
<figcaption>Category response</figcaption>
</figure>
</div>
<p>I only need <strong>category id</strong> to query playlists for each category. So we should change the code a bit:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode javascript code-with-copy"><code class="sourceCode javascript"><span id="cb11-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Define a function that store category</span></span>
<span id="cb11-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">var</span> save_category_to_db <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(data){</span>
<span id="cb11-3">  Category<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">count</span>({<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">cat_id</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> data<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">id</span>}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span> (err<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> count){</span>
<span id="cb11-4">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> (count <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">===</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>){  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Only store category that's not existed in database yet</span></span>
<span id="cb11-5">      <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">const</span> cat <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">new</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Category</span>()<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb11-6">      cat<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cat_id</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> data<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">id</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb11-7">      cat<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cat_name</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> data<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb11-8">      cat<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">save</span>()</span>
<span id="cb11-9">    }</span>
<span id="cb11-10">  })<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb11-11">}</span>
<span id="cb11-12"></span>
<span id="cb11-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Define a route /get-category that call Api browse categories</span></span>
<span id="cb11-14">app<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'/get-category'</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> (req<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> res) <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">=&gt;</span> {</span>
<span id="cb11-15">  <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">var</span> options <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {</span>
<span id="cb11-16">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">url</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'https://api.spotify.com/v1/browse/categories'</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb11-17">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">headers</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> {</span>
<span id="cb11-18">      <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Authorization'</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Bearer '</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> acc_token</span>
<span id="cb11-19">    }<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb11-20">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">qs</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> {</span>
<span id="cb11-21">      <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'limit'</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb11-22">      <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'country'</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'VN'</span></span>
<span id="cb11-23">    }<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb11-24">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">json</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">true</span></span>
<span id="cb11-25">  }<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb11-26">  request<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get</span>(options<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span> (error<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> response<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> body) {</span>
<span id="cb11-27">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Store category to db</span></span>
<span id="cb11-28">    body<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">categories</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">items</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">forEach</span>((val) <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">=&gt;</span> {</span>
<span id="cb11-29">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">save_category_to_db</span>(val)</span>
<span id="cb11-30">    })</span>
<span id="cb11-31">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Response</span></span>
<span id="cb11-32">    res<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">send</span>({</span>
<span id="cb11-33">      <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'data'</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Success'</span></span>
<span id="cb11-34">    })</span>
<span id="cb11-35">  })<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb11-36">})</span></code></pre></div></div>
<p>And in db, we have our categories:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb12-1"><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span></span>
<span id="cb12-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span> </span>
<span id="cb12-3">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"_id"</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"5d52b6f2de0da87f6ec98e7f"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span> </span>
<span id="cb12-4">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"cat_id"</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"toplists"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span> </span>
<span id="cb12-5">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"cat_name"</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Top Lists"</span></span>
<span id="cb12-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb12-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span> </span>
<span id="cb12-8">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"_id"</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"5d52b6f2de0da87f6ec98e80"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span> </span>
<span id="cb12-9">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"cat_id"</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pride"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span> </span>
<span id="cb12-10">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"cat_name"</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Pride"</span></span>
<span id="cb12-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb12-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span> </span>
<span id="cb12-13">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"_id"</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"5d52b6f2de0da87f6ec98e82"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span> </span>
<span id="cb12-14">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"cat_id"</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"kpop"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span> </span>
<span id="cb12-15">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"cat_name"</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"K-Pop"</span> </span>
<span id="cb12-16">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb12-17"><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span></span></code></pre></div></div>
</section>
<section id="get-playlist" class="level2">
<h2 class="anchored" data-anchor-id="get-playlist">Get playlist</h2>
<p>For each category, I want to call Api once to get list of playlists I want. The problem is nodejs is <strong>asynchronous</strong>, and after we make a request to query <strong>toplists</strong> category, nodejs processes will continue make request to query <strong>kpop</strong> before previous request responses. To solve that problem, we need to make sure all the requests <em>must</em> response completely before we response to client.</p>
<p>The logic flow can be understood as below:</p>
<pre><code>Make request GET /https://api.spotify.com/v1/browse/categories/toplists/playlists
to get all playlists of toplists

Make request GET /https://api.spotify.com/v1/browse/categories/kpop/playlists
to get all playlists of kpop

...
After all requests above response successfully, save those playlists to db, then response to client</code></pre>
<p>To do all of these above, we’ll use Promises or in this case <em>bluebird</em> package:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb14-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">npm</span> install bluebird</span>
<span id="cb14-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">npm</span> install request-promise</span></code></pre></div></div>
<p>Use <em>bluebird</em> and <em>request-promise</em>:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode javascript code-with-copy"><code class="sourceCode javascript"><span id="cb15-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">var</span> Bluebird <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">require</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'bluebird'</span>)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb15-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">var</span> rp <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">require</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'request-promise'</span>)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb15-3"></span>
<span id="cb15-4"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">var</span> save_playlist_to_db <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(data){</span>
<span id="cb15-5">  <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">var</span> cat_id <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> data<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">href</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">split</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'/'</span>)[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>]<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Extract cat id from href in response</span></span>
<span id="cb15-6">  Category<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">findOne</span>({<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">cat_id</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> cat_id}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(err<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> doc){</span>
<span id="cb15-7">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span>(doc){</span>
<span id="cb15-8">      data<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">items</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">forEach</span>(val <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">=&gt;</span> {</span>
<span id="cb15-9">        Playlist<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">count</span>({<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">playlist_id</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> val<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">id</span>}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span> (err<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> count){</span>
<span id="cb15-10">          <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> (count <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">===</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>){</span>
<span id="cb15-11">            <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">const</span> playlist <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">new</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Playlist</span>()<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb15-12">            playlist<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">playlist_name</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> val<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb15-13">            playlist<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">playlist_id</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> val<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">id</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb15-14">            playlist<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">category</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> doc<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb15-15">            playlist<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">save</span>()</span>
<span id="cb15-16">          }</span>
<span id="cb15-17">        })<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb15-18">      })</span>
<span id="cb15-19">    }</span>
<span id="cb15-20">  })</span>
<span id="cb15-21">}</span>
<span id="cb15-22"></span>
<span id="cb15-23">app<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'/get-playlist'</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> (req<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> res) <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">=&gt;</span> {</span>
<span id="cb15-24">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Get all categories in db</span></span>
<span id="cb15-25">  Category<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">find</span>({}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(err<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> playlists){</span>
<span id="cb15-26">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">var</span> playlist_requests <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> playlists<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map</span>((val) <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">=&gt;</span> {</span>
<span id="cb15-27">      <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// For each category, make promise</span></span>
<span id="cb15-28">      <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rp</span>({</span>
<span id="cb15-29">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">url</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'https://api.spotify.com/v1/browse/categories/'</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> val<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cat_id</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'/playlists'</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb15-30">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">headers</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> {</span>
<span id="cb15-31">          <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Authorization'</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Bearer '</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> acc_token</span>
<span id="cb15-32">        }<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb15-33">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">qs</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> {</span>
<span id="cb15-34">          <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'limit'</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb15-35">          <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'country'</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'VN'</span></span>
<span id="cb15-36">        }<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb15-37">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">json</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">true</span></span>
<span id="cb15-38">      })</span>
<span id="cb15-39">    })</span>
<span id="cb15-40"></span>
<span id="cb15-41">    Bluebird<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">all</span>(playlist_requests)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">then</span>(response <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">=&gt;</span> {</span>
<span id="cb15-42">      <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// After response completed, store playlist in db</span></span>
<span id="cb15-43">      response<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map</span>((value) <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">=&gt;</span> {</span>
<span id="cb15-44">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">save_playlist_to_db</span>(value<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">playlists</span>)</span>
<span id="cb15-45">      })</span>
<span id="cb15-46">      res<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">send</span>({</span>
<span id="cb15-47">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'data'</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> response</span>
<span id="cb15-48">      })</span>
<span id="cb15-49">    })</span>
<span id="cb15-50">  })</span>
<span id="cb15-51">})</span></code></pre></div></div>
<p>And we get result like below, with <strong>name, id, category</strong> of all playlists:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb16-1"><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span></span>
<span id="cb16-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span> </span>
<span id="cb16-3">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"_id"</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"5d52bf2aae62ab8263811977"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span> </span>
<span id="cb16-4">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"playlist_name"</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Viral Hits"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span> </span>
<span id="cb16-5">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"playlist_id"</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"37i9dQZF1DX44t7uCdkV1A"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span> </span>
<span id="cb16-6">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"category"</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"5d52b6f2de0da87f6ec98e7f"</span></span>
<span id="cb16-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb16-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span> </span>
<span id="cb16-9">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"_id"</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"5d52bf2aae62ab8263811978"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span> </span>
<span id="cb16-10">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"playlist_name"</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Viral 50 Việt Nam"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span> </span>
<span id="cb16-11">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"playlist_id"</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"37i9dQZEVXbL1G1MbPav3j"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span> </span>
<span id="cb16-12">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"category"</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"5d52b6f2de0da87f6ec98e7f"</span> </span>
<span id="cb16-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb16-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span> </span>
<span id="cb16-15">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"_id"</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"5d52bf2aae62ab826381197c"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb16-16">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"playlist_name"</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"New Music Friday Malaysia"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span> </span>
<span id="cb16-17">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"playlist_id"</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"37i9dQZF1DWZMWLrh2UzwC"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span> </span>
<span id="cb16-18">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"category"</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"5d52b6f2de0da87f6ec98e7f"</span></span>
<span id="cb16-19">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb16-20"><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span></span></code></pre></div></div>
</section>
<section id="get-all-tracks-in-each-playlist" class="level2">
<h2 class="anchored" data-anchor-id="get-all-tracks-in-each-playlist">Get all tracks in each playlist</h2>
<p>Now we have playlists:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb17-1"><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span></span>
<span id="cb17-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb17-3">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"id"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"37i9dQZF1DXcBWIGoYBM5M"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb17-4">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"name"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Today's Top Hits"</span></span>
<span id="cb17-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb17-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb17-7">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"id"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"37i9dQZF1DX44t7uCdkV1A"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb17-8">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"name"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Viral Hits"</span></span>
<span id="cb17-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb17-10"><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span></span></code></pre></div></div>
<p>And if we make request like <code>GET https://api.spotify.com/v1/playlists/37i9dQZF1DX44t7uCdkV1A/tracks</code> we will be able to retrieve list of tracks in that playlist.</p>
<p>But once again, nodejs is asynchronous and there are too many playlists we need to get tracks, we’ll get Apis <strong>limit rate error</strong>.</p>
<p>So we need to make seperated requests to avoid the error above. I make new route:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode javascript code-with-copy"><code class="sourceCode javascript"><span id="cb18-1">app<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'/get-tracks'</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> (req<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> res) <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">=&gt;</span> {</span>
<span id="cb18-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_tracks</span>(<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(response){</span>
<span id="cb18-3">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// get_tracks function will receive 1 callback to response to client</span></span>
<span id="cb18-4">    res<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">send</span>({</span>
<span id="cb18-5">      <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'data'</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> response</span>
<span id="cb18-6">    })</span>
<span id="cb18-7">  })<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> </span>
<span id="cb18-8">})</span></code></pre></div></div>
<p>The function <code>get_tracks</code> will do something for us:</p>
<ul>
<li>Query all category from database</li>
<li>From each category, take 2 or 3 playlists</li>
<li>From each playlist, call api GET tracks from playlist</li>
</ul>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode javascript code-with-copy"><code class="sourceCode javascript"><span id="cb19-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">var</span> get_tracks <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(cb){</span>
<span id="cb19-2">  Category<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">find</span>({}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(err<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> cats){</span>
<span id="cb19-3">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">var</span> promise_arr <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb19-4">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">var</span> query_promises <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb19-5">    cats<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">forEach</span>(cat <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">=&gt;</span> {</span>
<span id="cb19-6">      query_promises<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">push</span>(</span>
<span id="cb19-7">        Playlist<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">find</span>({<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">category</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> cat<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">id</span>}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">null</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> {<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">limit</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>})<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exec</span>()</span>
<span id="cb19-8">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Only query 2 playlist for each category to avoid limit rate error</span></span>
<span id="cb19-9">      )</span>
<span id="cb19-10">    })</span>
<span id="cb19-11">    </span>
<span id="cb19-12">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// This promise is query promise to make sure we call api after completing all queries</span></span>
<span id="cb19-13">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">Promise</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">all</span>(query_promises)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">then</span>(results <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">=&gt;</span> {</span>
<span id="cb19-14">      results<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">forEach</span>(playlists <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">=&gt;</span> {</span>
<span id="cb19-15">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// For each playlist, make promise</span></span>
<span id="cb19-16">        playlists<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">forEach</span>(val <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">=&gt;</span> {</span>
<span id="cb19-17">          promise_arr<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">push</span>(</span>
<span id="cb19-18">            <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rp</span>({</span>
<span id="cb19-19">              <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">url</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'https://api.spotify.com/v1/playlists/'</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> val<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">playlist_id</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'/tracks'</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb19-20">              <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">headers</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> {</span>
<span id="cb19-21">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Authorization'</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Bearer '</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> acc_token</span>
<span id="cb19-22">              }<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb19-23">              <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">qs</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> {</span>
<span id="cb19-24">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'limit'</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb19-25">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'country'</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'VN'</span></span>
<span id="cb19-26">              }<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb19-27">              <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">json</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">true</span></span>
<span id="cb19-28">            })</span>
<span id="cb19-29">          )</span>
<span id="cb19-30">        })</span>
<span id="cb19-31">      })</span>
<span id="cb19-32"></span>
<span id="cb19-33">      Bluebird<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">all</span>(promise_arr)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">then</span>(response <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">=&gt;</span> {</span>
<span id="cb19-34">        response<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">forEach</span>(val <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">=&gt;</span> {</span>
<span id="cb19-35">          <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// After finishing calling API, save response data to database</span></span>
<span id="cb19-36">          <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">save_track_to_db</span>(val)</span>
<span id="cb19-37">        })</span>
<span id="cb19-38">      })<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">catch</span>(err <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">=&gt;</span> {</span>
<span id="cb19-39">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">console</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">log</span>(err)</span>
<span id="cb19-40">      })</span>
<span id="cb19-41">      </span>
<span id="cb19-42">      <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Because query and saving data took too much time, I response to client this msg</span></span>
<span id="cb19-43">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cb</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Processing'</span>)</span>
<span id="cb19-44">    })</span>
<span id="cb19-45">  })</span>
<span id="cb19-46">}</span></code></pre></div></div>
<p>After calling API completely, we save the response data to track database:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode javascript code-with-copy"><code class="sourceCode javascript"><span id="cb20-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">var</span> save_track_to_db <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(data){</span>
<span id="cb20-2">  <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">var</span> playlist_id <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> data<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">href</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">split</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'/'</span>)[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>]</span>
<span id="cb20-3">  Playlist<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">findOne</span>({<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">playlist_id</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> playlist_id}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(err<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> pl){</span>
<span id="cb20-4">    data<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">items</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">forEach</span>(val <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">=&gt;</span> {</span>
<span id="cb20-5">      <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span>(val <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;&amp;</span> val<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">track</span>){</span>
<span id="cb20-6">        Track<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">count</span>({<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">track_id</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> val<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">track</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">id</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">playlist</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> pl}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(err<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> count){</span>
<span id="cb20-7">          <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span>(count <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">===</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>){</span>
<span id="cb20-8">            <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">const</span> track <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">new</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Track</span>()<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb20-9">            track<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">track_id</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> val<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">track</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">id</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb20-10">            track<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">track_name</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> val<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">track</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb20-11">            track<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">playlist</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pl<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb20-12">            track<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">artists</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> val<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">track</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">artists</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb20-13">            track<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">images</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> val<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">track</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">album</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">images</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb20-14">            track<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">playlist_name</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pl<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">playlist_name</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb20-15">            track<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">playlist_id</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pl<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">playlist_id</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb20-16">            track<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">save</span>()</span>
<span id="cb20-17">            <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">console</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">log</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Done save track '</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> val<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">track</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name</span>)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Log on terminal</span></span>
<span id="cb20-18">          }</span>
<span id="cb20-19">        })</span>
<span id="cb20-20">      }</span>
<span id="cb20-21">    })</span>
<span id="cb20-22">  })</span>
<span id="cb20-23">}</span></code></pre></div></div>
<p>While client receive a response like <strong>Processing</strong>, in the console terminal, we can see what the node server is doing:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://pakota159.github.io/img/spotify/spotify7.png" class="img-fluid figure-img"></p>
<figcaption>Terminal log</figcaption>
</figure>
</div>
<p>As a result now we have track database like this:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb21-1"><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span></span>
<span id="cb21-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span> </span>
<span id="cb21-3">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"artists"</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span></span>
<span id="cb21-4">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb21-5">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"name"</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Ximena Sariñana"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span> </span>
<span id="cb21-6">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"type"</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"artist"</span></span>
<span id="cb21-7">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb21-8">    <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span> </span>
<span id="cb21-9">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"track_id"</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2vNDq5XAoF4Gl4hfY7aacS"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span> </span>
<span id="cb21-10">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"track_name"</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"¿Qué Tiene?"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span> </span>
<span id="cb21-11">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"playlist_name"</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Viral Hits"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span> </span>
<span id="cb21-12">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"playlist_id"</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"37i9dQZF1DX44t7uCdkV1A"</span></span>
<span id="cb21-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb21-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span> </span>
<span id="cb21-15">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"artists"</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span></span>
<span id="cb21-16">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb21-17">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"name"</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Old Dominion"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span> </span>
<span id="cb21-18">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"type"</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"artist"</span></span>
<span id="cb21-19">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb21-20">    <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span> </span>
<span id="cb21-21">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"track_id"</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1kTugNMVMbaQep1srMua2q"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span> </span>
<span id="cb21-22">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"track_name"</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Bad At Love - Recorded at Sound Stage Studios Nashville"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span> </span>
<span id="cb21-23">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"playlist_name"</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Viral Hits"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span> </span>
<span id="cb21-24">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"playlist_id"</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"37i9dQZF1DX44t7uCdkV1A"</span></span>
<span id="cb21-25">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb21-26"><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span></span></code></pre></div></div>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>And we’ve done. I’m now able to retrieve thounsand of songs and playlists from Spotify. I could make a small background tasks run periodically to query new songs, new playlists if I want. After that, when I have enough data, I can conduct some analysis over it to learn new insights about music.</p>
<p>Thank for reading, this is one of my first blogs so it should have many mistakes. Hope you guys enjoy it and give me some feedback!</p>


</section>

 ]]></description>
  <category>cs</category>
  <category>nodejs</category>
  <category>data</category>
  <category>spotify</category>
  <guid>https://pakota159.github.io/posts/using-spotify-api-to-retrieve-data/</guid>
  <pubDate>Wed, 07 Aug 2019 17:00:00 GMT</pubDate>
  <media:content url="https://pakota159.github.io/img/spotify/bg.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>How I use scrapy to collect the data I need</title>
  <dc:creator>Cuong Pham</dc:creator>
  <link>https://pakota159.github.io/posts/how-i-use-scrapy-to-collect-the-data-i-need/</link>
  <description><![CDATA[ 




<p>About 4 years ago, I encountered a huge struggle looking for a suitable room for rent. Information about renting house/room is vast and it’s really hard to filter useful data.</p>
<p>I didn’t want to hire an agent for that and didn’t have time to search every websites for rent.</p>
<p>That’s when I have the idea of collecting data automatically from every kind of websites.</p>
<p>But it took quite a long time to study programming well enough to make some tools like that. Few years later, now I’m able to make my wishes some true with the automation tools. I called it <strong><em>Stacy</em></strong> (in Gwen Stacy - A spider woman from Marvel)</p>
<p>There are normally 4 steps in defining and solving a data science problem:</p>
<ol type="1">
<li>Formulating a question or problem</li>
<li>Acquiring and cleaning data</li>
<li>Conducting exploratory data analysis</li>
<li>Using prediction and inference to draw conclusions</li>
</ol>
<p>For each step we need to answer some questions, so we go through these one by one.</p>
<section id="define-the-questionproblem-we-need-to-solve" class="level2">
<h2 class="anchored" data-anchor-id="define-the-questionproblem-we-need-to-solve">Define the question/problem we need to solve</h2>
<p><em>What do we want and what are our metrics of success or how to evaluate the result?</em></p>
<p>In my case, I want:</p>
<ul>
<li>To find all houses that are <strong>available at the time</strong> and <strong>satisfy my needs</strong>.</li>
</ul>
<p>Ex: I want a room with area around 20<img src="https://latex.codecogs.com/png.latex?m%5E2">, has windows, able to cook, inside Dong Da District and the price is around 2 million VND per month.</p>
<p>So to make sure the houses are <em>available at the time</em> and <em>satisfy my needs</em>, I need the tool to:</p>
<ul>
<li>Update in real-time or at least every 30 minutes which houses are available (<em>available at the time</em>)</li>
<li>Match all the criteria (<em>satisfy my needs</em>)</li>
</ul>
<p>I expect the data flow as below:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://pakota159.github.io/img/scrape/scrape1.png" class="img-fluid figure-img"></p>
<figcaption>Data Flow Diagram</figcaption>
</figure>
</div>
</section>
<section id="acquiring-data" class="level2">
<h2 class="anchored" data-anchor-id="acquiring-data">Acquiring data</h2>
<p>Something I need to prepare:</p>
<ul>
<li><p><strong>Data Sources</strong>: facebook posts/groups, some websites as: <em>nha.chotot.com</em>, <em>phongtro123.com</em>, <em>mogi.vn</em>, <em>batdongsan.com.vn</em></p></li>
<li><p><strong>Framework/Tools</strong>: For scrape data using Python, I will use <strong>Scrapy</strong> and <strong>Splash</strong> for simulate a browser in cases some website requires javascript. Row data will be stored in <em>mongodb</em> with ORM will be <em>Pymongo</em>; I also want to schedule the crawler thus I will use <em>scrapy-do</em> for scheduly running background tasks.</p></li>
</ul>
<p>Let’s code our “spider”.</p>
<p>After creating folder for our project, setup <em>virtualenv</em> for python3, <em>pip install scrapy</em> to install scrapy, we run <code>startproject</code> command to create new project:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">$</span> scrapy startproject stacy</span></code></pre></div></div>
<p>The crawler includes few main parts:</p>
<ul>
<li>The spider itself: a class inherit <code>scrapy.Spider</code> class that create list of Requests that we send to get the webpage we need. Each <code>Request</code> has a callback that is the function which handle the response of the request.</li>
<li>In case we need authentication, we should care about <code>middleware</code>, I usually add cookies to middleware, so every requests the crawler makes will contains authentication information</li>
<li>Scrapy stores the data that retrive from <code>response</code> in <code>Items</code>. My item includes several fields but the most important is <code>post_content</code> that contains the raw text/content about housing.</li>
<li>Item pipeline is where we save the Item to database.</li>
<li>The parsing part is usually quite boring, you can use inspector in browser to look up for the <code>xpath</code> or <code>css</code> of the element in DOM, then parsing is simple thing</li>
</ul>
<p>I will show some interesting parts in my code here.</p>
<section id="using-splash-with-lua-script-to-login-to-a-page" class="level3">
<h3 class="anchored" data-anchor-id="using-splash-with-lua-script-to-login-to-a-page">Using splash with Lua script to login to a page</h3>
<p>Splash is a headless browser (a browser without GUI) that is integrated greatly with scrapy, the fun thing is Splash using Lua, so I need to learn a little about Lua to be able to write the automatically login script.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode lua code-with-copy"><code class="sourceCode lua"><span id="cb2-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span> main<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">splash</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">args</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb2-2">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-- Define a function that focus on an input</span></span>
<span id="cb2-3">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span> focus<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">sel</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb2-4">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">splash</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">sel</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">):</span>focus<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()</span></span>
<span id="cb2-5">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">end</span></span>
<span id="cb2-6">    </span>
<span id="cb2-7">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-- Go to the login site</span></span>
<span id="cb2-8">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">assert</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">splash</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>go<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb2-9">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">splash</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">args</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">url</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb2-10">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">headers</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">splash</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">args</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">headers</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb2-11">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">http_method</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">splash</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">args</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">http_method</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb2-12">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">body</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">splash</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">args</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">body</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb2-13">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">})</span></span>
<span id="cb2-14">    </span>
<span id="cb2-15">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-- "Click" to email input</span></span>
<span id="cb2-16">    focus<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'input[name=email]'</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb2-17">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-- "Type" your email</span></span>
<span id="cb2-18">    <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">splash</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>send_text<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cuongtuanpham159@gmail.com"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb2-19">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-- "Click" to password input</span></span>
<span id="cb2-20">    focus<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'input[name=pass]'</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb2-21">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-- "Type" your password</span></span>
<span id="cb2-22">    <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">splash</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>send_text<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"xtcc8JWyq2q/lxGX+4D9Sx92V80WttPhAJSBues"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb2-23">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-- Wait a little bit to make sure inputs is filled</span></span>
<span id="cb2-24">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">assert</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">splash</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>wait<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">))</span></span>
<span id="cb2-25">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-- "Click" to Login button</span></span>
<span id="cb2-26">    <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">splash</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'input[name=login]'</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">):</span>mouse_click<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()</span></span>
<span id="cb2-27">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-- Done, wait the welcome window to display</span></span>
<span id="cb2-28">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">assert</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">splash</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>wait<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">))</span>                        </span>
<span id="cb2-29">                                                                </span>
<span id="cb2-30">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb2-31">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">url</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">splash</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>url<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(),</span></span>
<span id="cb2-32">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">cookies</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">splash</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>get_cookies<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(),</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-- Get the cookies to store in database later</span></span>
<span id="cb2-33">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">html</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">splash</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>html<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(),</span></span>
<span id="cb2-34">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb2-35"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">end</span></span></code></pre></div></div>
<p>The code above is the most basic example when we want to login into some sites. Because in many cases, the website will require something like capcha, ‘I’m not robot’ thing and so on that make the login process more complicated. But normally I will successfully login to the website I want and get <code>cookies</code> that allows me to easily make requests later without having to login again.</p>
</section>
<section id="handle-middleware-with-cookies" class="level3">
<h3 class="anchored" data-anchor-id="handle-middleware-with-cookies">Handle middleware with cookies</h3>
<p>I’m not sure this is the good practice to add cookies to the requests, but I don’t know any other ways.</p>
<p><code>middlewares.py</code></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">class</span> StacyDownloaderMiddleware(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">object</span>):</span>
<span id="cb3-2">    ...</span>
<span id="cb3-3">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> get_cookies(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, spider):</span>
<span id="cb3-4">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Find cookies exists in db</span></span>
<span id="cb3-5">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> spider.collection.find_one({<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'spider_name'</span>: spider.cookie_collection})</span>
<span id="cb3-6">    </span>
<span id="cb3-7">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> process_request(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, request, spider):</span>
<span id="cb3-8">        cookies <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.get_cookies(spider<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>spider)</span>
<span id="cb3-9">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># If cookies exists, add cookies to request</span></span>
<span id="cb3-10">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> cookies:</span>
<span id="cb3-11">            request.cookies <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> cookies.get(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'cookies'</span>)</span>
<span id="cb3-12">        </span>
<span id="cb3-13">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span></span>
<span id="cb3-14">    </span>
<span id="cb3-15">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> process_response(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, request, response, spider):</span>
<span id="cb3-16">        cookies <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.get_cookies(spider<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>spider)</span>
<span id="cb3-17">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># If in database has no coookies, insert to database, this applied when login</span></span>
<span id="cb3-18">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">not</span> cookies:</span>
<span id="cb3-19">            spider.collection.insert_one({</span>
<span id="cb3-20">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'spider_name'</span>: spider.cookie_collection,</span>
<span id="cb3-21">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'cookies'</span>: response.data.get(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'cookies'</span>)</span>
<span id="cb3-22">            })</span>
<span id="cb3-23"></span>
<span id="cb3-24">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> response</span></code></pre></div></div>
<p>The code above still need to be improved like add more validator when I check the cookies in the database, at least add the <code>try except</code>. But for small, simple project I do not focus on this yet.</p>
</section>
<section id="remove-all-emoji-or-non-alphabet-non-vietnamese-characters" class="level3">
<h3 class="anchored" data-anchor-id="remove-all-emoji-or-non-alphabet-non-vietnamese-characters">Remove all emoji or non-alphabet, non-vietnamese characters</h3>
<p>After we retrieve <code>post_content</code> from response html, we need briefly “clean” that data.</p>
<p>Example I have retrieved a text:</p>
<p><code>🏠🏠🏠 Cho thuê phòng tầng 2 thoáng mát ,sạch sẽ . Có chỗ đun nấu và sân phơi đồ thoáng tầng 4 . Chung chủ nên an ninh tốt . 1,8 Tr/tháng, cọc 1 tháng . Ngõ :255 Nguyễn Khang-Cầu Giấy . Bạn nào qua tâm ib hoặc LH:0972413480</code></p>
<p>There are some things I noticed:</p>
<ul>
<li>Emoji and special characters in the text</li>
<li>Uppercase and lowercase characters</li>
<li>Extra whitespace</li>
</ul>
<p>So how to <code>normalize</code> the text above?</p>
<p>Using regex seems to be the fastest way to remove Emoji and unwanted characters.</p>
<p>The idea is replace all non-alphabet/vietnamese with empty string <code>re.sub(r"[^\w\s]+", "", text)</code> then replace double whitespace <code>\s\s+</code> with single white space.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> clean_text(text):</span>
<span id="cb4-2">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> re.sub(<span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">r"</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">\s\s</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" "</span>, re.sub(<span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">r"</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">\w\s</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>, text))</span></code></pre></div></div>
<p>When run the code above with the text above, result will be:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"Cho thuê phòng tầng 2 thoáng mát sạch sẽ Có chỗ đun nấu và sân phơi đồ </span></span>
<span id="cb5-2"><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">thoáng tầng 4 Chung chủ nên an ninh tốt 18 Trtháng cọc 1 tháng Ngõ 255 </span></span>
<span id="cb5-3">Nguyễn KhangCầu Giấy Bạn nào qua tâm ib hoặc LH0972413480<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span></code></pre></div></div>
<p>Look pretty … wrong. It’s will be hard for us to detect the price <code>18 Trtháng</code> that actually is <code>1,8 Tr/tháng</code>.</p>
<p>Because there are few punctuations that should be remained in the text like <code>,</code>, <code>.</code>, <code>/</code>, therefore we need to define which ones ought to be kept.</p>
<p>The list of unicode characters could be found <a href="https://unicode-table.com/en/#control-character">here</a>. And thanks for that, I can define which punctuations I should remain in the text and rewrite my code:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> clean_text(text):</span>
<span id="cb6-2">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> re.sub(</span>
<span id="cb6-3">            <span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">r"</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">\s\s</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>,</span>
<span id="cb6-4">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" "</span>,</span>
<span id="cb6-5">            re.sub(</span>
<span id="cb6-6">                <span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">r"</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[^</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\u002C</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">-</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\u002F\u0028</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">-</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\u0029\u003A</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">-</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\u003F</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">\w\s</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>, text</span>
<span id="cb6-7">            )</span>
<span id="cb6-8">        )</span></code></pre></div></div>
<p>And the result is pretty good now:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"Cho thuê phòng tầng 2 thoáng mát ,sạch sẽ . </span></span>
<span id="cb7-2"><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">Có chỗ đun nấu và sân phơi đồ thoáng tầng 4 . </span></span>
<span id="cb7-3">Chung chủ nên an ninh tốt . <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span> Tr<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>tháng, cọc <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> tháng . </span>
<span id="cb7-4">Ngõ :<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">255</span> Nguyễn Khang<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>Cầu Giấy . Bạn nào qua tâm ib hoặc LH:<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">972413480</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span></code></pre></div></div>
<p>We can do more to remove redundant semicolons but I feel ok with this text and ready to save it to the data base.</p>
<p><strong><em>Updating…</em></strong></p>


</section>
</section>

 ]]></description>
  <category>cs</category>
  <category>scrapy</category>
  <category>splash</category>
  <category>python</category>
  <category>data</category>
  <guid>https://pakota159.github.io/posts/how-i-use-scrapy-to-collect-the-data-i-need/</guid>
  <pubDate>Sun, 07 Jul 2019 17:00:00 GMT</pubDate>
  <media:content url="https://pakota159.github.io/img/scrape/bg.jpg" medium="image" type="image/jpeg"/>
</item>
</channel>
</rss>
